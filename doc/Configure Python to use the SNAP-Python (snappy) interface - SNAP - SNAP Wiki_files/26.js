(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{"1Y1u":function(e,t,n){"use strict";var o=n("/dP/"),a=n("8TdO"),i=n("H5qd"),r=n.n(i);const c=r.a`mutation FileUploadMutation($size:Int!$contentType:String!$mimeType:String!$fileName:String!$pageId:String!$fileStoreId:String!$minorEdit:Boolean$renderEditorHTML:Boolean$collectionName:String!)@experimental{experimentalFileUpload(size:$size contentType:$contentType mimeType:$mimeType fileName:$fileName pageId:$pageId fileStoreId:$fileStoreId minorEdit:$minorEdit renderEditorHTML:$renderEditorHTML collectionName:$collectionName)}`,s=r.a`query MediaDownloadTokenQuery($contentId:ID!$status:[String]){content(id:$contentId status:$status){nodes{id body{atlas_doc_format{mediaToken{token}}}}}mediaConfiguration{clientId fileStoreUrl}}`,l=r.a`query ExternalShareMediaDownloadTokenQuery($contentId:ID!){singleContent(id:$contentId){id body{atlas_doc_format{mediaToken{token}}}}mediaConfiguration{clientId fileStoreUrl}}`,d=r.a`query MediaUploadTokenQuery($contentId:ID!){contentMediaSession(contentId:$contentId){token{value}configuration{clientId fileStoreUrl}collection mediaPickerUserToken{id token}}}`,u=async e=>await Object(a.getApolloClient)().query({query:s,variables:{contentId:e,status:["current","draft","archived"]},context:{allowOnExternalPage:!0},fetchPolicy:"network-only"}),f=async e=>await Object(a.getApolloClient)().query({query:d,variables:{contentId:e},fetchPolicy:"network-only"});var g=n("CSQs");const m=()=>{},h=e=>e.contentId&&e.contentType?t=>{const{id:n,name:o,size:i,mimeType:r}=t,{contentId:s,contentType:l}=e;(e=>{Object(a.getApolloClient)().mutate({mutation:c,variables:e})})({size:i,contentType:l,mimeType:r,fileName:o,pageId:s,fileStoreId:n,minorEdit:!0,renderEditorHTML:!1,collectionName:"contentId-"+s})}:m;n.d(t,"c",(function(){return T})),n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return j}));const p=Object(g.a)(async e=>{var t,n,o,i,r,c,s,d,f,g,m,h,p;const b=await(e.isExternalShare?(async e=>await Object(a.getApolloClient)().query({query:l,variables:{contentId:e},context:{allowOnExternalPage:!0},fetchPolicy:"network-only"}))(e.contentId):u(e.contentId));return{token:(e.isExternalShare?null==b||null===(t=b.data)||void 0===t||null===(n=t.singleContent)||void 0===n||null===(o=n.body)||void 0===o||null===(i=o.atlas_doc_format)||void 0===i||null===(r=i.mediaToken)||void 0===r?void 0:r.token:null==b||null===(c=b.data)||void 0===c||null===(s=c.content)||void 0===s||null===(d=s.nodes)||void 0===d||null===(f=d[0])||void 0===f||null===(g=f.body)||void 0===g||null===(m=g.atlas_doc_format)||void 0===m||null===(h=m.mediaToken)||void 0===h?void 0:h.token)||"",config:(null==b||null===(p=b.data)||void 0===p?void 0:p.mediaConfiguration)||{}}},54e4),b=e=>async()=>{const t=await e();return{token:t.token||"",clientId:t.config.clientId||"",baseUrl:t.config.fileStoreUrl||""}},v=async e=>{var t,n,o,a,i,r,c;const s=await u(e),{clientId:l="",fileStoreUrl:d=""}=(null==s||null===(t=s.data)||void 0===t?void 0:t.mediaConfiguration)||{};return{clientId:l,token:(null==s||null===(n=s.data)||void 0===n||null===(o=n.content)||void 0===o||null===(a=o.nodes)||void 0===a||null===(i=a[0])||void 0===i||null===(r=i.body)||void 0===r||null===(c=r.atlas_doc_format)||void 0===c?void 0:c.mediaToken.token)||"",baseUrl:d||""}},y=Object(g.a)(async e=>{var t,n;const o=await f(e.contentId),a=(null==o||null===(t=o.data)||void 0===t?void 0:t.contentMediaSession)||{};return{token:(null==a||null===(n=a.token)||void 0===n?void 0:n.value)||"",config:(null==a?void 0:a.configuration)||{},collectionId:(null==a?void 0:a.collection)||""}},54e4),I=Object(g.a)(async e=>{var t,n;const o=await f(e.contentId),a=(null==o||null===(t=o.data)||void 0===t?void 0:t.contentMediaSession)||{},i=(null==a||null===(n=a.configuration)||void 0===n?void 0:n.fileStoreUrl)||"",r=(null==a?void 0:a.mediaPickerUserToken)||{};return{token:r.token||"",config:{fileStoreUrl:i,clientId:r.id||""}}},354e4),w=async e=>(await y.getValue(e)).collectionId,k=async e=>({authProvider:b(()=>y.getValue(e)),userAuthProvider:b(()=>I.getValue(e)),getAuthFromContext:v}),T=async e=>({authProvider:b(async()=>{let t=await p.getValue(e);return t.token||(t=await p.forceGetValue(e)),t}),getAuthFromContext:v}),O=async e=>({viewMediaClientConfig:await T(e)}),j=async e=>{C(e);const[t,n,o]=await Promise.all([T(e),k(e),w(e)]);return{viewMediaClientConfig:t,uploadParams:{collection:o},uploadMediaClientConfig:n}};let S;const C=e=>{S&&o.a.off("file-added",S),S=h(e),o.a.on("file-added",S)}},"82Bo":function(e,t,n){"use strict";var o=n("Czhu"),a=n("HbGN"),i=n("Iy7w"),r=n("ERkP"),c=n.n(r),s=n("L21V"),l=n("lZoD"),d=n("H5Ms"),u=n("bU5Q"),f=n("Tos6"),g=n("kvU/"),m=n("3IV/"),h=n("a0gl"),p=n("daKX"),b=n("bR0+"),v=n("frZf"),y=n("Ua4J"),I=n("+mzV"),w=n("qhEF"),k=n("WWAs"),T=n("v5SA"),O=n("1Y1u"),j=n("rGGD"),S=n("8TdO"),C=n("H5qd");const x=n.n(C).a`mutation SetTaskStatusMutation($contentId:ID!$taskId:ID!$status:TaskStatus!){setTaskStatus(inlineTasksInput:{cid:$contentId taskId:$taskId status:$status trigger:VIEW_PAGE}){success}}`,E=Object(s.g)({flagTitle:{id:"fabric-media-support.tasklist.error.flag.title",description:"Flag title to inform user that an attempt to toggle a tasklist checkbox failed",defaultMessage:"Something went wrong"},flagDescription:{id:"fabric-media-support.tasklist.error.flag.description",description:"Flag description to inform user that an attempt to toggle a tasklist checkbox failed",defaultMessage:"An error occurred while trying to change a task's status. Please try again later."}});class P{constructor(e,t,n){this.intl=e,this.flags=t,this.contentId=n}toggleTask(e,t){return Object(S.getApolloClient)().mutate({mutation:x,variables:{contentId:this.contentId,taskId:e.localId,status:"DONE"===t?"CHECKED":"UNCHECKED"}}).then(e=>{var n;return(null!=(n=e)&&null!=(n=n.data)&&null!=(n=n.setTaskStatus)?n.success:n)||!1||this.showErrorFlag(),t}).catch(e=>{this.showErrorFlag()})}showErrorFlag(){this.flags.showErrorFlag({title:this.intl.formatMessage(E.flagTitle),description:this.intl.formatMessage(E.flagDescription)})}notifyRecentUpdates(e){}subscribe(e,t){}unsubscribe(e,t){}unsubscribeRecentUpdates(e){}}const M=new(n("Cvqa").b)({url:"/gateway/api/directory/graphql",cacheSize:100,cacheMaxAge:3e5});var U=n("S+bX"),$=n("gIJ9"),H=n("TU9K"),A=n("Cwwk"),N=n("JncL");n.d(t,"a",(function(){return F}));Object(p.a)("ADFRenderer");const D=Object(i.a)("div",{target:"exyfvr00"})('div[mode="stick"]{z-index:1;background:#fff;}span{&.inline-highlight{cursor:pointer;background-color:',m.Y50,";border-bottom:2px solid ",m.Y100,";&.active-highlight{background-color:",m.Y75,";border-bottom:2px solid ",m.Y200,";box-shadow:0 2px 2px ",m.N50,";}}&.inline-create-comment-selection{background-color:",m.Y75,";border-bottom:2px solid ",m.Y200,";box-shadow:0 2px 2px ",m.N50,";}}"),F=Object(s.h)(Object(r.memo)(e=>{const{document:t,featureFlags:n,dataProviders:i,extensionHandlers:s={},getExtensionHandlers:m=(()=>({})),eventHandlers:p,appearance:S="comment",allowDynamicTextSizing:C=!0,adfStage:x="stage0",portalRef:E,onComplete:F,onRendered:B,renderWhenReady:R,allowStickyHeaders:L=!0}=e,q=Object(a.a)(e,["document","featureFlags","dataProviders","extensionHandlers","getExtensionHandlers","eventHandlers","appearance","allowDynamicTextSizing","adfStage","portalRef","onComplete","onRendered","renderWhenReady","allowStickyHeaders"]),V=Object(A.a)();Object(r.useEffect)(()=>(t&&n&&n["confluence.frontend.fabric.fire-event-media"]&&Object(N.a)(),B&&B(),()=>{t&&n&&n["confluence.frontend.fabric.fire-event-media"]&&Object(N.b)()}),[e.contentId]);const{isExternalShareRequest:_}=Object(r.useContext)(H.a),z=Object(r.useCallback)(({contentId:t,spaceKey:n,push:o,cloudId:a,userId:i,flags:r},c)=>{const{getDataProviders:s,intl:l}=e,d={};s&&Object.assign(d,s()),t&&(d.mediaProvider=Object(O.b)({contentId:t,isExternalShare:_})),a&&i&&(d.mentionProvider=Object(j.a)(a,i).then(e=>e.mentionResource).catch(e=>Promise.reject())),t&&(d.taskDecisionProvider=Promise.resolve(new P(l,r,t))),a&&(d.emojiProvider=Object(U.a)(f.a,{cloudId:a,source:"view"}),V&&(d.profilecardProvider=function(e,t){return Promise.resolve({cloudId:e,resourceClient:M,getActions:t})}(a,(t=>n=>{const{intl:o}=e;return[{label:o.formatMessage({id:"view.profile"}),callback:()=>{t(Object(b.a)(n,null,v.a))}}]})(o)))),t&&n&&(d.contextIdentifierProvider=Promise.resolve({containerId:n,objectId:t,product:"confluence"})),d.cardProvider=Promise.resolve(new $.a);if(Object.keys(d).length){c=c||g.a.create({});for(const e of Object.keys(d))c.setProvider(e,d[e])}return c},[e.getDataProviders,e.intl]),{push:J}=Object(r.useContext)(y.a),{spaceKey:K,contentId:Y}=Object(r.useContext)(I.a),{cloudId:Q,userId:G}=Object(h.a)();let W=s;m&&(W=Object.assign(m(),s));const X=n&&n["confluence.frontend.fabric.renderer.table.sorting"],Z=n&&n["confluence.frontend.fabric.renderer.heading.anchor"],ee=n&&n["confluence.frontend.fabric.editor.media.linking"],te=n&&n["confluence.frontend.fabric.renderer.sticky-headers"]&&"mobile"!==S&&L,ne=n&&n["confluence.frontend.open.expand.when.following.link"],oe=n&&n["confluence.frontend.fabric.renderer-spec-based-validator"],ae=!!n&&!!n["confluence.frontend.fabric.editor.codeblock.copy"];return t?c.a.createElement(D,null,c.a.createElement(l.c,{to:[w.a,k.a,T.a]},(n,a,r)=>{const s=a.getTotalHeight()+r.getFloatingHeight();return c.a.createElement(u.d,null,c.a.createElement(d.a,Object(o.a)(Object(o.a)({enableSsrInlineScripts:Boolean(!1),adfStage:x,document:t,appearance:S,allowDynamicTextSizing:C,stickyHeaders:te&&{offsetTop:s},extensionHandlers:W,eventHandlers:p,dataProviders:z({spaceKey:K,contentId:e.contentId?e.contentId:Y,push:J,cloudId:Q,userId:G,flags:n},i),portal:E||void 0,onComplete:F,allowColumnSorting:X,allowHeadingAnchorLinks:ne?{allowNestedHeaderLinks:Z,activeHeadingId:e.queryHash}:Z,allowAltTextOnImages:!0,media:{allowLinking:ee},allowCopyToClipboard:ae},q),{},{useSpecBasedValidator:oe})),R&&R())})):null}))},CSQs:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("nnRT"),a=n.n(o);const i=[-1/0,null,null],r=(e,t)=>{const n={};function o(o,r){const c=Date.now();let s="";try{s=JSON.stringify(o)}catch(f){0}const[l,d,u]=n[s]||i;if(r||l+t<=c||!a()(d,o)){const t=e(o);return n[s]=[c,o,t],t}return u}return{forceGetValue:e=>o(e,!0),getValue:e=>o(e,!1)}}},JncL:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var o=n("/dP/");const a=e=>{if(!e.isUserCollection)return fetch("/wiki/rest/internal/1.0/eventnotifier/notify",{method:"POST",body:JSON.stringify({attachmentViewed:{fileStoreId:e.fileId}}),headers:{"Content-Type":"application/json"}})},i=()=>{o.a.on("media-viewed",a)},r=()=>{o.a.off("media-viewed",a)}},"S+bX":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var o=n("pFSi"),a=n.n(o),i=n("daKX");Object(i.a)("emoji-provider");const r="/gateway/api/emoji",c=a()((e,t)=>{var n,o;const a=((e,t)=>{const n={providers:[{url:r+"/standard"},{url:r+"/atlassian"}],allowUpload:!0,currentUser:t?{id:t}:void 0};return e&&n.providers.push({url:`${r}/${e}/site`}),n})(null!==(n=null==t?void 0:t.cloudId)&&void 0!==n?n:"",null!==(o=null==t?void 0:t.userId)&&void 0!==o?o:void 0);let i;try{i=new e(a)}catch(c){0}return Promise.resolve(i)},(e,t)=>{var n,o;return`${null!==(n=null==t?void 0:t.cloudId)&&void 0!==n?n:""}_${null!==(o=null==t?void 0:t.source)&&void 0!==o?o:""}`})},gIJ9:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n("bU5Q"),a=n("8TdO"),i=n("KIs4");class r extends o.c{async resolve(e){let t=!1;try{const{featureFlags:e}=await Object(i.b)(Object(a.getApolloClient)());t=Boolean(e["confluence.frontend.fabric.editor.smartcards"])}catch(n){console.error("Error while trying to obtain Feature Flag",n)}return t&&super.resolve(e,"inline")}}},kVVw:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var o=n("zjfJ"),a=n("xV3C"),i=n("pL3m"),r=n("MjPE"),c=n("8TdO"),s=n("KIs4"),l=n("kC4U");class d extends a.c{constructor(e,t,n){super(t),Object(o.a)(this,"userTeamEndpoint",void 0),Object(o.a)(this,"teamMentionConfig",void 0),this.teamMentionConfig=n,this.userTeamEndpoint=e}async remoteInitialState(e){try{const t=await this.doSearch("",e);return this._notifyAnalyticsListeners(i.c,"initialState","succeeded"),t}catch(t){throw this._notifyAnalyticsListeners(i.c,"initialState","failed"),t}}async remoteSearch(e,t){try{const n=await this.doSearch(e,t);return this._notifyAnalyticsListeners(i.c,"searchUser","succeeded"),n}catch(n){throw this._notifyAnalyticsListeners(i.c,"searchUser","failed"),n}}mentionTypeaheadHighlightEnabled(){return this.teamMentionConfig.teamHighlightEnabled||!1}mentionTypeaheadCreateTeamPath(){return this.teamMentionConfig.createTeamPath}async doSearch(e,t){const n=await this.post(await this.cloudId(),e,t);if(!n.ok){const e=await n.json();throw new Error(JSON.stringify(e))}return{query:e,mentions:(await n.json()).recommendedUsers.map(e=>this.isUser(e)?this.convertToUserMention(e):(this.isTeam(e),this.convertToTeamMention(e)))}}async cloudId(){const e=await Object(s.b)(Object(c.getApolloClient)()),{cloudId:t}=e;return t}async post(e,t,n){return await Object(l.a)(this.userTeamEndpoint,{method:"POST",headers:{"content-type":"application/json"},credentials:"include",body:JSON.stringify({context:{contextType:"Mentions",principalId:"context",productKey:n&&n.product||"confluence",siteId:e,containerId:n&&n.containerId,objectId:n&&n.objectId,childObjectId:n&&n.childObjectId,mentionsSessionId:n&&n.sessionId},searchQuery:{queryString:t},maxNumberOfResults:20,includeTeams:!0})})}isUser(e){return"USER"===e.entityType}convertToUserMention(e){return{id:e.id,name:e.name||e.nickname||"",mentionName:e.nickname||"",avatarUrl:e.avatarUrl,accessLevel:e.accessLevel,userType:e.userType}}isTeam(e){return"TEAM"===e.entityType}convertToTeamMention(e){const{teamLinkResolver:t}=this.teamMentionConfig;let n="";const o=`${window.location.origin}/people/team/${e.id}`;return"function"==typeof t&&(n=t(e.id)),{id:e.id,name:e.displayName,mentionName:e.displayName,avatarUrl:e.smallAvatarImageUrl,accessLevel:r.c[r.c.CONTAINER],userType:r.d[r.d.TEAM],context:{members:e.members,includesYou:e.includesYou,memberCount:e.memberCount,teamLink:n||o}}}}},rGGD:function(e,t,n){"use strict";var o=n("KIs4"),a=n("8TdO"),i=n("mn6t"),r=n("kQ1B"),c=n("frZf"),s=n("kVVw");async function l(e,t,n){const r={url:"/gateway/api/mentions/"+e,productId:"micros-group/confluence",containerId:t||void 0,shouldHighlightMention:e=>e.id===n},l=await Object(o.b)(Object(a.getApolloClient)()),{featureFlags:d}=l,u=d["confluence.frontend.people.directory"]?c.a:"",f={url:"/gateway/api/teams/mentions",productId:"micros-group/confluence",shouldHighlightMention:e=>e.id===n,teamHighlightEnabled:Boolean(d["confluence.frontend.fabric.editor.team.mention.spotlight"]),createTeamPath:u+"/people/search#createTeam"};return d["confluence.frontend.fabric.editor.userteam.mention"]?function(e,t){return new s.a("/gateway/api/v1/recommendations",e,t)}(r,f):new i.a(r,f)}function d(e,t,n){return async function(e,t,n){var o;if(!e)throw new Error("MentionResource cannot be configured without a cloud id");const a=(null!=(o=n)?o.spaceId:o)||void 0;return{mentionResource:await l(e,a,t),presenceResource:new r.a({url:"/gateway/api/directory/graphql",cloudId:e,productId:"confluence"})}}(e,t,n)}n.d(t,"a",(function(){return d}))},v5SA:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var o=n("Czhu"),a=n("zjfJ"),i=n("lZoD"),r=n("WWAs");class c extends i.a{constructor(...e){super(...e),Object(a.a)(this,"state",{floatingBanners:[]}),Object(a.a)(this,"showFloating",(e,t)=>{const n=Object(r.b)(e,this.state.floatingBanners);-1===n?this.setState(n=>{const a=[...n.floatingBanners];return a.push({name:e,height:t}),Object(o.a)(Object(o.a)({},n),{},{floatingBanners:a})}):this.state.floatingBanners[n].height!==t&&this.setState(e=>{const a=[...e.floatingBanners];return a[n].height=t,Object(o.a)(Object(o.a)({},e),{},{floatingBanners:a})})}),Object(a.a)(this,"hideFloating",e=>{const t=Object(r.b)(e,this.state.floatingBanners);t>-1&&this.setState(e=>{const n=[...e.floatingBanners];return n.splice(t,1),Object(o.a)(Object(o.a)({},e),{},{floatingBanners:n})})}),Object(a.a)(this,"getFloatingHeightBefore",e=>{const t=Object(r.b)(e,this.state.floatingBanners);return-1===t?0:this.state.floatingBanners.slice(0,t).reduce((e,t)=>e+t.height,0)}),Object(a.a)(this,"getFloatingHeight",()=>this.state.floatingBanners.reduce((e,t)=>e+t.height,0))}}}}]);
//# sourceMappingURL=26.P87NyLp6Wg.js.map