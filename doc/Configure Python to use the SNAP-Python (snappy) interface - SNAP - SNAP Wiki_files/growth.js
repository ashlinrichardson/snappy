(window.webpackJsonp=window.webpackJsonp||[]).push([["growth.persistent.upgrade.banner~b59ad437"],{"5GRl":function(e,t,n){"use strict";n.r(t);var a=n("ERkP"),r=n.n(a),i=n("L21V"),o=n("lPJD"),c=n("cphC"),s=n("xkEZ"),l=n("X2PC"),d=n("TSpG"),u=n("HKB3"),p=n("Uo/y"),f=n("LEcB"),h=n("+352"),b=n("ZVKf"),g=n.n(b),E=n("psri"),O=n.n(E),v=n("oayO"),m=n("mvtW"),w=n("vyNa");const T=(e,t,n=!1)=>{if(t>0&&n||t<=0&&!n)return-1;const a=e.findIndex(e=>n?-1*t<e:t>e);return-1===a?e.length-1:a-1},I=e=>{const t=h.g[e];switch(e){case h.v.TRIAL:return{bannerIds:h.q,cadenceLengths:h.r,editionKey:t};case h.v.POST_TRIAL:return{bannerIds:h.m,cadenceLengths:h.n,editionKey:t};case h.v.PRE_TRIAL:default:return{bannerIds:h.o,cadenceLengths:h.p,editionKey:t}}},j=(e,t)=>{const{bannerIds:n,editionKey:a}=I(e),r=((e,t)=>{const{cadenceLengths:n}=I(e);switch(e){case h.v.TRIAL:return T(n,t,!1);case h.v.POST_TRIAL:return T(n,t,!0);case h.v.PRE_TRIAL:default:return 0}})(e,t);try{const e=v.a.getItem(a);if(e){const{cadence:t}=JSON.parse(e);if("number"==typeof t&&t>=0&&t<n.length)return Math.max(t,r)}}catch(i){}return r},R=e=>{g()(h.v,t=>{if(t!==e&&t!==h.v.DEFAULT){const e=h.g[t];e&&v.a.removeItem(e)}})},y=(e,t,n,a)=>{if(!e)return null;const r=O()(e.toString().toLowerCase());switch(t){case h.v.PRE_TRIAL:return(e=>{const t=j(h.v.PRE_TRIAL,0);return{bannerId:h.o[t],flowId:h.M,openUpflowOnClick:!0,linkText:e(h.C[t]),linkHref:h.S,linkTarget:"",upflowFlow:h.y,upgradeTargetEdition:m.a.STANDARD}})(a);case h.v.TRIAL:return((e,t,n)=>{const a=j(h.v.TRIAL,t),r=h.q[a];let i=h.I[a];return i===h.t&&(i=Object(w.a)(r)),{flowId:h.G[a],openUpflowOnClick:!1,linkText:n(h.H[a]),linkTarget:h.J[a],upflowFlow:"",upgradeTargetEdition:e,bannerId:r,linkHref:i}})(e,n,a);case h.v.POST_TRIAL:return((e,t,n,a)=>{const r=j(h.v.POST_TRIAL,n),i=h.m[r],o=Object(w.a)(i);return{flowId:h.s,openUpflowOnClick:!1,linkText:a(h.z[r],{edition:t}),linkTarget:"_self",upflowFlow:"",upgradeTargetEdition:e,bannerId:i,linkHref:o}})(e,r,n,a)}return null};var C=n("Czhu"),x=n("nnm9"),L=n.n(x),k=n("KsTJ"),S=n("lZoD"),A=n("RjSO"),P=n("WCbN"),N=n.n(P),D=n("3IV/"),U=n("WWAs"),_=n("mTU2"),F=n("kH24"),$=n("OOEx"),M=n.n($),B=n("XERu"),H=n("zfsr");const W=k.default.a`
  color: ${D.N0};
  text-decoration: underline;
  cursor: pointer;
  white-space: nowrap;
  &:hover {
    color: ${D.N0};
  }
`,K=Object(i.h)(({bannerId:e,flowId:t,upflowFlow:n,upgradeTargetEdition:i,openUpflowOnClick:o,linkText:c,linkHref:s,linkTarget:l})=>{const{createAnalyticsEvent:d}=Object(A.a)(),{showUpFlow:u,currentEdition:p}=Object(a.useContext)(H.a),f=()=>d(Object(B.b)({eventAction:"clicked",touchpointSubject:h.E,currentEdition:p,touchpointId:e,flowId:t})).fire();return r.a.createElement(a.Fragment,null,o?r.a.createElement(W,{"data-testid":"persistent-upgrade-banner-upflow-link",onClick:()=>{n&&i&&(f(),u({touchpointId:e,flow:n,targetEdition:i}))}},c):r.a.createElement(W,{"data-testid":"persistent-upgrade-banner-ahref-link",href:s,onClick:f,target:l},c))}),z=k.default.div`
  margin: 0 50px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
`;function J(e){e&&(e.style.overflow="hidden",e.firstElementChild&&(e.firstElementChild.style.paddingTop="0px",e.firstElementChild.style.paddingBottom="0px"))}const G=Object(i.h)(({editionTrialType:e,trialEndDate:t,trialDaysLeft:n,bannerId:i,flowId:o,upflowFlow:c,upgradeTargetEdition:s,openUpflowOnClick:l,linkText:d,linkHref:u,linkTarget:p,intl:f})=>{const{createAnalyticsEvent:b}=Object(A.a)(),{currentEdition:g}=Object(a.useContext)(H.a),E=((e,t,n,a=0,r)=>{const i=O()(e.toString().toLowerCase()),o=j(t,a),c=Object(w.b)(n);switch(t){case h.v.PRE_TRIAL:return r(h.D[o]);case h.v.TRIAL:return r(h.L[o],{edition:i,date:c,daysLeft:a});case h.v.POST_TRIAL:return r(h.B[o],{edition:i,date:c})}return""})(g,e,t,n,f.formatMessage);return Object(a.useEffect)(()=>{b(Object(B.b)({eventAction:"viewed",touchpointSubject:h.E,currentEdition:g,touchpointId:i,flowId:o})).fire()},[b,g,i,o]),r.a.createElement(z,null,r.a.createElement(F.a,{innerRef:J,appearance:e===h.v.POST_TRIAL?"warning":"announcement",icon:e===h.v.POST_TRIAL?r.a.createElement(M.a,{label:"Warning icon",secondaryColor:"inherit"}):r.a.createElement("div",null),isOpen:!0},E,"Â ",r.a.createElement(K,{bannerId:i,flowId:o,upflowFlow:c,upgradeTargetEdition:s,openUpflowOnClick:l,linkText:d,linkHref:u,linkTarget:p})))});var X=n("xCqd");const Z=k.default.div`
  width: 100%;
  padding: 0px;
  box-sizing: border-box;
  height: ${32}px;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: ${e=>e.theme.backgroundColor};
`,q=k.default.div`
  height: 24px;
  width: 24px;
  cursor: pointer;
  position: absolute;
  right: 10px;
  background-color: ${e=>e.theme.backgroundColor};
  color: ${e=>e.theme.closeColor};
  &:hover {
    color: ${e=>e.theme.hoverColor};
  }
`,V={backgroundColor:D.N500,closeColor:D.N0,hoverColor:D.N90},Y={backgroundColor:D.Y300,closeColor:D.N700,hoverColor:D.N90},Q=Object(i.h)(({onBannerDismiss:e=L.a,onExperimentEnrolled:t=L.a,intl:{formatMessage:n}})=>{const[o,c]=Object(a.useState)(!1),{createAnalyticsEvent:s}=Object(A.a)(),{cloudId:l,currentEdition:d}=Object(a.useContext)(H.a),{isTargetAudience:u,editionTrialType:p,trialEndDate:f,trialDaysLeft:b}=Object(X.a)(l,d);if(!u||p===h.v.DEFAULT)return null;if(!t(p,b))return null;const g=y(d,p,b,n);if(!g)return null;let E=V;return p===h.v.POST_TRIAL&&(E=Y),o?null:r.a.createElement(S.c,{to:[U.a]},t=>(t.show("PersistentUpgradeBanner",32),r.a.createElement(Z,{theme:E},r.a.createElement(G,Object(C.a)({editionTrialType:p,trialEndDate:f,trialDaysLeft:b},g)),r.a.createElement(q,{"data-testid":"BannerCloseButton",theme:E,onClick:()=>{c(!0),e(p,b),s(Object(B.b)({eventAction:"dismissed",touchpointSubject:h.E,currentEdition:d,touchpointId:g.bannerId,flowId:g.flowId})).fire(),t.hide("PersistentUpgradeBanner")}},r.a.createElement(i.c,Object(C.a)({},_.a.persistentUpgradeBannerCloseLabel),e=>r.a.createElement(N.a,{label:e}))))))});n.d(t,"PersistentUpgradeBannerComponent",(function(){return ee})),n.d(t,"PersistentUpgradeBannerWrapper",(function(){return te})),n.d(t,"PersistentUpgradeBanner",(function(){return ne}));const ee=({coordinationClient:e})=>{const{cohort:t,fireExposureEvent:n}=Object(f.a)(d.a.PERSISTENT_UPGRADE,u.b,u.a.NOT_ENROLLED),i=Object(a.useCallback)((e,a)=>!(t===u.a.EXPERIMENT&&!((e,t=0)=>{const{cadenceLengths:n,editionKey:a}=I(e);if(a)try{if(!v.a.doesContain(a))return!0;{const{cadence:r,showAfter:i}=JSON.parse(v.a.getItem(a));switch(e){case h.v.PRE_TRIAL:return i<=Date.now();case h.v.POST_TRIAL:return r<=T(n,t,!0);case h.v.TRIAL:return r<=T(n,t);default:return!1}}}finally{R(e)}return!1})(e,a))&&(n(),t===u.a.EXPERIMENT),[t,n]),c=Object(a.useCallback)((e,t)=>{((e,t)=>{const{bannerIds:n,cadenceLengths:a,editionKey:r}=I(e);if(r){const i=j(e,t),o=e===h.v.POST_TRIAL?i+1:Math.min(i+1,n.length-1),c={cadence:o};e===h.v.PRE_TRIAL&&(c.showAfter=Date.now()+a[o]),v.a.setItem(r,JSON.stringify(c))}})(e,t)},[]);return t===u.a.NOT_ENROLLED?null:r.a.createElement(o.a,{client:e,messageId:h.l},r.a.createElement(Q,{onBannerDismiss:c,onExperimentEnrolled:i}))},te=({coordinationClient:e,intl:{locale:t}})=>{const{cloudId:n,currentEdition:i,isSiteAdmin:o}=Object(a.useContext)(H.a);return o&&Object(p.a)(t)&&i&&n?r.a.createElement(ee,{coordinationClient:e}):null},ne=Object(i.h)(Object(s.b)({attribution:l.a.GROWTH_UPFLOW})(Object(c.a)(te)))},D49j:function(e,t,n){var a=n("zWgn");e.exports=function(e){return"function"==typeof e?e:a}},"Uo/y":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=e=>{let t=!0,n=!0;return e&&(t=-1!==e.toLowerCase().indexOf("en",0)),navigator&&(n=navigator.language.includes("en")),n&&t}},WCbN:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("ERkP")),r=i(n("4KTy"));function i(e){return e&&e.__esModule?e:{default:e}}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var c=function(e){return a.default.createElement(r.default,o({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M15.185 7.4l-3.184 3.185-3.186-3.186a.507.507 0 0 0-.712.003l-.7.701a.496.496 0 0 0-.004.712l3.185 3.184L7.4 15.185a.507.507 0 0 0 .004.712l.7.7c.206.207.516.2.712.004l3.186-3.185 3.184 3.185a.507.507 0 0 0 .712-.004l.701-.7a.496.496 0 0 0 .003-.712l-3.186-3.186 3.186-3.184a.507.507 0 0 0-.003-.712l-.7-.7a.508.508 0 0 0-.36-.153.5.5 0 0 0-.353.15z" fill="currentColor" fill-rule="evenodd"/></svg>'},e))};c.displayName="EditorCloseIcon";var s=c;t.default=s},WWAs:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return s}));var a=n("Czhu"),r=n("zjfJ"),i=n("lZoD"),o=n("+FBq");const c=(e,t)=>t.indexOf(t.filter(t=>t.name===e)[0]);class s extends i.a{constructor(...e){super(...e),Object(r.a)(this,"state",{banners:[],isTopNavEnabled:!1}),Object(r.a)(this,"_updateServerRenderedBanners",e=>{0===e?this.hide("ServerRenderedBanners"):this.show("ServerRenderedBanners",e)}),Object(r.a)(this,"setTopNavEnabled",e=>{this.state.isTopNavEnabled!==e&&this.setState(t=>Object(a.a)(Object(a.a)({},t),{},{isTopNavEnabled:e}))}),Object(r.a)(this,"show",(e,t)=>{const n=c(e,this.state.banners);-1===n?this.setState(n=>{const r=[...n.banners];return r.push({name:e,height:t}),Object(a.a)(Object(a.a)({},n),{},{banners:r})}):this.state.banners[n].height!==t&&this.setState(e=>{const r=[...e.banners];return r[n].height=t,Object(a.a)(Object(a.a)({},e),{},{banners:r})})}),Object(r.a)(this,"hide",e=>{const t=c(e,this.state.banners);t>-1&&this.setState(e=>{const n=[...e.banners];return n.splice(t,1),Object(a.a)(Object(a.a)({},e),{},{banners:n})})}),Object(r.a)(this,"getTotalHeight",e=>{const t=this.state.isTopNavEnabled&&!1!==(e&&e.includeTopNav);return this.state.banners.reduce((e,t)=>e+t.height,t?o.c:0)})}}},XERu:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var a=n("+352");const r=(e,t,n)=>({currentEdition:e,touchpointId:t,flowId:n,growthExperiment:a.u}),i=({eventAction:e,touchpointSubject:t,currentEdition:n,touchpointId:i,flowId:o})=>({type:"sendUIEvent",data:{action:e,actionSubject:t,source:a.u,attributes:r(n,i,o)}}),o=({error:e})=>({type:"sendOperationalEvent",data:{source:a.u,action:"failed",actionSubject:"apiCall",actionSubjectId:"getEditionDetails",attributes:{growthExperiment:a.u,errorStatus:e.status,errorMessage:e.message}}})},ZVKf:function(e,t,n){var a=n("UdtX"),r=n("D49j"),i=n("zH+d");e.exports=function(e,t){return null==e?e:a(e,r(t),i)}},kH24:function(e,t,n){"use strict";var a=n("ERkP"),r=n.n(a),i=n("KsTJ"),o=n("3IV/"),c=n("w301"),s=n("BMbf"),l=n("ZgvQ");const d=Object(c.a)("appearance",{error:{light:o.R400,dark:o.R300},warning:{light:o.Y300,dark:o.Y300},announcement:{light:o.N500,dark:o.N500}}),u=i.default.div`
  max-height: ${({appearance:e})=>"announcement"===e?"88px":"52px"};
  overflow: ${({appearance:e})=>"announcement"===e?"scroll":"visible"};
  background-color: ${d};
`,p=(o.R400,o.N0,Object(c.a)("appearance",{error:{light:o.N0,dark:o.DN40},warning:{light:o.N700,dark:o.DN40},announcement:{light:o.N0,dark:o.N0}})),f=i.default.div`
  align-items: center;
  background-color: ${d};
  color: ${p};
  display: flex;
  fill: ${d};
  font-weight: 500;
  justify-content: center;
  padding: ${Object(l.multiply)(s.h,1.5)}px;
  text-align: center;
  ${""}

  margin: auto;
  ${({appearance:e})=>"announcement"===e?"max-width: 876px;":""} transition: color ${"0.25s ease-in-out"};

  a,
  a:visited,
  a:hover,
  a:active,
  a:focus {
    color: ${p};
    text-decoration: underline;
  }
`,h=i.default.span`
  align-items: center;
  display: flex;
  flex-direction: column;
  flex: 0 0 auto;
`,b=i.default.div`
  max-height: ${e=>e.isOpen?e.bannerHeight:0}px;
  overflow: hidden;
  transition: max-height ${"0.25s ease-in-out"};
`,g=i.default.span`
  flex: 0 1 auto;
  padding: ${Object(l.divide)(s.h,2)}px;
  ${({appearance:e})=>"announcement"===e?"":i.css`
        text-overflow: ellipsis;
        white-space: nowrap;
      `};
  overflow: hidden;
`;class E extends r.a.Component{constructor(){super(...arguments),this.state={height:0},this.getHeight=()=>{this.containerRef&&this.setState({height:this.containerRef.clientHeight})},this.innerRef=e=>{this.containerRef=e,this.props.innerRef&&this.props.innerRef(e),this.getHeight()}}render(){const{appearance:e,children:t,icon:n,isOpen:a,testId:i}=this.props;return r.a.createElement(b,{bannerHeight:this.state.height,isOpen:a},r.a.createElement(u,{innerRef:this.innerRef,appearance:e,"aria-hidden":!a,role:"alert","data-testid":i},r.a.createElement(f,{appearance:e},r.a.createElement(h,null,n),r.a.createElement(g,{appearance:e},t))))}}E.defaultProps={appearance:"warning",isOpen:!1};t.a=E},mvtW:function(e,t,n){"use strict";let a;n.d(t,"a",(function(){return a})),function(e){e.FREE="FREE",e.PREMIUM="PREMIUM",e.STANDARD="STANDARD"}(a||(a={}))},vyNa:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));var a=n("+352");const r=e=>new Date(e).toLocaleString("default",{month:"long",day:"numeric"}),i=e=>{const t=window.location.href,n={flow:a.x,product:a.N.CONFLUENCE,backPath:t,sourceScreen:e};return"/admin/upflow/paymentDetails?"+(r=n,Object.keys(r).map(e=>`${encodeURIComponent(e)}=${encodeURIComponent(r[e])}`).join("&"));var r}},xCqd:function(e,t,n){"use strict";var a=n("Czhu"),r=n("ERkP"),i=n("RjSO"),o=n("mvtW"),c=n("+352"),s=n("lSUb"),l=n("kC4U");const d=Object(s.a)(e=>e?new Promise(async(t,n)=>{try{const{hasPaymentMethod:n,entitlements:a}=await(async e=>{const t=await Object(l.a)("/gateway/api/growth/persistent-upgrade/upgrades/edition-details/cloudId/"+e,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});return await t.json()})(e);let r;a&&a.length&&(r=a.find(e=>e.product===c.N.CONFLUENCE)),t(r?{hasPaymentMethod:!!n,isTrial:r.isTrial,trialEndDate:r.trialEndDate,trialDaysLeft:r.trialDaysLeft}:{hasPaymentMethod:!!n,isTrial:!1,trialEndDate:"",trialDaysLeft:0})}catch(a){n({status:a.response?a.response.status:a.status,message:a.message})}}):Promise.reject({message:"No cloudId supplied"}));var u=n("XERu");n.d(t,"a",(function(){return f}));const p={isTargetAudience:!1,trialEndDate:"",trialDaysLeft:0,editionTrialType:c.v.DEFAULT},f=(e,t)=>{const[n,s]=Object(r.useState)(p),{createAnalyticsEvent:l}=Object(i.a)();return Object(r.useEffect)(()=>{t===o.a.FREE?s(Object(a.a)(Object(a.a)({},p),{},{isTargetAudience:!0,editionTrialType:c.v.PRE_TRIAL})):d(e).then(e=>{const{hasPaymentMethod:t,isTrial:n,trialEndDate:a,trialDaysLeft:r}=e;!t&&n&&a&&s({isTargetAudience:!0,trialEndDate:a,trialDaysLeft:r,editionTrialType:r>0?c.v.TRIAL:c.v.POST_TRIAL})},e=>{l(Object(u.a)({error:e})).fire()})},[e,t,l]),n}},zfsr:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return f}));var a=n("ERkP"),r=n.n(a),i=n("1U1M"),o=n("w7pu"),c=n("fDrt"),s=n("X2PC"),l=n("6n9r"),d=n("t0Ff"),u=n("FdbS");const p=Object(a.createContext)({shouldShow:!1,isSiteAdmin:!1,cloudId:"",currentEdition:void 0,showUpFlow:()=>{},hideUpFlow:()=>{}}),f=({children:e})=>{const[t,n]=Object(a.useState)(!1),[f,h]=Object(a.useState)(""),[b,g]=Object(a.useState)(),[E,O]=Object(a.useState)(),[v,m]=Object(a.useState)(""),{isSiteAdmin:w,tenantId:T}=Object(a.useContext)(o.a),{data:I}=Object(i.d)(d.a,{}),j=()=>n(!1);Object(a.useEffect)(()=>{g(Object(l.a)(I))},[I]);const R={shouldShow:t,isSiteAdmin:w,cloudId:T,currentEdition:b,showUpFlow:({touchpointId:e,targetEdition:t,flow:a})=>{h(e),O(t),m(a),n(!0)},hideUpFlow:j};return r.a.createElement(p.Provider,{value:R},e,t&&E&&v?r.a.createElement(c.a,{attribution:s.a.GROWTH_UPFLOW},r.a.createElement(u.a,{canChangeEdition:w,cloudId:T,currentEdition:b,flow:v,product:"confluence",targetEdition:E,touchpointId:f,onClose:j,onOpen:()=>{},epMessageId:"upflow-confluence-persistent-upgrade"})):null)},{Consumer:h}=p}}]);
//# sourceMappingURL=growth.persistent.upgrade.banner~b59ad437.DvNZYYeLoA.js.map