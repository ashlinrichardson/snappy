(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{yLoQ:function(e,t,n){"use strict";var o=n("ERkP"),r=n.n(o),a=(n("aWzz"),n("gQ5V")),s=n("KIs4"),i=n("Dsoe"),l=n("3VMZ"),c=n("FdGg"),u=n("X2PC"),d=n("zjfJ"),m=n("KsTJ"),p=n("MV18"),k=n("u6In"),g=n("H5qd"),h=n.n(g);const f=h.a`query LikeSummaryQuery($contentId:ID!$contentType:String!){user(current:true){id}tenant{cloudId}content(id:$contentId type:$contentType){nodes{id likes{nodes{user{accountId displayName profilePicture{path}}currentUserIsFollowing}}}}}`,y=h.a`query PaginatedLikeSummaryQuery($contentId:ID!$contentType:String!$first:Long=2$offset:Int=0$status:[String]){user(current:true){id}tenant{cloudId}content(id:$contentId type:$contentType status:$status){nodes{id likes(first:$first offset:$offset){count currentUserLikes followees{displayName accountId}nodes{user{accountId displayName profilePicture{path}}currentUserIsFollowing}}}}}`;var I=n("L21V"),C=n("B7n+"),b=n("+ypV"),E=n.n(b),w=n("3IV/");const L=m.default.button`
  background: 0;
  border: 0;
  cursor: pointer;
  color: ${e=>e.isComment?"#707070":w.B400};
  font-size: inherit;
  ${e=>e.isComment?"":"line-height: 20px;"} /* legacy styling */
  outline: 0;
  padding: 0;

  &:hover {
    cursor: pointer;
    color: ${e=>e.isComment?"#707070":w.B400};
    text-decoration: underline;
  }

  & > span {
    vertical-align: bottom;
  }
`;class F extends o.PureComponent{constructor(...e){super(...e),Object(d.a)(this,"state",{isLikedByCurrentUser:this.props.isLikedByCurrentUser}),Object(d.a)(this,"onLikeClick",()=>{const{likeContent:e,unlikeContent:t,onClick:n}=this.props,{isLikedByCurrentUser:o}=this.state;n&&n(),o?(t(),this.setState({isLikedByCurrentUser:!1})):(e(),this.setState({isLikedByCurrentUser:!0}))}),Object(d.a)(this,"renderLikeIcon",e=>!e&&r.a.createElement(E.a,{size:C.size.medium,primaryColor:w.N500}))}renderLikeAction(){const{disableButtonAction:e}=this.props,{isLikedByCurrentUser:t}=this.state;return!e&&r.a.createElement("span",null,t?r.a.createElement(I.c,{id:"likes.action.unlike",defaultMessage:"Unlike",description:"Verb: to unlike a piece of content"}):r.a.createElement(I.c,{id:"likes.action.like",defaultMessage:"Like",description:"Verb: to like a piece of content"}))}render(){const{isForComment:e,isForInlineComment:t,disableButtonAction:n}=this.props,o=e||t;return r.a.createElement(L,{isComment:o,onClick:n?null:this.onLikeClick},this.renderLikeIcon(o),this.renderLikeAction())}}const v=h.a`query LikeButtonQuery($contentId:ID!$contentType:String$status:[String]){content(id:$contentId type:$contentType status:$status){nodes{id likes{currentUserLikes}}}}`,U=h.a`mutation LikeButtonLikeMutation($contentId:ID!){likeContent(input:{contentId:$contentId}){content{id likes{count currentUserLikes}}}}`,$=h.a`mutation LikeButtonUnlikeMutation($contentId:ID!){unlikeContent(input:{contentId:$contentId}){content{id likes{count currentUserLikes}}}}`;const S=Object(k.a)()(class extends o.PureComponent{constructor(...e){super(...e),Object(d.a)(this,"fireLikeAnalyticsEvent",()=>{this.fireAnalyticsEvent("created")}),Object(d.a)(this,"fireUnlikeAnalyticsEvent",()=>{this.fireAnalyticsEvent("deleted")}),Object(d.a)(this,"generateMutation",e=>{const{contentId:t}=this.props;return()=>{e({variables:{contentId:t}})}})}getAnalyticsData(e){const{contentId:t,contentType:n,containerId:o,containerType:r,isForComment:a,isForInlineComment:s}=this.props;return{action:e,actionSubject:"like",containerType:a||s?"page":r,containerId:o,objectType:s?"inlineComment":a?"comment":"page",objectId:t,source:"likeButton",attributes:{componentVersion:"v2",pageType:"blogpost"===n||"blogpost"===r?"blogpost":"page"}}}fireAnalyticsEvent(e){this.props.createAnalyticsEvent({type:"sendTrackEvent",data:this.getAnalyticsData(e)}).fire()}render(){const{contentId:e,contentType:t,isForComment:n,isForInlineComment:o,disableButtonAction:i,onClick:l}=this.props,c={contentId:e,contentType:t,status:o?["current","draft"]:["current"]};return r.a.createElement(s.a,null,({featureFlags:e})=>{const t=e["confluence.frontend.paginated.likes"];return r.a.createElement(a.b,{query:v,variables:c},({data:e,loading:s,error:u})=>{var d;if(s||u)return null;const m=null!=(d=e)&&null!=(d=d.content)&&null!=(d=d.nodes)&&null!=(d=d[0])&&null!=(d=d.likes)?d.currentUserLikes:d;return r.a.createElement(a.a,{mutation:U,onCompleted:this.fireLikeAnalyticsEvent,refetchQueries:[{query:t?y:f,variables:c}]},e=>r.a.createElement(a.a,{mutation:$,onCompleted:this.fireUnlikeAnalyticsEvent,refetchQueries:[{query:t?y:f,variables:c}]},t=>r.a.createElement(F,{likeContent:this.generateMutation(e),unlikeContent:this.generateMutation(t),isLikedByCurrentUser:m,isForComment:n,isForInlineComment:o,disableButtonAction:i,onClick:l})))})})}});var M=n("Czhu"),j=n("Cvqa"),P=n("a8dO"),O=n("uvkf"),T=n("WA38"),x=n("bR0+"),B=n("daKX");const D=new j.b({url:"/gateway/api/directory/graphql",cacheSize:100,cacheMaxAge:3e5}),N=Object(I.g)({people:{id:"likes.summary.count.people",defaultMessage:"{numLikers} people",description:"number of people who like content"},others:{id:"likes.summary.count.others",defaultMessage:"{numLikers} others",description:"number of other people who like content"}}),A=Object(m.default)(T.a)`
  ${e=>e.isForComment&&"color: #707070;"} &:hover {
    ${e=>e.isForComment&&"color: #707070;"};
  }
`,q=m.default.a`
  cursor: pointer;
`;q.displayName="PointerLink";const z=r.a.createElement(o.Fragment,null," ",r.a.createElement(I.c,{id:"likes.summary.separator.and",defaultMessage:"and",description:"Word and used in listing things"})," "),Q=r.a.createElement(o.Fragment,null,r.a.createElement(I.c,{id:"likes.summary.separator.comma",defaultMessage:",",description:"comma punctuation used in listing things"})," "),V=Object(B.a)("paginated-likes");class H extends o.PureComponent{getUserLinkTemplate({accountId:e,displayName:t}){const{cloudId:n,isForComment:o}=this.props,a=r.a.createElement(j.c,{cloudId:n,userId:e,resourceClient:D});return r.a.createElement(A,{isForComment:o,href:Object(x.a)(e,"profileCard")},r.a.createElement(P.a,{tag:"span",component:O.a,content:a},r.a.createElement("span",null,t)))}generateYou(){return r.a.createElement(I.c,{id:"likes.summary.word.you",defaultMessage:"You",description:"You are the user"})}generatePromoted(e,t,n){const a=e.length-1;let s=t;return e.map((e,t)=>{let i;s&&(i=t===a&&0===n?z:Q),s=!0;try{return r.a.createElement(o.Fragment,{key:e.accountId},i,this.getUserLinkTemplate(e))}catch(l){return V.error`Error generating promoted user ${e} : ${l}`,null}})}generateNonPromoted(e,t,n){try{let a=this.getUserLinkTemplate(n[0]);if(e>1){const{handleDialogLinkClick:n}=this.props;a=function(e,t,n){const o=t?N.people:N.others;return r.a.createElement(q,{onClick:n},r.a.createElement(I.c,Object(M.a)(Object(M.a)({},o),{},{values:{numLikers:e}})))}(e,t,n)}return r.a.createElement(o.Fragment,null,!t&&z,a)}catch(a){return V.error`Error generating non-promoted user ${n[0]} : ${a}`,null}}generateMessage(){const{likedBy:e,currentUserId:t,likesCount:n,currentUserLikes:o,isPaginated:a,followees:s}=this.props,i=[];let l=[],c=0,u=!1,d=!0,m=0,p=0;return a?(c=o?n-1:n,l=s.slice(0,3),m=l.length,p=c-m,d=!o&&0===m,u=o,e.forEach(e=>{e.accountId===t||l.find(t=>t.accountId===e.accountId)||i.push(e)})):(e.forEach(e=>{e.accountId===t?(u=!0,d=!1):l.length<3&&e.currentUserIsFollowing?(l.push(e),d=!1):i.push(e)}),m=l.length,p=i.length,c=u?2:m+p),r.a.createElement("span",null,u&&this.generateYou(),m?this.generatePromoted(l,u,p):null,p?this.generateNonPromoted(p,d,i):null," ",r.a.createElement(I.c,{id:"likes.summary.phrase.likeThis",defaultMessage:"{numLikers, plural, one {likes this} other {like this}}",description:"suffix for number of users who like this piece of content",values:{numLikers:c}}))}render(){const{currentUserId:e,likedBy:t,likesCount:n,isForComment:o,isPaginated:a}=this.props;return 0===(a?n:t.length)?!o&&e?r.a.createElement(I.c,{id:"likes.phrase.bethefirst",defaultMessage:"Be the first to like this",description:"Message for content without any likes"}):null:this.generateMessage()}}const K=m.default.span`
  cursor: pointer;

  &:hover {
    text-decoration: underline;
  }
`;K.displayName="SummaryLink";const R=m.default.span`
  ${e=>e.showSeparator&&'::after {\n    content: "•";\n    color: $dark-gray;\n    padding: 0 0 0 3px;\n    font-size: 12px;\n  }'}
`;class J extends o.PureComponent{renderForNotInlineComment(){const{cloudId:e,contentStatus:t,likesCount:n,currentUserLikes:o,followees:a,isPaginated:s,likedBy:i,isHidingLikesEnabled:l,currentUserId:c,isForComment:u,onClick:d}=this.props,m=s?n:i.length,p=u&&m>0,k=!l||("archived"!==t||m>0);return r.a.createElement("span",{"data-test-id":"likes-summary-span"},p&&r.a.createElement(E.a,{size:C.size.small,primaryColor:"#707070"}),k&&r.a.createElement(H,{likesCount:n,currentUserLikes:o,followees:a,isPaginated:s,likedBy:i,currentUserId:c,cloudId:e,isForComment:u,handleDialogLinkClick:d}))}renderForInlineComment(){const{likedBy:e,onClick:t,likesCount:n,isPaginated:o,showSeparator:a}=this.props,s=o?n:e.length;return s?r.a.createElement(R,{showSeparator:a},r.a.createElement(E.a,{size:C.size.small,primaryColor:"#707070"}),r.a.createElement(K,{onClick:t,"data-test-id":"likes-summary-link"},s)):null}render(){return this.props.isForInlineComment?this.renderForInlineComment():this.renderForNotInlineComment()}}class W extends o.PureComponent{render(){const{contentId:e,contentType:t,onClick:n,isHidingLikesEnabled:o,isForComment:i,isForInlineComment:l,showSeparator:c,contentStatus:u}=this.props,d={contentId:e,contentType:t,status:l?["current","draft"]:["current"]};return r.a.createElement(s.a,null,({featureFlags:e})=>{const t=e["confluence.frontend.paginated.likes"];return r.a.createElement(a.b,{query:t?y:f,variables:d},({data:e,loading:a,error:s})=>{var d,m,p;if(a||s)return null;const k=null!=(p=e)&&null!=(p=p.user)?p.id:p,g=null!=(m=e)&&null!=(m=m.tenant)?m.cloudId:m;let h=0,f=!1,y=[];var I,C,b;t&&(h=(null!=(b=e)&&null!=(b=b.content)&&null!=(b=b.nodes)&&null!=(b=b[0])&&null!=(b=b.likes)?b.count:b)||0,f=(null!=(C=e)&&null!=(C=C.content)&&null!=(C=C.nodes)&&null!=(C=C[0])&&null!=(C=C.likes)?C.currentUserLikes:C)||!1,y=(null!=(I=e)&&null!=(I=I.content)&&null!=(I=I.nodes)&&null!=(I=I[0])&&null!=(I=I.likes)?I.followees:I)||[],y=y.filter(e=>e.accountId!=k));const E=((null!=(d=e)&&null!=(d=d.content)&&null!=(d=d.nodes)&&null!=(d=d[0])&&null!=(d=d.likes)?d.nodes:d)||[]).map(({currentUserIsFollowing:e,user:{displayName:t,accountId:n,profilePicture:{path:o}={}}={}})=>({displayName:t,accountId:n,avatarUrl:o,currentUserIsFollowing:e}));return r.a.createElement(J,{likesCount:h,currentUserLikes:f,followees:y,isPaginated:t,likedBy:E,cloudId:g,contentStatus:u,isHidingLikesEnabled:o,currentUserId:k,onClick:n,isForComment:i,isForInlineComment:l,showSeparator:c})})})}}var Y=n("liLY"),_=n("kbI0"),G=n("MqVv"),X=n("zJ/j"),Z=n("Oqsm"),ee=n("0Dc1");const te=Object(I.g)({followUser:{id:"likes.dialog.action.follow",defaultMessage:"Follow",description:"Verb for following/subscribing to a user"},dialogHeading:{id:"likes.dialog.phrase.likers",defaultMessage:"People who like this",description:"People who like the piece of content"},following:{id:"likes.dialog.noun.following",defaultMessage:"Following",description:"Gerund for a user you already follow"},close:{id:"likes.dialog.action.close",defaultMessage:"Close",description:"Button for closing dialog"}}),ne=m.default.div`
  border-bottom: 1px solid ${w.N50};
  display: flex;
  align-items: center;
  padding: 10px;
  overflow: auto;
`;ne.displayName="LikeUserRow";const oe=m.default.div`
  line-height: 0;
`;oe.displayName="AvatarContainer";const re=m.default.div`
  flex-grow: 1;
  padding: 0 10px;
  a,
  a:hover,
  a:active,
  a:visited,
  a:link {
    color: ${w.N800};
  }
`,ae=m.default.div`
  display: flex;
  margin: 4px 0;
  justify-content: center;
`;re.displayName="UserNameContainer";const se=Object(I.h)(Object(k.a)()(class extends o.PureComponent{constructor(...e){super(...e),Object(d.a)(this,"loadMoreClicked",()=>{const{onLoadMore:e,createAnalyticsEvent:t}=this.props;e(),t({type:"sendTrackEvent",data:{action:"clicked",actionSubject:"button",actionSubjectId:"LikeDialogLoadMore",source:"LikeDialog"}}).fire()})}renderLikeRow({displayName:e,accountId:t,avatarUrl:n,currentUserIsFollowing:o}){if(!e)return null;const{followUser:a}=this.props;return r.a.createElement(ne,{key:t,"data-test-id":"like-row"},r.a.createElement(oe,null,r.a.createElement(Z.a,{src:n,size:"medium"})),r.a.createElement(re,null,r.a.createElement(T.a,{target:"_blank",href:Object(x.a)(t,null)},e)),r.a.createElement("div",null,o?r.a.createElement(I.c,Object(M.a)({},te.following)):r.a.createElement(X.a,{onClick:()=>{a(t)},"data-test-id":"follow-user-button"},r.a.createElement(I.c,Object(M.a)({},te.followUser)))))}render(){const{onClose:e,likedBy:t,hasNextPage:n,isDisabled:o,isPaginated:a}=this.props,s=[{text:r.a.createElement(I.c,Object(M.a)({},te.close)),onClick:e}];return r.a.createElement(_.b,null,r.a.createElement(G.a,{actions:s,onClose:e,width:"small",heading:r.a.createElement(I.c,Object(M.a)({},te.dialogHeading))},t.map(e=>this.renderLikeRow(e)),a&&n?r.a.createElement(ae,null,r.a.createElement(X.a,{"data-test-id":"like-dialog-load-more-button",appearance:"default",isDisabled:o,onClick:this.loadMoreClicked},r.a.createElement(I.c,{id:"likes.dialog.load.more.button",defaultMessage:"Load more",description:"Like dialog, load more button"}))):null,r.a.createElement(ee.a,{subject:"load-likes-dialog"})))}})),ie=h.a`query LikesDialogQuery($contentId:ID!$contentType:String!){content(id:$contentId type:$contentType){nodes{id likes{nodes{user{accountId displayName profilePicture{path}}currentUserIsFollowing}}}}}`,le=h.a`query PaginatedLikesQuery($contentId:ID!$first:Long=20$offset:Int){content(id:$contentId){nodes{id type likes(first:$first offset:$offset){count currentUserLikes nodes{user{accountId displayName profilePicture{path}}currentUserIsFollowing}pageInfo{hasNextPage endCursor}}}}}`,ce=h.a`mutation LikeDialogFollowMutation($accountId:String!){followUser(followUserInput:{accountId:$accountId}){currentUserFollowing}}`;class ue extends o.PureComponent{constructor(...e){super(...e),Object(d.a)(this,"state",{followerAccountId:"",loadMoreDisabled:!1}),Object(d.a)(this,"updateLikesCache",(e,{data:t})=>{const{contentId:n}=this.props,o=e.readQuery({query:le,variables:{contentId:n}});o.content.nodes[0].likes.nodes.find(e=>e.user.accountId===this.state.followerAccountId).currentUserIsFollowing=t.followUser.currentUserFollowing,e.writeQuery({query:le,data:Object(M.a)({},o),variables:{contentId:n}})}),Object(d.a)(this,"generateLoadMoreHandler",({fetchMore:e,contentId:t,likes:n})=>()=>{this.setState({loadMoreDisabled:!0}),e({query:le,updateQuery:(e,{fetchMoreResult:t})=>t?(t.content.nodes[0].likes.nodes=[...e.content.nodes[0].likes.nodes,...t.content.nodes[0].likes.nodes],this.setState({loadMoreDisabled:!1}),Object(M.a)({},t)):e,variables:{offset:n.length,contentId:t}})})}getFollowUserMutation(e){return t=>{this.setState({followerAccountId:t}),e({variables:{accountId:t}})}}render(){const{contentId:e,contentType:t,onClose:n}=this.props,o={contentId:e,contentType:t};return Object(Y.e)({subject:"load-likes-dialog"}),r.a.createElement(s.a,null,({featureFlags:t})=>{const s=t["confluence.frontend.paginated.likes"];return r.a.createElement(a.b,{query:s?le:ie,variables:o,fetchPolicy:"cache-first"},({data:t,loading:i,error:l,fetchMore:c})=>{var u,d;if(i||l||!t)return null;const m=(null!=(d=t)&&null!=(d=d.content)&&null!=(d=d.nodes)&&null!=(d=d[0])&&null!=(d=d.likes)?d.nodes:d)||[],p=m.map(e=>{var t;return{accountId:e.user&&e.user.accountId,displayName:e.user&&e.user.displayName,avatarUrl:null!=(t=e)&&null!=(t=t.user)&&null!=(t=t.profilePicture)?t.path:t,currentUserIsFollowing:e.currentUserIsFollowing}}),k=s&&(null!=(u=t)&&null!=(u=u.content)&&null!=(u=u.nodes)&&null!=(u=u[0])&&null!=(u=u.likes)&&null!=(u=u.pageInfo)?u.hasNextPage:u)||!1;return r.a.createElement(a.a,Object(M.a)({mutation:ce},s?{update:this.updateLikesCache}:{refetchQueries:[{query:ie,variables:o}]}),t=>r.a.createElement(se,{likedBy:p,onClose:n,isDisabled:this.state.loadMoreDisabled,followUser:this.getFollowUserMutation(t),isPaginated:s,onLoadMore:this.generateLoadMoreHandler({fetchMore:c,contentId:e,likes:m}),hasNextPage:k}))})})}}const de=m.default.span`
  color: #707070;
  padding: ${e=>e.isForInlineComment?"0 0 0 4px;":"0 4px;"};
`;de.displayName="SeparatorDot";const me=m.default.span`
  margin-left: 20px;
`;me.displayName="SeparatorSpan";const pe=m.default.span`
  ${e=>e.isComment&&"font-size: 12px;\n    color: #707070;"} /* include this for inline comments because HoverContainer renders empty div */
  + div {
    display: inline;
  }
`;pe.displayName="LikesContainer";class ke extends o.PureComponent{constructor(...e){super(...e),Object(d.a)(this,"state",{isShowingDialog:!1}),Object(d.a)(this,"onSummaryClick",()=>{this.setState({isShowingDialog:!0})}),Object(d.a)(this,"onCloseDialog",()=>{this.setState({isShowingDialog:!1})})}renderSummarySeparator(){const{isForComment:e,isForInlineComment:t,hasLikes:n,showSeparator:o}=this.props;return t?n||!o?null:r.a.createElement(de,{isForInlineComment:!0},"•"):e?n?r.a.createElement(de,null,"•"):null:r.a.createElement(me,null)}render(){const{contentId:e,contentType:t,contentStatus:n,containerId:o,containerType:a,isAnonymous:i,hasLikes:c,isForComment:u,isForInlineComment:d,showSeparator:m,onClick:k}=this.props;return r.a.createElement(s.a,null,({featureFlags:s})=>{const g="archived"===n,h=s["confluence.frontend.hide.like.archived.pages"],f=h?!i&&(!g||c):!i,y=h?u&&(!i||c)&&!g:u&&(!i||c),I=h&&g,C=!h||!g,b=h?m&&!g:m;return r.a.createElement(pe,{isComment:u||d},y&&r.a.createElement(de,null,"•"),f&&r.a.createElement("span",null,r.a.createElement(S,{contentId:e,contentType:t,containerId:o,containerType:a,isForComment:u,isForInlineComment:d,disableButtonAction:I,onClick:k}),C&&this.renderSummarySeparator()),r.a.createElement(W,{contentId:e,contentType:t,contentStatus:n,onClick:this.onSummaryClick,isHidingLikesEnabled:h,isForComment:u,isForInlineComment:d,showSeparator:b}),!u&&!d&&r.a.createElement(p.a,{name:l.a.VIEW_PAGE_LIKES,attributes:{isForComment:u,isForInlineComment:d}}),this.state.isShowingDialog&&r.a.createElement(ue,{contentId:e,contentType:t,onClose:this.onCloseDialog}))})}}const ge=h.a`query LikesQuery($contentId:ID!$status:[String]){content(id:$contentId status:$status){nodes{id status type likes{count}}}}`;n.d(t,"a",(function(){return he}));class he extends o.PureComponent{render(){const{contentId:e,containerId:t,containerType:n,isForComment:o,isForInlineComment:d,showSeparator:m,onClick:p}=this.props,k={contentId:e,status:d?["current","draft"]:["current"]};return r.a.createElement(c.a,{attribution:u.a.BACKBONE},!o&&!d&&r.a.createElement(i.a,{id:e,name:l.a.VIEW_PAGE_LIKES}),r.a.createElement(s.a,null,({userId:s})=>r.a.createElement(a.b,{query:ge,variables:k},({data:a,loading:i,error:l})=>{var c,u,k;if(i||l)return null;const g=(null!=(k=a)&&null!=(k=k.content)&&null!=(k=k.nodes)&&null!=(k=k[0])?k.likes:k)||{},h=(null!=(u=a)&&null!=(u=u.content)&&null!=(u=u.nodes)&&null!=(u=u[0])?u.status:u)||"draft",f=(null!=(c=a)&&null!=(c=c.content)?c.type:c)||"",y=g.count>0;return r.a.createElement(ke,{contentId:e,contentStatus:h,contentType:f,containerId:t,containerType:n,hasLikes:y,isAnonymous:Boolean(!s),isForComment:o,isForInlineComment:d,showSeparator:m,onClick:p})})))}}}}]);
//# sourceMappingURL=38.7qv9st2LHd.js.map