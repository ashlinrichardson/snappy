(window.webpackJsonp=window.webpackJsonp||[]).push([["growth.upgrade.admin.modal~0ae2caf4"],{"+UOj":function(t,e,n){"use strict";n.r(e);var a=n("ERkP"),o=n.n(a),c=n("L21V"),r=n("1U1M"),i=n("a0gl"),u=n("dIe6"),E=n("46jh"),l=n("6n9r"),s=n("t0Ff"),d=n("oayO"),I=n("SRtI"),_=n("LEcB"),O=n("TSpG"),A=n("HKB3"),b=n("Uo/y"),p=n("mvtW"),S=n("+352"),L=n("FdbS");const T=Object(c.h)(({cloudId:t,currentEdition:e,onClose:n,touchpointId:c,onOpen:r,canChangeEdition:i,intl:{locale:u}})=>{const E=()=>{const e=d.a.getItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_DISMISSED_COUNT}_${t}`);return e?parseInt(e):0},l=E(),s=((t,e)=>0===t||(1===t?Date.now()-e>1728e5:2===t&&Date.now()-e>6048e5))(l,(()=>{const e=d.a.getItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_LAST_DISMISSED_DATE}_${t}`);return e?parseInt(e):0})()),{cohort:T,fireExposureEvent:D}=Object(_.a)(O.a.ENGAGED_ADMINS,A.b,A.a.NOT_ENROLLED),g=Object(a.useCallback)(()=>(D(),T===A.a.EXPERIMENT),[T,D]);return Object(b.a)(u)?e!==p.a.FREE||l>3||!s?null:o.a.createElement(L.a,{cloudId:t,canChangeEdition:i,currentEdition:e,targetEdition:p.a.STANDARD,flow:"upgrade",product:"confluence",touchpointId:c,onOpen:r,onClose:()=>{(()=>{d.a.setItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_LAST_DISMISSED_DATE}_${t}`,Date.now());const e=E();d.a.setItem(`${I.b.GROWTH_EXPERIMENT_UPGRADE_DISMISSED_COUNT}_${t}`,e+1)})(),n&&n()},epMessageId:S.d,onCoordinationStart:g,subRoute:S.c}):null});var D=n("kC4U"),g=n("RjSO");const R=Object(c.h)(({cloudId:t,currentEdition:e,onClose:n,touchpointId:c,onOpen:r,canChangeEdition:i,intl:{locale:u}})=>{const{cohort:E,fireExposureEvent:l}=Object(_.a)(O.a.ENGAGED_BILLING,A.b,A.a.NOT_ENROLLED),{createAnalyticsEvent:s}=Object(g.a)(),T=Object(a.useCallback)(async()=>{try{return!!(await(async t=>{const e=await Object(D.a)(`/gateway/api/billing-ux/cloud/${t}/billing/billing-details`,{method:"GET",headers:{"Content-Type":"application/json"}});return(await e.json()).paymentMethod})(t))}catch(e){return s({type:"sendOperationalEvent",data:{action:"getApiFailed",actionSubject:"apiCall",actionSubjectId:"getPaymentMethod",attributes:{flow:"engaged-billing",touchpointId:c,status:e.status,errorMessage:e.message}}}).fire(),!0}},[t,s,c]),R=Object(a.useCallback)(({displaysNextAt:t})=>{var e;t&&(e=t,d.a.setItem(I.b.LOCAL_STORAGE_DISPLAYS_NEXT_AT_KEY,e)),r&&r()},[r]),C=Object(a.useCallback)(()=>{n&&n()},[n]),m=Object(a.useCallback)(async()=>{if(!(()=>{const t=d.a.getItem(I.b.LOCAL_STORAGE_BILLING_API_NEXT_CALLED_AT_KEY)||"0";return parseInt(t,10)<Date.now()})())return"true"===d.a.getItem(I.b.LOCAL_STORAGE_HAS_BILLING_DETAILS);const t=await T();var e;return d.a.setItem(I.b.LOCAL_STORAGE_HAS_BILLING_DETAILS,t),E===A.a.CONTROL&&(e=Date.now()+1728e5,d.a.setItem(I.b.LOCAL_STORAGE_BILLING_API_NEXT_CALLED_AT_KEY,e)),t},[T,E]),N=Object(a.useCallback)(async()=>{const t=await m();t||l();return!t&&E===A.a.EXPERIMENT},[E,l,m]);if(E===A.a.NOT_ENROLLED)return null;if(!Object(b.a)(u))return null;if("true"===d.a.getItem(I.b.LOCAL_STORAGE_HAS_BILLING_DETAILS))return null;const j=(()=>{const t=(new Date).getTime(),e=d.a.getItem(""+I.b.LOCAL_STORAGE_DISPLAYS_NEXT_AT_KEY);return(e?parseInt(e,10):0)<t})();return e&&[p.a.STANDARD,p.a.PREMIUM].includes(e)&&j?o.a.createElement(L.a,{cloudId:t,canChangeEdition:i,currentEdition:e,targetEdition:p.a.STANDARD,flow:"upgrade",product:"confluence",touchpointId:c,onOpen:R,onClose:C,epMessageId:S.e,onCoordinationStart:N,subRoute:S.f}):null});n.d(e,"UpgradeAdminModalComponent",(function(){return C})),n.d(e,"UpgradeAdminModal",(function(){return m}));const C=t=>{const{isSiteAdmin:e,touchpointId:n,onOpen:c,onClose:E}=t,{cloudId:d}=Object(i.a)(),{data:I,loading:_,error:O}=Object(r.d)(s.a,{skip:!e}),A=Object(l.a)(I);return O?o.a.createElement(u.a,{error:O}):_||!e?null:o.a.createElement(a.Fragment,null,o.a.createElement(T,{cloudId:d,currentEdition:A,onClose:E,touchpointId:n,onOpen:c,canChangeEdition:e}),o.a.createElement(R,{cloudId:d,currentEdition:A,onClose:E,touchpointId:n,onOpen:c,canChangeEdition:e}))},m=Object(c.h)(Object(E.a)(C))},"46jh":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("Czhu"),o=n("ERkP"),c=n.n(o),r=n("w7pu");function i(t){return function(e){const{isSiteAdmin:n,error:i,loading:u}=Object(o.useContext)(r.a);return i||u?null:c.a.createElement(t,Object(a.a)(Object(a.a)({},e),{},{isSiteAdmin:n}))}}},"Uo/y":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));const a=t=>{let e=!0,n=!0;return t&&(e=-1!==t.toLowerCase().indexOf("en",0)),navigator&&(n=navigator.language.includes("en")),n&&e}},mvtW:function(t,e,n){"use strict";let a;n.d(e,"a",(function(){return a})),function(t){t.FREE="FREE",t.PREMIUM="PREMIUM",t.STANDARD="STANDARD"}(a||(a={}))}}]);
//# sourceMappingURL=growth.upgrade.admin.modal~0ae2caf4.DR1mv9kGek.js.map