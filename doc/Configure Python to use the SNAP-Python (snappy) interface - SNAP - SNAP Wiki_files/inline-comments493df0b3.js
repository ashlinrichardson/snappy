/*! License: AsPnCR9E9b.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([["inline-comments~493df0b3","confluence-template-preview~4134d62c"],{"/Qos":function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(a.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new o(a.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n("gIIS"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("fRV1"))},"/yy9":function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));const i=100,a=350,o=700},"03Pf":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"b",(function(){return l}));var i=n("daKX");const a=Object(i.a)("scroll-to-element"),o=new Set;function r(e){return o.add(e),()=>o.delete(e)}function s(){o.forEach(e=>{try{e()}catch(t){Promise.all([n.e("monitoring~60420017").then(n.bind(null,"fFmz")),Promise.all([n.e("atlaskit~66e23772"),n.e("vendors~4134d62c"),n.e("error-boundary~b59ad437")]).then(n.bind(null,"fEZm"))]).then(([{getMonitoringClient:e},{Attribution:n}])=>{e().submitError(t,{attribution:n.CONTENT_EXPERIENCE})}).catch(()=>{})}})}function c(){s(),window.scrollTo(0,0)}function l(e,t){let n=0,i=e.offsetParent;for(;i instanceof HTMLElement;)n+=i.offsetTop,i=i.offsetParent;const o=e.offsetTop+(t||0)+n;s();try{window.scroll({top:o,behavior:"auto"})}catch(r){a.error`window.scroll() is not supported`}}},"0Dc1":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("zjfJ"),a=(n("aWzz"),n("ERkP")),o=n("liLY");class r extends a.Component{componentDidMount(){Object(o.d)(this.props)}render(){return null}}Object(i.a)(r,"defaultProps",{subjectId:"",includeFeatureFlags:!1})},"0gjq":function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.bindAll=void 0;var a=n("FzbR");function o(e){if(void 0!==e)return"boolean"==typeof e?{capture:e}:e}t.bindAll=function(e,t,n){var r=t.map((function(t){var r=function(e,t){return null==t?e:i(i({},e),{options:i(i({},o(t)),o(e.options))})}(t,n);return a.bind(e,r)}));return function(){r.forEach((function(e){return e()}))}}},"0wgO":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var i=n("U+B7");const a=e=>{const t=new Set(e);return(e,n)=>{n.stopOn(e.find(e=>t.has(e.name)&&("taskFail"===e.action||"taskAbort"===e.action))),e.forEach(e=>{Object(i.b)(e)&&t.delete(e.name)}),0===t.size&&n.succeed()}},o=e=>(t,n)=>n.stopOn(t.find(t=>Object(i.b)(t)&&Object(i.a)(t,...e)))},"1N1n":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return u}));var i=n("Czhu"),a=n("ERkP"),o=n.n(a);const r="confluence.frontend.quick.reload.spa";let s,c;!function(e){e.content="content",e.comment="comment"}(s||(s={})),function(e){e[e.immediate=0]="immediate",e[e.normal=1]="normal",e[e.background=2]="background"}(c||(c={}));const l=async(e,t)=>{const n=Object.keys(e).reduce((t,n)=>{const i=e[n],a=Number(i.priority||c.immediate);return t[a]?t[a].push(i):t[a]=[i],t},[]);for(const i of n)if(i){const e=i.map(e=>e.reload(t));await Promise.all(e)}},d=o.a.createContext({registerReloader:()=>{},reloaders:{[s.content]:async()=>{},[s.comment]:async()=>{}}}),u=({contentId:e,children:t})=>{const[n,r]=Object(a.useState)({}),[c,u]=Object(a.useState)({}),m={[s.content]:r,[s.comment]:u};Object(a.useLayoutEffect)(()=>()=>{r({}),u({})},[e]);const h={contentId:e,registerReloader:e=>{e.types.forEach(t=>{(0,m[t])(t=>Object(i.a)(Object(i.a)({},t),{},{[e.name]:e}))})},reloaders:{[s.content]:e=>l(n,e),[s.comment]:e=>l(c,e)}};return o.a.createElement(d.Provider,{value:h},t)}},"1jzs":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("ERkP");const a="undefined"==typeof window?i.useEffect:i.useLayoutEffect},"4LHq":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));const i="confluence.frontend.global-perms-view-user-profile"},"96U/":function(e,t,n){"use strict";var i=n("ERkP"),a=n.n(i),o=n("7nmT"),r=n.n(o),s=n("Jygk"),c=n.n(s),l=n("8TdO"),d=n("KIs4"),u=n("Vgb+"),m=n("zjfJ"),h=n("aWzz"),p=n.n(h),f=n("uDfI"),g=n("gwLK"),b=n("lZoD"),E=n("kD2R"),v=n("nWyW"),y=n("JxFu"),C=n("DQZQ"),O=n("7a7X"),I=n("7M9M"),w=n("cptV"),T=n("FuAq"),k=n("M5Dj"),N=n("9m+Y"),_=n("w7pu"),M=n("6z9Z"),j=n("hpu0"),R=n("HEM+"),S=n("lPJD"),A=n("gScn"),D=n("ewfN"),P=n("cphC"),x=n("r9hL"),L=n("d3tz"),$=n("gHio"),F=n.n($),H=n("L21V"),V=n("3IV/"),B=n("KsTJ");const U=B.default.div`
  display: flex;
  background-color: ${V.P300};
  border-radius: 5px;
  align-items: center;
  overflow: hidden;
  height: ${({isOpen:e})=>e?50:0}px;
  transition: height 0.25s linear;
`,z=B.default.p`
  flex-grow: 1;
  color: ${"white"};
  text-align: center;
`,G=B.default.button`
  flex: 0 0 auto;
  appearance: none;
  background: none;
  border: none;
  color: ${"white"};
  cursor: pointer;

  &:focus {
    outline: none;
  }
`;class q extends i.Component{constructor(...e){super(...e),Object(m.a)(this,"onDismiss",e=>{const{onDismiss:t}=this.props;e.stopPropagation(),e.preventDefault(),t()})}render(){const{isOpen:e}=this.props;return a.a.createElement(U,{isOpen:e},a.a.createElement(z,null,a.a.createElement(H.b,{id:"changeboarding.dnd.pagetree.spacesettings.banner"})),a.a.createElement(G,{onClick:this.onDismiss},a.a.createElement(F.a,null)))}}var W;let Y=Object(x.a)(L.a.CHANGEBOARDING)(W=class extends i.Component{constructor(...e){super(...e),Object(m.a)(this,"state",{isOpen:!1}),Object(m.a)(this,"onDismiss",()=>{const{triggerAnalytics:e,stop:t}=this.props;this.setState({isOpen:!1}),e("reorderpages-banner-dismissed"),t()})}UNSAFE_componentWillMount(){this.el=c.a.document.getElementById("reorderpages-changeboarding-react-portal-placeholder")}componentDidMount(){setTimeout(()=>{this.setState({isOpen:!0})},200)}render(){const{isOpen:e}=this.state;return this.el?r.a.createPortal(a.a.createElement(q,{isOpen:e,onDismiss:this.onDismiss}),this.el):null}})||W;var K;let Q=Object(P.a)(K=Object(A.a)(K=class extends i.Component{constructor(...e){super(...e),Object(m.a)(this,"shouldShowSpaceSettingChangeboarding",()=>this.isOnReorderPages()),Object(m.a)(this,"isOnReorderPages",()=>{const{matchRoute:e,location:t}=this.props,n=e(t.pathname+t.search);return n&&n.name===D.SPACE_SETTINGS_REORDERPAGES.name})}render(){const{coordinationClient:e}=this.props;return this.shouldShowSpaceSettingChangeboarding()?a.a.createElement(S.a,{client:e,messageId:"confluence-dragdrop-spacesettings-banner"},a.a.createElement(Y,null)):null}})||K)||K;class J extends i.Component{render(){return a.a.createElement(d.a,null,({featureFlags:e})=>a.a.createElement(Q,{featureFlags:e}))}}class X extends i.Component{constructor(...e){super(...e),Object(m.a)(this,"browserHistory",Object(T.a)())}getChildContext(){const{context:e}=this.props;return{insertCss:e.insertCss||(()=>{})}}render(){const{store:e}=this.props;return a.a.createElement(b.b,null,a.a.createElement(g.b,{client:Object(l.getApolloClient)()},a.a.createElement(f.Provider,{store:e},a.a.createElement(_.b,null,a.a.createElement(M.a.Provider,{value:Object(j.b)()},a.a.createElement(N.a,null,a.a.createElement(y.a,null,a.a.createElement(C.a,null,a.a.createElement(R.a,null,a.a.createElement(E.ConnectedRouter,{history:this.browserHistory},a.a.createElement(i.Fragment,null,a.a.createElement(w.a,null),a.a.createElement(k.a,null),a.a.createElement(v.a,null),a.a.createElement(O.a,{namedRoutes:I.a},this.props.children,a.a.createElement(J,null)))))))))))))}}Object(m.a)(X,"childContextTypes",{insertCss:p.a.func.isRequired});var Z=n("AeT/"),ee=n("Al9w");const te=Object(Z.a)({isServerRenderedPage:!0});Object(ee.a)(te);const ne={insertCss:e=>e._insertCss()};t.a=(e,t,n=!1)=>{"string"==typeof t&&(t=c.a.document.getElementById(t)),Object(d.b)(Object(l.getApolloClient)()).then(i=>{r.a.render(a.a.createElement(u.a.Provider,{value:i},a.a.createElement(X,{store:te,context:ne,renderAsRoot:n},e)),t)})}},"9LlU":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("ERkP");const a=n.n(i).a.createContext(void 0);a.displayName="ExperienceContext"},A46D:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));const i="cubic-bezier(0.15,1,0.3,1)",a="cubic-bezier(0.2,0,0,1)",o="cubic-bezier(0.8,0,0,0.8)"},Cwwk:function(e,t,n){"use strict";var i=n("+6Tk"),a=n("4LHq"),o=n("Czhu"),r=n("1U1M"),s=n("b/OQ");const c=e=>e&&e.globalOperations&&e.globalOperations.length>0?e.globalOperations:[];n.d(t,"a",(function(){return l}));const l=()=>{if(!Object(i.a)(a.a))return!0;const{data:e,error:t}=(()=>{const{loading:e,data:t,error:n}=Object(r.d)(s.a,{errorPolicy:"all",fetchPolicy:"cache-first"});if(n)return{data:[],error:n};const i={data:[],error:null};return e?i:Object(o.a)(Object(o.a)({},i),{},{data:c(t)})})();return!!t||!!(e&&e.length>0&&e.some(e=>e&&"read"===e.operation&&"userProfile"===e.targetType))}},DL3M:function(e,t,n){var i=n("y4bl");e.exports=function(e,t,n){return null==e?e:i(e,t,n)}},DSvr:function(e,t){e.exports=function(e,t){t=t||{};var n,i,a,o=e.ownerDocument||e,r=[],s=[],c=function(e){var t=[];return function(n){if(n===e.documentElement)return!1;var i=e.defaultView.getComputedStyle(n);return!!function n(i,a){if(i===e.documentElement)return!1;for(var o=0,r=t.length;o<r;o++)if(t[o][0]===i)return t[o][1];var s=!1;return"none"===(a=a||e.defaultView.getComputedStyle(i)).display?s=!0:i.parentNode&&(s=n(i.parentNode)),t.push([i,s]),s}(n,i)||"hidden"===i.visibility}}(o),l=["input","select","a[href]","textarea","button","[tabindex]"],d=e.querySelectorAll(l.join(","));if(t.includeContainer){var u=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;l.some((function(t){return u.call(e,t)}))&&(d=Array.prototype.slice.apply(d)).unshift(e)}for(var m=0,h=d.length;m<h;m++)n=d[m],i=parseInt(n.getAttribute("tabindex"),10),(a=isNaN(i)?n.tabIndex:i)<0||"INPUT"===n.tagName&&"hidden"===n.type||n.disabled||c(n,o)||(0===a?r.push(n):s.push({index:m,tabIndex:a,node:n}));var p=s.sort((function(e,t){return e.tabIndex===t.tabIndex?e.index-t.index:e.tabIndex-t.tabIndex})).map((function(e){return e.node}));return Array.prototype.push.apply(p,r),p}},FzbR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bind=void 0,t.bind=function(e,t){var n=t.type,i=t.listener,a=t.options;return e.addEventListener(n,i,a),function(){e.removeEventListener(n,i,a)}}},HMAF:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("ERkP")),a=o(n("4KTy"));function o(e){return e&&e.__esModule?e:{default:e}}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var s=function(e){return i.default.createElement(a.default,r({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M11.221 9.322l-2.929 2.955a1.009 1.009 0 0 0 0 1.419.986.986 0 0 0 1.405 0l2.298-2.317 2.307 2.327a.989.989 0 0 0 1.407 0 1.01 1.01 0 0 0 0-1.419l-2.94-2.965A1.106 1.106 0 0 0 11.991 9c-.279 0-.557.107-.77.322z" fill="currentColor" fill-rule="evenodd"/></svg>'},e))};s.displayName="ChevronUpIcon";var c=s;t.default=c},Hi6d:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("ERkP")),a=o(n("4KTy"));function o(e){return e&&e.__esModule?e:{default:e}}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var s=function(e){return i.default.createElement(a.default,r({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M11 8.002v4.002c0 .28.116.53.301.712l2.47 2.47a1.003 1.003 0 0 0 1.414 0 1.003 1.003 0 0 0 0-1.415L13 11.586V8.004A1.009 1.009 0 0 0 13 8V6a1 1 0 0 0-2 0v2.002zM12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10z" fill="currentColor" fill-rule="evenodd"/></svg>'},e))};s.displayName="RecentIcon";var c=s;t.default=c},J7sl:function(e,t,n){"use strict";var i=n("Czhu"),a=n("uZih"),o=n.n(a),r=n("Z9L/"),s=n("ewfN"),c=n("U+B7"),l=n("3VMZ"),d=n("A79P"),u=n("hpu0"),m=n("0wgO");const h=(e,t)=>{t.stopOn(p(e,"taskSuccess")),t.stopOn(p(e,"taskFail"))},p=(e,t)=>e.find(e=>e.action===t&&Object(c.a)(e,l.a.EDIT_PAGE));n.d(t,"a",(function(){return E})),n.d(t,"c",(function(){return v})),n.d(t,"b",(function(){return y}));const f=Object(m.b)([l.a.RESTRICTED_PAGE,l.a.RESTRICTED_SPACE,l.a.NOT_FOUND]),g=Object(m.b)([l.a.CONNECT_ADDON]),b=[],E={[s.SPACE_OVERVIEW.name]:"space",[s.EDIT_PAGE_V2.name]:"page",[s.EDIT_BLOG_V2.name]:"blog",[s.VIEW_PAGE.name]:"page",[s.VIEW_BLOG.name]:"blog",[s.VIEW_BLOG_DATE_LEGACY.name]:"blog"};function v(e,t,n){if(!e)return;const i=Object(u.b)();b.forEach(e=>i.abort({name:e,reason:"Aborted due to SPA started a new experience"})),b.length=0;const a=i.subscribe(e=>{"taskStart"===e.action&&b.push(e.name)});switch(e.name){case s.EDIT_PAGE_V2.name:case s.EDIT_BLOG_V2.name:!function(e,t,n){y({name:l.a.EDIT_PAGE,id:e,startTime:0===t?0:void 0,attributes:{editor:"FABRIC",contentType:n},collect:(e,t)=>{f(e,t),t.stopOn(e.find(e=>Object(c.b)(e)&&e.name===l.a.EDIT_PAGE_CLOSE))}},{name:l.a.EDIT_PAGE_LOAD},{name:l.a.EDIT_PAGE_PUBLISH})}(e.params.contentId,t,E[e.name]);break;case s.VIEW_PAGE.name:case s.VIEW_BLOG.name:case s.VIEW_BLOG_DATE_LEGACY.name:C(e.params.contentId,t,E[e.name]);break;case s.SPACE_OVERVIEW.name:C(e.params.spaceKey,t,E[e.name]);break;case s.HOME.name:!function(e){const{isLoggedIn:t}=e,n=[l.a.HOME_SPACES,l.a.HOME_RIGHT_PANEL];t&&n.push(l.a.HOME_RECENT_PAGES);Object(u.b)().start({name:l.a.HOME,collect:(e,t)=>{Object(m.a)(n)(e,t)}})}(n);break;case s.EDIT_TEMPLATE_SPACE.name:case s.EDIT_TEMPLATE.name:O(e.params.contentId,t);break;case s.CREATE_TEMPLATE_SPACE.name:case s.CREATE_TEMPLATE.name:O(void 0,t);break;case s.ADVANCED_SEARCH.name:!function(e){Object(u.b)().start({name:l.a.ADVANCED_SEARCH,id:Object(r.a)(o()(e.query,["search_id"]))})}(e);break;case s.SPACE_ARCHIVED_PAGES.name:Object(u.b)().start({name:l.a.SPACE_ARCHIVED_PAGES});break;case s.SPACE_DIRECTORY.name:!function(e){e.featureFlags["confluence.frontend.space.directory"]&&Object(u.b)().start({name:l.a.SPACE_DIRECTORY,timeout:d.a.SPACE_DIRECTORY})}(n);break;case s.TEMPLATE_GALLERY.name:!function(){const e=[l.a.TEMPLATE_GALLERY_CATEGORIES,l.a.TEMPLATE_GALLERY_SPACE_SELECTOR,l.a.TEMPLATE_GALLERY_CARDS,l.a.TEMPLATE_GALLERY_TEMPLATE_DETAIL];Object(u.b)().start({name:l.a.TEMPLATE_GALLERY,timeout:d.a.DEFAULT,collect:(t,n)=>{Object(m.a)(e)(t,n)}})}()}a(),e.query.createDialog&&(!function(e,t){const n=Object(u.b)();n.start({name:l.a.CREATE_PAGE,id:e,startTime:0===t?0:void 0,collect(e,t){t.stopOn(e.find(e=>"taskFail"===e.action&&Object(c.a)(e,l.a.CREATE_PAGE_LOAD_DIALOG,l.a.CREATE_PAGE_TEMPLATE_VARIABLES))),t.stopOn(e.find(e=>"taskSuccess"===e.action&&Object(c.a)(e,l.a.CREATE_PAGE_TEMPLATE_VARIABLES))),t.stopOn(e.find(e=>"taskAbort"===e.action&&Object(c.a)(e,l.a.CREATE_PAGE_TEMPLATE_VARIABLES)))}}),n.start({name:l.a.CREATE_PAGE_LOAD_DIALOG,id:e,timeout:d.a.CREATE_DIALOG_LOAD})}(String(t),t),Object(u.b)().start({name:l.a.CREATE_AND_EDIT_PAGE,collect:h}))}function y(e,t,n){const a=Object(u.b)();a.start(Object(i.a)(Object(i.a)({},e),{},{collect:(i,a)=>{a.stopOn(i.find(({action:e,name:n})=>"taskFail"===e&&n===t.name)),a.stopOn(i.find(({action:e,name:t})=>("taskSuccess"===e||"taskFail"===e)&&t===n.name)),e.collect&&e.collect(i,a)}})),a.start(Object(i.a)(Object(i.a)({},t),{},{id:t.id||e.id,timeout:t.timeout||d.a.EDITOR_LOAD,attributes:e.attributes}))}function C(e,t,n){Object(u.b)().start({name:l.a.VIEW_CONTENT,id:e,startTime:0===t?0:void 0,timeout:d.a.PAGE_LOAD,attributes:{contentType:n},collect:(e,t)=>{f(e,t),g(e,t)}});const i=Object(m.a)([l.a.VIEW_PAGE_TITLE,l.a.VIEW_PAGE_LIKES,l.a.VIEW_PAGE_LABELS,l.a.VIEW_PAGE_BYLINE,l.a.VIEW_PAGE_COMMENTS,l.a.VIEW_PAGE_RENDERER,l.a.VIEW_PAGE_EDIT_BUTTON,l.a.VIEW_PAGE_CONTENT_TOOLS,l.a.VIEW_PAGE_CONTENT_HEADER,l.a.VIEW_PAGE_FAVORITE_BUTTON]);Object(u.b)().start({name:l.a.VIEW_PAGE_COMPLETE,id:e,startTime:0===t?0:void 0,timeout:d.a.PAGE_LOAD,collect:(e,t)=>{f(e,t),i(e,t),g(e,t)}})}function O(e,t){y({name:l.a.TEMPLATE_EDIT_PAGE,id:e,startTime:0===t?0:void 0,collect:(e,t)=>{t.stopOn(e.find(e=>Object(c.b)(e)&&e.name===l.a.TEMPLATE_EDIT_PAGE_CLOSE))}},{name:l.a.TEMPLATE_EDIT_PAGE_LOAD,timeout:d.a.TEMPLATE_EDITOR_LOAD},{name:l.a.TEMPLATE_EDIT_PAGE_PUBLISH})}},KuFb:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("7+Q0");const a={[i.b.DEFAULT]:"full-page",[i.b.FULL_WIDTH]:"full-width"},o=e=>{const t=a[e];return t||r()},r=()=>a[i.b.DEFAULT]},LPS5:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n("H5qd");const a=n.n(i).a`query CommentButtonQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ROOT){count nodes{id location{type ...on InlineComment{inlineMarkerRef}}}}}`},Licu:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("H5qd"),a=n.n(i),o=n("j+hl");const r=a.a`query ContentRendererQuery($contentId:ID$status:[String]){content(id:$contentId status:$status){nodes{id body{atlas_doc_format{value}}space{id key}type ...contentAppearancePublishedFragment}}}${o.b}`},"M/rd":function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("Czhu"),a=n("ERkP"),o=n.n(a),r=n("xBue"),s=n("Ua4J");const c=Object(a.forwardRef)(({children:e,className:t,target:n,testId:c,name:l,href:d=null,to:u=null,params:m={},onClick:h=(()=>{})},p)=>{const{matchSupportedRoute:f,onPageReload:g,preloadRoute:b,toUrl:E}=Object(a.useContext)(s.a),v=e=>{g(e.target.getAttribute("href"),!1),h(e)},y=i=>o.a.createElement("a",{href:i,className:t,onClick:v,target:n,rel:"_blank"===n?"noreferrer":void 0,"data-testid":c,ref:p},e),C=d||u;if(!C&&!l)return y("");const O=C&&{href:C},I=E(l,Object(i.a)(Object(i.a)({},m),O)),w=f(I);if(w){const n=async()=>b(w);return o.a.createElement(r.a,{to:`${w.pathname}${w.search}${w.hash}`,className:t,onClick:h,onMouseDownCapture:n,innerRef:p},e)}return y(I)})},MV18:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n("ERkP"),a=n("hpu0");function o({name:e,attributes:t}){return Object(i.useEffect)(()=>Object(a.b)().succeed({name:e,attributes:t}),[e,t]),null}},PLaw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n("ERkP")),a=o(n("4KTy"));function o(e){return e&&e.__esModule?e:{default:e}}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}var s=function(e){return i.default.createElement(a.default,r({dangerouslySetGlyph:'<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation"><path d="M8.292 10.293a1.009 1.009 0 0 0 0 1.419l2.939 2.965c.218.215.5.322.779.322s.556-.107.769-.322l2.93-2.955a1.01 1.01 0 0 0 0-1.419.987.987 0 0 0-1.406 0l-2.298 2.317-2.307-2.327a.99.99 0 0 0-1.406 0z" fill="currentColor" fill-rule="evenodd"/></svg>'},e))};s.displayName="ChevronDownIcon";var c=s;t.default=c},QqfF:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i=n("ERkP"),a=n.n(i);const o=Object(i.createContext)({hasContentChanged:!1,onChange:()=>{},resetContentChanged:()=>{}});o.displayName="CommentContentContext";const r=({children:e})=>{const[t,n]=Object(i.useState)(!1);return a.a.createElement(o.Provider,{value:{hasContentChanged:t,onChange:()=>n(!0),resetContentChanged:()=>n(!1)}},e)}},RLdS:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("ERkP"),a=n("lEaq"),o=n.n(a),r=n("NI0Q"),s=n("3eOh");function c(e){var t=e.children,n=e.innerRef,a=i.useContext(r.c),c=i.useCallback((function(e){Object(s.c)(n,e),Object(s.b)(a,e)}),[n,a]);return i.useEffect((function(){return function(){return Object(s.c)(n,null)}})),i.useEffect((function(){o()(Boolean(a),"`Reference` should not be used outside of a `Manager` component.")}),[a]),Object(s.d)(t)({ref:c})}},"U+B7":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));const i=e=>"taskSuccess"===e.action||"taskAbort"===e.action||"taskFail"===e.action,a=(e,...t)=>t.includes(e.name)},WA38:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n("Czhu"),a=n("HbGN"),o=n("ERkP"),r=n.n(o),s=(n("aWzz"),n("KIs4")),c=n("M/rd"),l=n("frZf");const d=e=>{const{href:t,to:n}=e,o=Object(a.a)(e,["href","to"]),d=n||t;return r.a.createElement(s.a,null,({featureFlags:t})=>{const n=d&&0!==d.indexOf("/")?"/"+d:d,a=t["confluence.frontend.people.directory"]&&!n.startsWith(l.a)?`${l.a}${n}`:n;return r.a.createElement(c.a,Object(i.a)(Object(i.a)({},e),{},{href:a},o))})}},XaRy:function(e,t,n){var i=n("DSvr"),a=null;function o(e){e&&e.focus&&e!==document.activeElement&&(e.focus(),"input"===e.tagName.toLowerCase()&&e.select())}e.exports=function(e,t){var n=[],r=null,s=null,c=null,l=!1,d=!1,u=null,m="string"==typeof e?document.querySelector(e):e,h=t||{};h.returnFocusOnDeactivate=!t||void 0===t.returnFocusOnDeactivate||t.returnFocusOnDeactivate,h.escapeDeactivates=!t||void 0===t.escapeDeactivates||t.escapeDeactivates;var p={activate:function(e){if(l)return;var t={onActivate:e&&void 0!==e.onActivate?e.onActivate:h.onActivate};l=!0,d=!1,c=document.activeElement,t.onActivate&&t.onActivate();return g(),p},deactivate:f,pause:function(){if(d||!l)return;d=!0,b()},unpause:function(){if(!d||!l)return;d=!1,g()}};return p;function f(e){if(l){var t={returnFocus:e&&void 0!==e.returnFocus?e.returnFocus:h.returnFocusOnDeactivate,onDeactivate:e&&void 0!==e.onDeactivate?e.onDeactivate:h.onDeactivate};return b(),t.onDeactivate&&t.onDeactivate(),t.returnFocus&&setTimeout((function(){o(c)}),0),l=!1,d=!1,this}}function g(){if(l)return a&&a.pause(),a=p,I(),setTimeout((function(){o(function(){var e;e=null!==E("initialFocus")?E("initialFocus"):m.contains(document.activeElement)?document.activeElement:n[0]||E("fallbackFocus");if(!e)throw new Error("You can't have a focus-trap without at least one focusable element");return e}())}),0),document.addEventListener("focus",C,!0),document.addEventListener("click",y,!0),document.addEventListener("mousedown",v,!0),document.addEventListener("touchstart",v,!0),document.addEventListener("keydown",O,!0),p}function b(){if(l&&a===p)return document.removeEventListener("focus",C,!0),document.removeEventListener("click",y,!0),document.removeEventListener("mousedown",v,!0),document.removeEventListener("touchstart",v,!0),document.removeEventListener("keydown",O,!0),a=null,p}function E(e){var t=h[e],n=t;if(!t)return null;if("string"==typeof t&&!(n=document.querySelector(t)))throw new Error("`"+e+"` refers to no known node");if("function"==typeof t&&!(n=t()))throw new Error("`"+e+"` did not return a node");return n}function v(e){h.clickOutsideDeactivates&&!m.contains(e.target)&&f({returnFocus:!1})}function y(e){h.clickOutsideDeactivates||m.contains(e.target)||(e.preventDefault(),e.stopImmediatePropagation())}function C(e){m.contains(e.target)||(e.preventDefault(),e.stopImmediatePropagation(),"function"==typeof e.target.blur&&e.target.blur(),u&&function(e){if(e.shiftKey)return o(s);o(r)}(u))}function O(e){"Tab"!==e.key&&9!==e.keyCode||function(e){if(I(),e.target.hasAttribute("tabindex")&&Number(e.target.getAttribute("tabindex"))<0)return u=e;e.preventDefault();var t=n.indexOf(e.target);if(e.shiftKey)return e.target===r||-1===n.indexOf(e.target)?o(s):o(n[t-1]);if(e.target===s)return o(r);o(n[t+1])}(e),!1!==h.escapeDeactivates&&function(e){return"Escape"===e.key||"Esc"===e.key||27===e.keyCode}(e)&&f()}function I(){n=i(m),r=n[0],s=n[n.length-1]}}},Xcdj:function(e,t,n){"use strict";var i=n("Czhu"),a=n("ERkP"),o=n.n(a),r=n("l1C2"),s=n("bhMQ"),c=n("/yy9"),l=n("ZIFe"),d=n("pwfR");n("1jzs");const u=Object(a.createContext)(()=>({isReady:!0,delay:0,ref:()=>{}})),m=()=>{const e=function(){const e=Object(a.useRef)("");return e.current||(e.current="_"+(Number(String(Math.random()).slice(2))+Date.now()+Math.round(performance.now())).toString(36)),e.current}();return Object(a.useContext)(u)(e)};t.a=({children:e,animationTimingFunction:t,enteringAnimation:n,exitingAnimation:u,isPaused:h,onFinish:p,duration:f=c.a})=>{const g=m(),{isExiting:b,onFinish:E,appear:v}=Object(d.b)(),y=Object(l.b)(),C=h||!g.isReady,O=b?0:g.delay,I=b?"exiting":"entering",[w,T]=Object(a.useState)(v);return Object(a.useEffect)(()=>{let e=!1;if(!C){if(v)return T(!0),y(()=>{"exiting"===I&&E&&E(),e||T(!1),p&&p(I)},b?.5*f:f+O),()=>{e=!0};p&&p(I)}},[E,I,b,f,O,C,y]),o.a.createElement(r.b,null,({css:a})=>e({ref:g.ref,className:w?a(Object(i.a)({animationName:""+Object(r.g)(b&&u||n),animationTimingFunction:t(I),animationDelay:O+"ms",animationFillMode:b?"forwards":"backwards",animationDuration:(b?.5*f:f)+"ms",animationPlayState:C?"paused":"running"},Object(s.b)())):""},I))}},ZIFe:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i=n("ERkP");const a=e=>{switch(e.cleanup){case"next-effect":return;case"unmount":default:return[]}},o=(e={cleanup:"unmount"})=>{const t=Object(i.useRef)([]);return Object(i.useEffect)(()=>()=>{t.current.length&&(t.current.forEach(e=>cancelAnimationFrame(e)),t.current=[])},a(e)),Object(i.useCallback)(e=>{const n=requestAnimationFrame(i=>{t.current=t.current.filter(e=>e!==n),e(i)});t.current.push(n)},[])},r=(e={cleanup:"unmount"})=>{const t=Object(i.useRef)([]);return Object(i.useEffect)(()=>()=>{t.current.length&&(t.current.forEach(e=>clearTimeout(e)),t.current=[])},a(e)),Object(i.useCallback)((e,n,...i)=>{const a=setTimeout(()=>{t.current=t.current.filter(e=>e!==a),e()},n,...i);t.current.push(a)},[])}},a8dO:function(e,t,n){"use strict";var i=n("Czhu"),a=n("ERkP"),o=n.n(a),r=n("l1C2"),s=n("bES6"),c=n("pwfR"),l=n("b6XK"),d=n("bLpi"),u=n("PEqI"),m=n("BMbf");let h=null;function p(){null!=h&&(window.clearTimeout(h),h=null)}function f(e,t){p(),h=window.setTimeout(()=>{h=null,e()},t)}let g=null;var b=n("3IV/"),E=n("EFzz"),v=n("uvkf");const y=Object(r.e)("border-radius:",Object(m.c)(),"px;box-sizing:border-box;font-size:12px;left:0;line-height:1.3;max-width:240px;padding:2px 6px;top:0;word-wrap:break-word;overflow-wrap:break-word;"),C={name:"v0nulc",styles:"max-width:420px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"},O=Object(a.forwardRef)((function({style:e,className:t,children:n,truncate:i,placement:a,testId:o},s){return Object(r.f)(E.a.Consumer,null,({mode:c})=>Object(r.f)(v.a,{ref:s,style:e,className:t,placement:a,testId:o,css:[y,i?C:null,Object(r.e)("background-color:","light"===c?b.N800:b.DN0,";color:","light"===c?b.N0:b.DN600,";")]},n))}));O.displayName="TooltipContainer";var I=O,w=n("RjSO");function T({fn:e,action:t,componentName:n,packageName:o,packageVersion:r,analyticsData:s}){const{createAnalyticsEvent:c}=Object(w.a)(),l=Object(a.useRef)(s);Object(a.useEffect)(()=>{l.current=s},[s]);return Object(a.useCallback)((function(a){const s=c({action:t,actionSubject:n,attributes:{componentName:n,packageName:o,packageVersion:r}}),d=Object(i.a)({componentName:n,packageName:o,packageVersion:r},l.current);s.context.push(d);const u=s.clone();u&&u.fire("atlaskit"),e(a,s)}),[e,t,n,o,r,c])}function k(e){const t=e||{top:0,left:0};return{getBoundingClientRect:()=>({top:t.top,left:t.left,bottom:t.top,right:t.left,width:0,height:0}),clientWidth:0,clientHeight:0}}var N=n("jYB6");const _=m.i.tooltip(),M={componentName:"tooltip",packageName:N.a,packageVersion:N.b};function j(){}function R({children:e,position:t="bottom",mousePosition:n="bottom",content:m,truncate:h=!1,component:b=I,tag:E="div",testId:v,delay:y=300,onShow:C=j,onHide:O=j,hideTooltipOnClick:w=!1,hideTooltipOnMouseDown:N=!1,analyticsContext:R}){const S="mouse"===t?n:t,A=T(Object(i.a)({fn:C,action:"displayed",analyticsData:R},M)),D=T(Object(i.a)({fn:O,action:"hidden",analyticsData:R},M)),P=Object(a.useRef)(null),[x,L]=Object(a.useState)("hide"),$=Object(a.useRef)(null),F=Object(a.useRef)(null),H=Object(a.useCallback)(e=>{e&&null!==e.firstChild&&(F.current=e,$.current=e.firstChild)},[]),V=Object(a.useRef)(x),B=Object(a.useRef)(y),U=Object(a.useRef)({onShowHandler:A,onHideHandler:D}),z=Object(a.useRef)(!1);Object(a.useEffect)(()=>{V.current=x,B.current=y,U.current={onShowHandler:A,onHideHandler:D}},[y,D,A,x]);const G=Object(a.useCallback)(e=>{P.current=e,z.current=!1},[]),q=Object(a.useCallback)(()=>{P.current&&(z.current&&U.current.onHideHandler(),P.current=null,z.current=!1,L("hide"))},[]),W=Object(a.useCallback)(()=>{P.current&&(P.current.abort(),z.current&&U.current.onHideHandler(),P.current=null)},[]);Object(a.useEffect)((function(){return function(){P.current&&W()}}),[W]);const Y=Object(a.useCallback)(e=>{if(P.current&&!P.current.isActive()&&W(),P.current&&P.current.isActive())return void P.current.keep();const t=function(e){let t="waiting-to-show";function n(){return Boolean(g&&g.entry===e)}function i(){n()&&(p(),g=null)}function a(){n()&&e.done(),t="done",i()}function o(){n()&&e.hide({isImmediate:!0}),a()}function r(){return"shown"===t||"waiting-to-hide"===t||"hide-animating"===t}return function(){const n=Boolean(g&&g.isVisible());function i(){t="shown",e.show({isImmediate:n})}g&&(p(),g.entry.hide({isImmediate:!0}),g.entry.done(),g=null),g={entry:e,isVisible:r},n?i():(t="waiting-to-show",f(i,e.delay))}(),{keep:function(){if(n())return"waiting-to-hide"===t?(t="shown",void p()):"hide-animating"===t?(t="shown",p(),void e.show({isImmediate:!1})):void 0},abort:i,isActive:n,requestHide:function({isImmediate:i}){n()&&("waiting-to-show"!==t?"waiting-to-hide"!==t&&(i?o():(t="waiting-to-hide",f(()=>{t="hide-animating",e.hide({isImmediate:!1})},e.delay))):o())},finishHideAnimation:function(){n()&&"hide-animating"===t&&a()},getInitialMouse:function(){return"mouse"===e.source.type?e.source.mouse:null}}}({source:e,delay:B.current,show:({isImmediate:e})=>{z.current||(z.current=!0,U.current.onShowHandler()),L(e?"show-immediate":"show-fade-in")},hide:({isImmediate:e})=>{L(t=>"hide"!==t?e?"hide":"fade-out":t)},done:q});G(t)},[W,q,G]);Object(a.useEffect)(()=>{if("hide"===x)return j;return Object(s.bind)(window,{type:"scroll",listener:()=>{P.current&&P.current.requestHide({isImmediate:!0})},options:{capture:!0,passive:!0,once:!0}})},[x]);const K=Object(a.useCallback)(()=>{N&&P.current&&P.current.requestHide({isImmediate:!0})},[N]),Q=Object(a.useCallback)(()=>{w&&P.current&&P.current.requestHide({isImmediate:!0})},[w]),J=Object(a.useCallback)(e=>{if(e.target===F.current)return;if(e.defaultPrevented)return;e.preventDefault();const n="mouse"===t?{type:"mouse",mouse:k({left:e.clientX,top:e.clientY})}:{type:"keyboard"};Y(n)},[t,Y]),X=Object(a.useCallback)(e=>{e.target!==F.current&&(e.defaultPrevented||(e.preventDefault(),P.current&&P.current.requestHide({isImmediate:!1})))},[]),Z=Object(a.useCallback)(()=>{Y({type:"keyboard"})},[Y]),ee=Object(a.useCallback)(()=>{P.current&&P.current.requestHide({isImmediate:!1})},[]),te=Object(a.useCallback)(e=>{"exiting"===e&&"fade-out"===V.current&&P.current&&P.current.finishHideAnimation()},[]),ne=E,ie="hide"!==x&&Boolean(m),ae="show-immediate"===x||"show-fade-in"===x;return Object(r.f)(o.a.Fragment,null,Object(r.f)(ne,{onMouseOver:J,onMouseOut:X,onClick:Q,onMouseDown:K,onFocus:Z,onBlur:ee,ref:H,"data-testid":v?v+"--container":void 0},e),ie?Object(r.f)(u.a,{zIndex:_},Object(r.f)(d.a,{placement:S,referenceElement:(()=>{const e=P.current,n=e?e.getInitialMouse():null;return"mouse"===t&&n?n:$.current||void 0})()},({ref:e,style:t})=>Object(r.f)(c.a,{appear:!0},ae&&Object(r.f)(l.a,{onFinish:te,duration:"show-immediate"===x?0:void 0},({className:n})=>Object(r.f)(b,{ref:e,className:"Tooltip "+n,style:t,truncate:h,placement:S,testId:v},m))))):null)}R.displayName="Tooltip";t.a=R},b6XK:function(e,t,n){"use strict";var i=n("HbGN"),a=n("Czhu"),o=n("ERkP"),r=n.n(o),s=n("A46D"),c=n("/yy9"),l=n("Xcdj");const d={bottom:"translate3d(0, calc(5% + 4px), 0)",left:"translate3d(calc(-5% - 4px), 0, 0)",right:"translate3d(calc(5% + 4px), 0, 0)",top:"translate3d(0, calc(-5% - 4px), 0)"},u={bottom:"translate3d(0, calc(-5% - 4px), 0)",left:"translate3d(calc(5% + 4px), 0, 0)",right:"translate3d(calc(-5% - 4px), 0, 0)",top:"translate3d(0, calc(5% + 4px), 0)"},m=e=>({from:{opacity:1,transform:void 0!==e?"translate3d(0, 0, 0)":void 0},to:Object(a.a)({opacity:0},void 0!==e&&{transform:u[e]})});t.a=e=>{let{children:t,duration:n=c.a,entranceDirection:o}=e,u=Object(i.a)(e,["children","duration","entranceDirection"]);return r.a.createElement(l.a,Object.assign({duration:n,enteringAnimation:(h=o,{from:Object(a.a)({opacity:0},void 0!==h&&{transform:d[h]}),"50%":{opacity:1},to:{transform:void 0!==h?"none":void 0}}),exitingAnimation:m(o),animationTimingFunction:()=>s.b},u),t);var h}},bES6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("FzbR");Object.defineProperty(t,"bind",{enumerable:!0,get:function(){return i.bind}});var a=n("0gjq");Object.defineProperty(t,"bindAll",{enumerable:!0,get:function(){return a.bindAll}})},"bR0+":function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u}));var i=n("KIs4"),a=n("8TdO"),o=n("frZf");const r=(e,t,n="")=>e?`${n}/people/${e}?ref=confluence${t?"&src="+encodeURIComponent(t):""}`:"",s=async(e,t)=>{if(!e)return"";let n="";try{const{featureFlags:e}=await Object(i.b)(Object(a.getApolloClient)());n=e["confluence.frontend.people.directory"]?o.a:""}catch(r){}return`${n}/people/${e}?ref=confluence${t?"&src="+encodeURIComponent(t):""}`},c=(e,t,n="")=>e?`${n}/people/team/${e}?ref=confluence${t?"&src="+encodeURIComponent(t):""}`:"",l=e=>e.getAttribute("data-account-id"),d=e=>{const t={class:"className"},n={};return(e=>Array.from(e.attributes).map(e=>e.name))(e).forEach(i=>{n[t[i]||i]=e.getAttribute(i)}),n.dangerouslySetInnerHTML={__html:e.innerHTML},n};function u(e){return e.filter(l).map(e=>{const t=d(e);t["data-user-hover-bound"]="true",t.href=r(t["data-account-id"],null);const n=window.document.createElement("span");return e.parentNode?(e.parentNode.replaceChild(n,e),{props:t,placeholder:n}):{}})}},bWlm:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("ERkP"),a=n("+6Tk"),o=n("1N1n");const r=e=>{const t=Object(a.a)(o.a),{contentId:n,registerReloader:r}=Object(i.useContext)(o.b);Object(i.useEffect)(()=>{t&&r(e)},[n,e.reload,e.name,t])}},bhMQ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));const i=()=>{if("undefined"==typeof window||!("matchMedia"in window))return!1;const{matches:e}=window.matchMedia("(prefers-reduced-motion: reduce)");return e},a=()=>({"@media (prefers-reduced-motion: reduce)":{animation:"none",transition:"none"}})},gIIS:function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,a,o,r,s,c=1,l={},d=!1,u=e.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(e);m=m&&m.setTimeout?m:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick((function(){p(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){p(e.data)},i=function(e){o.port2.postMessage(e)}):u&&"onreadystatechange"in u.createElement("script")?(a=u.documentElement,i=function(e){var t=u.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}):i=function(e){setTimeout(p,0,e)}:(r="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(r)&&p(+t.data.slice(r.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),i=function(t){e.postMessage(r+t,"*")}),m.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var a={callback:e,args:t};return l[c]=a,i(c),c++},m.clearImmediate=h}function h(e){delete l[e]}function p(e){if(d)setTimeout(p,0,e);else{var t=l[e];if(t){d=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{h(e),d=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n("fRV1"),n("F63i"))},i4Pk:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var i=n("Czhu"),a=n("HbGN"),o=n("ERkP"),r=n.n(o),s=n("1U1M"),c=n("82Bo"),l=n("Licu"),d=n("3VMZ"),u=n("hpu0"),m=n("KuFb"),h=n("adTp"),p=n("xkEZ"),f=n("X2PC"),g=n("KIs4");const b=Object(o.memo)(e=>{var t;let{appearance:n,contentId:p,contentType:f,getEventHandlers:b}=e,E=Object(a.a)(e,["appearance","contentId","contentType","getEventHandlers"]);const[v,y]=Object(o.useState)(null),{data:C,error:O}=Object(s.d)(l.a,{variables:{contentId:p,status:"inlineComment"!==f?["current"]:["current","draft"]},fetchPolicy:"cache-and-network",context:{single:!0}}),I=Object(o.useCallback)((e,t)=>{let n=d.a.VIEW_INLINE_COMMENT_TOP_LEVEL;"inlineReply"===e&&(n=d.a.VIEW_INLINE_COMMENT_REPLY),Object(u.b)().fail({name:n,error:t})},[]);if(!p)return null;if(O)throw I(f,O),O;let w=null,T=n;const k=null!=(t=C)&&null!=(t=t.content)&&null!=(t=t.nodes)?t[0]:t;try{var N;!T&&k&&(T=Object(m.a)(Object(h.d)(k).appearance));const e=null!=(N=C)&&null!=(N=N.content)&&null!=(N=N.nodes)&&null!=(N=N[0])&&null!=(N=N.body)&&null!=(N=N.atlas_doc_format)?N.value:N;w=e?JSON.parse(e):null}catch(_){throw I(f,_),_}return r.a.createElement("div",{ref:y,"data-test-appearance":T},r.a.createElement(g.a,null,({featureFlags:e})=>r.a.createElement(c.a,Object(i.a)({appearance:T,contentId:p,document:w,eventHandlers:b&&b(),featureFlags:e,portalRef:v},E))))}),E=Object(p.a)({attribution:f.a.BACKBONE})(b)},i8tr:function(e,t,n){"use strict";n.r(t);var i=n("jUyC"),a=n("HvGa"),o=n.n(a),r=n("jqY8"),s=n("Jygk"),c=n.n(s),l=n("+frj"),d=n.n(l),u=n("UYEP"),m=n.n(u),h=n("cld1"),p=n("kC4U"),f=n("94Z3"),g=n("hpu0"),b=n("3VMZ");var E=new(m.a.View.extend({initialize(){this.setPageContentElByCSSSelector("#content"),this.pageHeader=null},destroy(){this.el&&(this.el.style.minHeight="",this.el.classList.remove("ic-shrink-to-show-sidebar")),this.pageHeader&&this.pageHeader.classList.remove("ic-shrink-to-show-sidebar")},setPageContentElByCSSSelector(e){let t=!1;if(e){const n=c.a.document.querySelector(e);n?this.setElement(n):t=!0}else t=!0;if(t){const e=c.a.document.querySelector("#content");this.setElement(e)}},setPageHeaderElByCSSSelector(e){this.pageHeader=e?c.a.document.querySelector(e):null},shrinkToShowSideBar(){this.el.classList.add("ic-shrink-to-show-sidebar"),this.pageHeader&&this.pageHeader.classList.add("ic-shrink-to-show-sidebar")},updateMinHeight(e){const t=e-this.$el.offset().top,n=parseInt(this.el.style.minHeight,10);(t>n||isNaN(n))&&(this.el.style.minHeight=t+"px")}}));const v=c.a.top,y={INLINE_COMMENTS:o.a.DarkFeatures.isEnabled("confluence-inline-comments"),RESOLVED_INLINE_COMMENTS:o.a.DarkFeatures.isEnabled("confluence-inline-comments-resolved"),RICH_TEXT_EDITOR:o.a.DarkFeatures.isEnabled("confluence-inline-comments-rich-editor"),DANGLING_COMMENT:o.a.DarkFeatures.isEnabled("confluence-inline-comments-dangling-comment"),LIKES_ADMIN_TOGGLE:o.a.DarkFeatures.isEnabled("optional-likes-CONFDEV-53297")},C=["dateautocomplete","confluencemacrobrowser","propertypanel","jiraconnector","dfe"],O=["autoresize","confluenceleavecomment"],I=["code"];function w(e,t,n,i){null==t||t.isResolved()||t.isDangling()||m.a.trigger("ic:view",t,"permalink",{isReplyComment:i})}function T(){return o.a.Meta.get("user-display-name")||o.a.Meta.get("current-user-fullname")}function k(){return o.a.Meta.get("atlassian-account-id")}function N(e){if("number"==typeof e.selectionStart){const t=e.value.length;e.selectionStart=t,e.selectionEnd=t}else if(null!=typeof e.createTextRange){e.focus();const t=e.createTextRange();t.collapse(!1),t.select()}}function _(e){let t=Object(i.default)(e).closest("a");return t.length||(t=Object(i.default)(e).find("a")),t}function M(){return!!Object(i.default)(".ic-sidebar #wysiwygTextarea_ifr").length}function j(e,t,n){n=n||1,e=e||Object(i.default)(v).scrollTop();const a=i.default.Deferred();if(R()){const o={duration:100,step(e){Object(i.default)(v).scrollTop(e)},complete(){setTimeout(a.resolve,n)}};Object(i.default)({scrollTop:e}).animate({scrollTop:t},o)}else c.a.scrollTo(0,t);return a.promise()}function R(){const e=c.a.frameElement&&c.a.frameElement.getAttribute("name"),t=c.a.frameElement&&"true"===c.a.frameElement.getAttribute("data-is-fallback-mode-iframe");return c.a.top!==c.a.self&&e&&"fallback-mode-iframe"===e||t}const S=function(){let e=null,t=null;function n(t){const n=((t||{}).data||{}).user||{},i=(n.photos||[]).find(e=>e.isPrimary);return e={authorAccountId:n.id,authorDisplayName:n.displayName,authorAvatarUrl:(i||{}).value},e}function i(){return e={authorAccountId:k(),authorDisplayName:T(),authorAvatarUrl:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url")},e}return()=>{if(e)return Promise.resolve(e);if(!t){const e=e=>e.json();t=Object(p.a)("/cgraphql?q=InlineCommentCurrentUserData",{method:"POST",headers:{"Content-Type":"application/json","X-APOLLO-OPERATION-NAME":"InlineCommentCurrentUserData"},body:JSON.stringify({query:"\n          query {\n            user(current: true) {\n              id\n              displayName\n              photos {\n                value\n                isPrimary\n              }\n            }\n          }\n        ",variables:null})}).then(e,t=>{if(t instanceof f.a)return e(t.response);throw t}).then(n).catch(i)}return t}}();S();var A={overlappedSelection:function(e,t){let n;if(!e||!t)return;let a=Object(i.default)(e.containingElement);if(a.is(".inline-comment-marker.valid")||(a=Object(i.default)("<div/>").append(e.html).find(".inline-comment-marker.valid")),a.length>0&&function(e){return e.filter((function(){return Object(i.default)(this).text().length>0})).length>0}(a)){const e=a.first().data("ref");return n=t.findWhere({markerRef:e}),n}},focusedCommentUrl:function(e){return`${o.a.contextPath()}/pages/viewpage.action?pageId=${o.a.Meta.get("latest-page-id")}&focusedCommentId=${e}#comment-${e}`},showFocusedComment:function(e,t,n){const a=t.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null==a)return;const r="replyToComment"===a[1],s=parseInt(a[2],10);if(!e.findWhere)return;let c=e.findWhere({id:s});null!=c?w(e,c,n,r):i.default.ajax({url:`${o.a.contextPath()}/rest/inlinecomments/1.0/comments/replies/${s}/commentId`}).done(t=>{c=e.findWhere({id:t}),w(e,c,n,r)})},getAuthorAvatarUrl:function(){return o.a.Meta.get("current-user-avatar-url")?o.a.contextPath()+o.a.Meta.get("current-user-avatar-url"):o.a.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/anonymous.png"},moveCaretToEnd:function(e){N(e),c.a.setTimeout(()=>{N(e)},1)},animateSidebar:function(e,t){const n="webkitAnimationEnd oanimationend msAnimationEnd animationend",a=e.$wikiContent,o=i.default.Deferred();if(t){const t=Object(i.default)(".inline-comment-marker.active");e.$el.addClass("ic-slide-in"),e.$el.one(n,(function(){Object(i.default)(this).removeClass("ic-slide-in"),t.addClass("ic-highlight-pulse"),t.one(n,()=>{t.removeClass("ic-highlight-pulse")})})),o.resolve()}else{e.$el.addClass("ic-slide-out");const t=function t(){e.$el.removeClass("ic-slide-out"),e._emptySidebar(),E.destroy(),a.css("position","static"),o.resolve(),e.$el.off(n,t)};e.$el.on(n,t)}return o.promise()},getDarkFeatures:function(){return d.a.clone(y)},getInlineLinks:_,removeInlineLinksDialog:function(e){e.each((function(){const e=_(this);e.length&&e.off("mousemove")}))},isAnimationSupported:function(){return void 0!==document.body.style.animation||void 0!==document.body.style.webkitAnimation},showHighlightContent:function(e){e.parents(".expand-content.expand-hidden").each((function(){Object(i.default)(this).siblings(".expand-control").click()}))},getUnsupportedRtePlugins:function(){return d.a.clone(C)},getSupportedRtePlugins:function(){return d.a.clone(O)},confirmProcess:function(e,t=!1,n=!1){if(n)return!!confirm(e({id:"inline.comments.editor.lost"}))&&(m.a.trigger(m.a,"ic:fabric-editor-dirty",!1),!0);{const n=o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor();if(n&&n.isDirty()&&(t&&M()||c.a.Confluence.Editor&&!c.a.Confluence.Editor.getContentType))return confirm(e({id:"inline.comments.editor.lost"}))}return!0},getAuthorDisplayName:T,isKeyboardShortcutsEnable:function(){return o.a.Meta.get("use-keyboard-shortcuts")&&c.a.Confluence.KeyboardShortcuts&&c.a.Confluence.KeyboardShortcuts.enabled},addSidebarHeadingTooltip:function(e){e.$("button.ic-action-hide").tooltip({gravity:"se"}),e.$("#ic-nav-next").tooltip({gravity:"s"}),e.$("#ic-nav-previous").tooltip({gravity:"s"})},hasEditorInSidebar:M,recalculateContentHeight:function(e){const t=e.height(),n=e.offset().top+t;E.updateMinHeight(n)},resizeContentAfterLoadingImages:function(e){e=e.closest(".ic-display-comment-view");const t=this,n=Object(i.default)(".confluence-embedded-image, .confluence-embedded-file img",e),a=n.length;let o=0;a>0&&n.off("load").one("load",()=>{++o===a&&t.recalculateContentHeight(e)}).each((function(){this.complete&&Object(i.default)(this).load()}))},scrollToCommentAfterToggleSideBar:function(e,t,n){const a=function(){const n=t&&t.is(":visible");if(e&&n){const n=t.offset().top-e;Object(i.default)(v).scrollTop(n)}};(n=void 0!==n?n:R())?setTimeout(a,1):a()},getEditorFormat:function(e){const t=i.default.Deferred();return i.default.ajax({url:`${o.a.contextPath()}/rest/api/content/${e}?expand=body.editor`,type:"GET",dataType:"json",contentType:"application/json; charset=utf-8"}).then(e=>{const n=e.body.editor.value;t.resolve(n)}).fail((e,n,i)=>{t.reject(e,n,i)}),t.promise()},containUnsupportedMacro:function(e){const t=e.closest(".conf-macro");return!1===t.data("hasbody")||e.find('.conf-macro[data-hasbody="false"]').length>0||-1!=I.indexOf(t.data("macro-name"))},containInternalLink:function(e){return e.closest(".user-mention").length>0||e.find(".user-mention").length>0},containUserMetion:function(e){return e.closest("a[href^='/']:not('.user-mention')").length>0||e.find("a[href^='/']:not('.user-mention')").length>0},getCurrentUserInfo:function(){let e={isDefault:!0,path:o.a.Meta.get("static-resource-url-prefix")+"/images/icons/profilepics/default.png"};return"/images/icons/profilepics/default.png"!==o.a.Meta.get("current-user-avatar-url")&&(e={isDefault:!1,path:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url")}),{accountId:o.a.Meta.get("atlassian-account-id"),displayName:o.a.Meta.get("current-user-fullname"),profilePicture:e}},getOffsetTopRelativeInWindowCoordinate:function(e){return e.offset().top-Object(i.default)(v).scrollTop()},scrollToActiveHighlight:function(e,t){const n=Object(i.default)(v),a=n.scrollTop(),o=n.height();let r;return r=e>a&&e<a+o?a+e-t:e-o/4,j(a,r)},scrollToTop:function(){return j(null,0,100)},sendMessageToParent:function(e){e.bridgeId=""+(c.a.frameElement&&c.a.frameElement.getAttribute("data-bridge-id")),c.a.parent.postMessage(e,c.a.location.origin)},isFallbackModeIframe:R,isSPAPage:function(){return Object(i.default)("#confluence-ui").length>0},getPageContentClassName:function(){return"view-page-body"},getAuthorAccountId:k,getCurrentUserData:S,getAnalyticsClient:Object(h.getAnalyticsWebClient)(),getUnresolvedComments:e=>e.models?e.models.filter(e=>!e.attributes.resolveProperties.resolved):[],failEditDisplay:function(e,{errorThrown:t}){const n=t instanceof Error?t:new Error(t);Object(g.c)(b.a.EDIT_INLINE_COMMENT_LOAD,n),m.a.trigger("ic:error",e)}};var D=n("IC1n"),P=n.n(D),x=n("uIYj"),L=n("J7sl"),$=n("mAAb"),F=m.a.Model.extend({defaults:{authorDisplayName:A.getAuthorDisplayName(),authorAccountId:o.a.Meta.get("atlassian-account-id"),authorAvatarUrl:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url"),body:"",commentId:"0",hasDeletePermission:!0,hasEditPermission:Boolean(o.a.Meta.get("atlassian-account-id"))},urlRoot(){return`${o.a.contextPath()}/rest/inlinecomments/1.0/comments/${this.get("commentId")}/replies`},sync(e,t,n){return n=n||{},"create"===e&&(n.url=`${this.urlRoot()}?containerId=${o.a.Meta.get("latest-page-id")}`),m.a.sync.call(this,e,t,n)},validate(){if(!this.get("body"))return!0}}),H=m.a.Collection.extend({model:F}),V=m.a.Model.extend({defaults:{authorDisplayName:A.getAuthorDisplayName(),authorAvatarUrl:o.a.contextPath()+o.a.Meta.get("current-user-avatar-url"),body:"",originalSelection:"",parentCommentId:"0",lastFetchTime:Object(i.default)("meta[name=confluence-request-time]").attr("content"),hasDeletePermission:!0,hasEditPermission:!0,hasResolvePermission:!0,resolveProperties:{resolved:!1,resolvedTime:0},serializedHighlights:"",deleted:!1},urlRoot:o.a.contextPath()+"/rest/inlinecomments/1.0/comments",initialize(e){e=e||{},this._setHighlights(e.markerRef);const t=this;this.replies=new H,this.replies.url=function(){return t.url()+"/replies"},this.set({containerId:o.a.Meta.get("latest-page-id")},{silent:!0}),this.set({containerType:o.a.Meta.get("content-type")},{silent:!0}),A.getDarkFeatures().DANGLING_COMMENT&&o.a.Meta.get("page-id")===o.a.Meta.get("latest-page-id")&&this.isDangling(e.contentStatus)&&!this.isResolved()&&this.resolve(!0,{wait:!0,dangling:!0,success:d.a.bind((function(){m.a.trigger("ic:open:dangled",this)}),this),error:d.a.bind((function(){m.a.trigger("ic:resolve:dangled:failed",this)}),this)})},validate(){if(!this.get("body"))return!0},resolve(e,t){t=t||{},this.save({},d.a.extend(t,{url:`${this.urlRoot}/${this.get("id")}/resolve/${e}/dangling/${!0===t.dangling}`}))},isResolved(){return this.get("resolveProperties").resolved},isDangling(e){return void 0===this.highlight&&"current"===e},isDeleted(){return this.get("deleted")},_setHighlights(e){let t;t=void 0!==e?Object(i.default)("[data-inline-comments-target=true]:first").find(`.inline-comment-marker[data-ref="${e}"],span[data-mark-type=confluenceInlineComment][data-reference="${e}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${e}"]`):Object(i.default)(".ic-current-selection"),0!==t.length?(this.highlights=t,this.highlight=t.first()):(this.highlights=void 0,this.highlight=void 0)},destroy(e){e=e?d.a.clone(e):{};const t=this,n=e.success;return e.success=function(i){n&&n(t,i,e)},function(e,t){const n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}}(this,e),this.sync("delete",this,e)}}),B=m.a.Collection.extend({model:V,initialize(){this.listenTo(this,"sort",this._removeCachedMarkers)},url:()=>o.a.contextPath()+"/rest/inlinecomments/1.0/comments?containerId="+o.a.Meta.get("page-id"),getResolvedCount(){return this.getResolvedComments().length},getUnresolveCount(){return this.reject(e=>!0===e.isResolved()&&!1===e.isDeleted()).length},getResolvedComments(){return this.filter(e=>!0===e.isResolved()&&!1===e.isDeleted())},getResolvedCommentsDesc(){return d.a.sortBy(this.getResolvedComments(),e=>0-e.get("resolveProperties").resolvedTime)},getNextCommentOnPage(){return this._getCommentAtRelativeOffset(1)},getPrevCommentOnPage(){return this._getCommentAtRelativeOffset(-1)},_getCommentAtRelativeOffset(e){const t=this.getCommentsOnPage(),n=this.findWhere({active:!0});if(void 0===n||t.length<=1)return null;const i=d.a.pluck(t,"id");return t[(d.a.indexOf(i,n.get("id"))+e+t.length)%t.length]},getCommentsOnPage(){return this.filter(e=>!1===e.isResolved()&&!e.isDangling()&&!1===e.isDeleted()||!0===e.get("active"))},getCommentsOnPageCount(){return this.getCommentsOnPage().length},getActiveIndexWithinPageComments(){const e=d.a.pluck(this.getCommentsOnPage(),"id"),t=this.findWhere({active:!0});if(void 0===t)return null;const n=t.get("id");return d.a.indexOf(e,n)},comparator(e,t){return void 0===this.markers&&(this.markers=Object(i.default)("[data-inline-comments-target=true]:first").find("[data-mark-annotation-type='inlineComment'],.inline-comment-marker")),void 0===e.highlight?1:void 0===t.highlight?-1:this.markers.index(e.highlight)-this.markers.index(t.highlight)},_removeCachedMarkers(){this.markers=void 0}});const U={};d.a.extend(U,m.a.Events),U.start=function(){!0!==this.running&&(this.running=!0,this.send=function(e,t){o.a.trigger("analytics",{name:e,data:t})},this.listenTo(m.a,"ic:highlight-panel-click",(function(){this.send("confluence.highlight.actions.comment.inline")})),this.listenTo(m.a,"ic:view",(function(e,t){this.send("confluence.comment.inline.view"),"nav"===t&&this.send("confluence.comment.inline.view.nav"),"permalink"===t&&this.send("confluence.comment.inline.view.permalink")})),this.listenTo(m.a,"ic:overlap",(function(){this.send("confluence.comment.inline.overlap")})),this.listenTo(m.a,"ic:edit",(function(){this.send("confluence.comment.inline.edit")})),this.listenTo(m.a,"ic:persist",(function(){this.send("confluence.comment.inline.create")})),this.listenTo(m.a,"ic:sidebar:close",(function(){this.send("confluence.comment.inline.sidebar.close")})),this.listenTo(m.a,"ic:reply:persist",(function(){this.send("confluence.comment.inline.reply")})),this.listenTo(m.a,"ic:delete ic:reply:delete",(function(){this.send("confluence.comment.inline.delete")})),this.listenTo(m.a,"ic:resolved",(function(){this.send("confluence.comment.inline.resolved")})),this.listenTo(m.a,"ic:unresolved",(function(){this.send("confluence.comment.inline.unresolved")})),this.listenTo(m.a,"ic:resolved:view",(function(e){const t={total:e};this.send("confluence.comment.inline.resolved.view",t)})),this.listenTo(m.a,"ic:resolved:dismiss:recovery",(function(){this.send("confluence.comment.inline.resolved.dismiss")})),this.listenTo(m.a,"ic:resolved:show:recovery",(function(){this.send("confluence.comment.inline.resolved.discovery")})),this.listenTo(m.a,"ic:open:dangled",(function(e){const t={commentId:e.get("id"),pageId:o.a.Meta.get("page-id")};this.send("confluence.comment.inline.open.dangled",t)})),this.listenTo(m.a,"ic:editor:load:fail",(function(){const e={pageId:o.a.Meta.get("page-id")};this.send("confluence.comment.inline.editor.load.fail",e)})),this.listenTo(m.a,"ic:resolve:dangled:failed",(function(e){const t={commentId:e.get("id"),pageId:o.a.Meta.get("page-id")};this.send("confluence.comment.inline.resolved.dangled.failed",t)})))},U.stop=function(){this.running=!1,this.stopListening()};var z=U,G=n("0wgO");const q="FABRIC",W="add",Y="add-reply",K="edit",Q="edit-reply",J="reply",X="view",Z="Comment with provided comment id not found",ee="Page with provided page id not found",te="Reading a comment not permitted for this user",ne="Creating a comment not permitted for this user",ie="Deleting a comment not permitted for this user",ae="Resolving a comment not permitted for this user",oe="Editing a comment not permitted for this user",re="Comment id in the input was not expected to be null",se="Cannot create inline comments on macros (mentions, images, emojis, etc.)",ce="creationBean can not be null",le="body for creationBean can not be null",de="Incorrect data in the request",ue="Captcha check failed",me="Captcha check successfull";n("wS3D");function he(){i.default.textHighlighter.createWrapper=function(e){return Object(i.default)("<span></span>").addClass(e.highlightedClass)},this.$el=Object(i.default)("[data-inline-comments-target=true]").first(),this.$el.length>0&&this.$el.textHighlighter({highlightedClass:"ic-current-selection"})}he.prototype.highlight=function(e){if(0===this.$el.length)return;const t=Object(i.default)(this.$el.getHighlighter().doHighlight(e));return this.$el.getHighlighter().serializeHighlights(t)},he.prototype.removeHighlight=function(){if(0!==this.$el.length)return this.$el.getHighlighter().removeHighlights(),this},he.prototype.deserializeHighlights=function(e,t){if(0===this.$el.length)return;const n=`<span class="inline-comment-marker" data-ref="${t}"></span>`;return this.$el.getHighlighter().deserializeHighlights(e,n)};var pe=he,fe=n("frZf");function ge(e,t){return`<div class="ic-sidebar-heading"><div id="ic-nav-container">${1==e.createComment?ye({disabled:!0,showIndex:!1},t):""}</div><div class="ic-right-toolbar">${e.showMenu?function(e,t){return""+(e.darkFeatures.INLINE_COMMENTS&&(e.hasDeletePermission||e.hasReplyPermission||e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS)?c.a.aui.buttons.button({type:"subtle",extraClasses:"aui-button-compact aui-dropdown2-trigger-arrowless aui-style-default ic-action-menu",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-more",text:"",dropdown2Target:"ic-menu-items"})+c.a.aui.dropdown2.contents({id:"ic-menu-items",extraClasses:"aui-style-default",content:`<ul class="aui-list-truncate">${e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?`<li class="ic-action-resolve"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolve"}))}</a></li>`:""}${e.hasReplyPermission?`<li class="ic-action-reply"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.reply"}))}</a></li>`:""}${e.hasEditPermission?`<li class="ic-action-edit"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.edit"}))}</a></li>`:""}${e.hasDeletePermission?`<li class="ic-action-delete"><a href="#">${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.delete"}))}</a></li>`:""}</ul>`}):"")}(e,t):""}${c.a.aui.buttons.button({type:"text",extraClasses:"aui-button-text ic-action-hide",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-close-dialog",text:"",extraAttributes:{title:t({id:"inline.comments.sidebar.tooltip.close.description"})}})}</div></div><div class="ic-error"></div>`}function be(e,t){return`<div class="ic-author">${function(e){return""+(e.authorAccountId&&""!=e.authorAccountId?`<a data-account-id="${c.a.soy.$$escapeHtml(e.authorAccountId)}" href="${c.a.soy.$$escapeHtml("/people")}/${c.a.soy.$$escapeHtml(e.authorAccountId+"?ref=confluence")}" title="" data-user-hover-bound="true">${c.a.aui.avatar.avatar({size:e.size,avatarImageUrl:e.authorAvatarUrl,extraClasses:"ic-author-avatar-fabric"})}</a>`:c.a.aui.avatar.avatar({size:e.size,avatarImageUrl:fe.a+"/images/icons/profilepics/anonymous.png",extraClasses:"ic-author-avatar-fabric"}))}({authorAvatarUrl:e.authorAvatarUrl,authorAccountId:e.authorAccountId,size:"small"})}${function(e){return""+(e.accountId&&""!=e.accountId?`<a href="${function(e){return`${c.a.soy.$$escapeHtml("/people")}/${c.a.soy.$$escapeHtml(e.accountId+"?ref=confluence")}`}(e)}"${e.canView?`class="url fn confluence-userlink" data-account-id="${c.a.soy.$$escapeHtml(e.accountId)}"`:'class="url fn"'}>${c.a.soy.$$escapeHtml(e.fullName)}</a>`:c.a.soy.$$escapeHtml("Anonymous"))}({canView:!!e.authorAccountId,fullName:e.authorDisplayName,accountId:e.authorAccountId})}</div>`}function Ee(e,t){let n=`<div class="ic-container ic-create-comment">${be(e)}<div class="ic-body"><form class="aui" action="">`;if(!e.darkFeatures.RICH_TEXT_EDITOR){const i=""+("reply"==e.type?c.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"})):c.a.soy.$$escapeHtml(t({id:"inline.comments.create.placeholder"})));n+=`<textarea class="textarea ic-textarea" name="body" placeholder="${c.a.soy.$$escapeHtml(i)}">${c.a.soy.$$escapeHtml(e.text)}</textarea><div class="ic-actions"><ul><li>${c.a.aui.buttons.button({tagName:"button",text:t({id:"inline.comments.sidebar.save"}),type:"link",extraClasses:"ic-action-save",isDisabled:!0})}</li>${"topLevel"!=e.type?`<li>${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),type:"link",extraClasses:"ic-action-discard"})}</li>`:""}</ul></div>`}return n+="</form></div></div>",n}function ve(e,t){return`<div data-comment-id="${c.a.soy.$$escapeHtml(e.id)}" class="ic-container ic-display-comment">${be(e)}<div class="ic-body wiki-content"><div class="ic-content">${e.resolveProperties.resolved?`<blockquote><span class="ic-resolved-marker">${c.a.soy.$$escapeHtml(e.originalSelection)}</span></blockquote>`:""}${c.a.soy.$$filterNoAutoescape(e.body)}</div></div>${e.resolveProperties.resolved?function(e,t){return""+(e.darkFeatures.INLINE_COMMENTS?`<div class="ic-actions"><ul class="aui-list-truncate">${e.hasResolvePermission&&!e.isDangling?`<li>${c.a.aui.buttons.button({text:t({id:"inline.comments.resolved.menu.unresolve"}),type:"link",extraClasses:"ic-action-unresolve"})}</li>`:""}<li class="hidden">${c.a.aui.buttons.button({type:"link",extraClasses:"ic-action-show-reply"})}</li>${e.hasReply,""}${e.resolveProperties.resolvedTime>0?`<li class="ic-resolved-message">${c.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"success"})}  <span>${Ce({time:""+(e.isDangling&&e.resolveProperties.resolvedByDangling?c.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.dangling.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate})):c.a.soy.$$filterNoAutoescape(t({id:"inline.comments.resolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))),commentUrl:e.commentDateUrl})}</span></li>`:""}</ul></div>`:"")}(e,t):function(e,t){if(!e.darkFeatures.INLINE_COMMENTS)return"";return`\n    <div class="ic-actions">\n      <ul class="aui-list-truncate">\n        <li class="ic-action-like"></li>\n        ${e.hasResolvePermission&&e.darkFeatures.RESOLVED_INLINE_COMMENTS?`<li>\n            ${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.resolve"}),type:"link",extraClasses:"ic-action-resolve"})}\n          </li>`:""}\n      </ul>\n    </div>`}(e,t)}</div>${!e.resolveProperties.resolved&&e.resolveProperties.resolvedTime>0&&e.resolveProperties.resolvedUser?`<div class="ic-unresolved-message">${c.a.soy.$$escapeHtml(t({id:"inline.comments.unresolved.message"},{0:e.resolveProperties.resolvedUser,1:e.resolveProperties.resolvedFriendlyDate}))}</div>`:""}`}function ye(e,t){return`${c.a.aui.buttons.button({type:"text",id:"ic-nav-next",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-down",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.next.ic.description"})}})}${c.a.aui.buttons.button({type:"text",id:"ic-nav-previous",extraClasses:"aui-button-text",iconType:"aui",iconClass:"aui-icon-small aui-iconfont-arrow-up",text:"",isDisabled:e.disabled,extraAttributes:{tabIndex:e.disabled?"":0,title:t({id:"inline.comments.sidebar.tooltip.previous.ic.description"})}})}${e.showIndex?`<span class="ic-nav-x-out-of-y">${c.a.soy.$$escapeHtml(t({id:"inline.comments.navigation.index.of"},{0:e.index,1:e.size}))}</span>`:""}`}function Ce(e){return`<a class="ic-date-link" title="${c.a.soy.$$escapeHtml(e.time)}" href="${c.a.soy.$$escapeHtml("/wiki"+e.commentUrl)}"><span>${c.a.soy.$$escapeHtml(e.time)}</span></a>`}var Oe={comment:ve,commentForm:Ee,confirmDialog:function(e,t){return`<strong class="ic-confirm-label">${c.a.soy.$$escapeHtml(e.label)}</strong><div class="ic-confirm-message">${c.a.soy.$$escapeHtml(e.message)}</div><div class="ic-confirm-buttons">${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),tagName:"button",extraClasses:["ic-action-delete-confirm","aui-button-compact"]})}${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.cancel"}),tagName:"button",type:"link",extraClasses:["ic-action-cancel-confirm","aui-button-compact"]})}</div>`},createComment:function(e,t){return`<div class="ic-comment-container">${"topLevel"==e.type||"pageComment"==e.type?ge({showMenu:!1,createComment:!0,darkFeatures:e.darkFeatures},t):""}${Ee(e,t)}</div>`},deleteComment:function(e){return`<div class="ic-comment-container ic-deleted">${ge({createComment:!1,showMenu:!1},e)}<div class="ic-delete-comment-view"><h2><span class="aui-icon ic-delete-image line">::before</span>${c.a.soy.$$escapeHtml(e({id:"inline.comments.sidebar.deleted"}))}</h2></div></div>`},displayComment:function(e,t){return`\n    <div class="ic-comment-container">\n      ${ge({hasDeletePermission:e.hasDeletePermission,hasResolvePermission:e.hasResolvePermission,hasEditPermission:e.hasEditPermission,hasReplyPermission:e.hasReplyPermission,showMenu:e.showMenu&&!e.resolveProperties.resolved,darkFeatures:e.darkFeatures},t)}\n      ${e.resolveProperties.resolved?function(e,t){return`<div class="ic-resolved-mask"><div class="ic-resolved-mask-content"><h2 class="ic-resolved-icon">${c.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})}${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.resolved"}))}</h2></div><div class="resolved-message-container"><div class="resolved-message-sideline"><p>${c.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.message"}))}</p>${c.a.aui.buttons.button({text:t({id:"adg3.onboarding.docs.link"}),href:"https://confluence.atlassian.com/display/ConfCloud/Comment+on+pages+and+blog+posts#Commentonpagesandblogposts-Resolveinlinecomments",type:"link",extraAttributes:{target:"_blank"},id:"show-resolved-comments"})}</div></div></div>`}(0,t):ve(e,t)}\n    </div>\n    ${e.resolveProperties.resolved?"":'<div class="ic-list"></div>\n      '+(e.hasReplyPermission?`<div class="ic-reply-container">\n          ${e.darkFeatures.INLINE_COMMENTS&&e.hasReplyPermission?`<div class="ic-reply-placeholder">\n              ${be({authorAvatarUrl:e.currentAuthorAvatarUrl,authorDisplayName:e.currentAuthorDisplayName,authorAccountId:e.currentAuthorAccountId,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled})}\n              <div class="ic-body">\n                <form class="aui">\n                  <textarea class="textarea ic-textarea" name="body" placeholder="${c.a.soy.$$escapeHtml(t({id:"inline.comments.create.reply.placeholder"}))}" />\n                </form>\n              </div>\n            </div>`:""}\n        </div>`:"")}`},highlightTextLink:function(e){return`${c.a.aui.icons.icon({useIconFont:!0,size:"small",icon:"link"})}<a href='${c.a.soy.$$escapeHtml(e.link)}'>${c.a.soy.$$escapeHtml(e.link)}</a>`},likes:function(e,t){return`${e.showLikeButton?c.a.aui.buttons.button({text:e.isLikedByUser?t({id:"inline.comments.likes.unlike"}):t({id:"inline.comments.likes.like"}),type:"link",extraClasses:"ic-like-button"}):""}${e.likesCount>0?`<span class="ic-like-summary"><span class="ic-small-like-icon"></span><a class="ic-likes-count" data-content-id="${c.a.soy.$$escapeHtml(e.contentId)}"><span class="ic-like-summary">${c.a.soy.$$escapeHtml(e.likesCount)}</span></a></span>`:""}`},navigation:ye,pageComment:function(e,t){return`<div class="ic-comment-container">${ge({createComment:!1,showMenu:!1},t)}<div class="ic-page-comment-view"><div class="ic-page-comment"><div class="ic-page-comment-content"><h2 class="ic-resolved-icon">${c.a.aui.icons.icon({useIconFont:!0,size:"large",icon:"success",extraClasses:"line"})}${c.a.soy.$$escapeHtml(t({id:"inline.comments.sidebar.saved"}))}</h2></div><div class="ic-page-comment-message-container"><div class="ic-page-comment-message-sideline"><p>${c.a.soy.$$escapeHtml(t({id:"page.comments.saved.dialog.message"}))}</p><button id="show-page-comment" class="aui-button aui-button-link" data-comment-id="${c.a.soy.$$escapeHtml(e.commentId)}">${c.a.soy.$$escapeHtml(t({id:"inline.comments.resolved.dialog.show.me"}))}</button></div></div></div></div></div>`},renderReply:function(e,t){return`${be(e)}<div class="ic-body wiki-content"><div class="ic-content ic-reply-content">${c.a.soy.$$filterNoAutoescape(e.body)}</div></div>${e.darkFeatures.INLINE_COMMENTS&&!e.resolved?function(e,t){return`\n    <div class="ic-actions">\n      <ul>\n        <li class="ic-action-like-reply"></li>\n        ${e.hasDeletePermission?`<li>\n            ${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.delete"}),type:"link",extraClasses:"ic-action-delete-reply"})}\n          </li>`:""}\n        ${e.hasEditPermission?`<li>\n            ${c.a.aui.buttons.button({text:t({id:"inline.comments.sidebar.edit"}),type:"link",extraClasses:"ic-action-edit-reply"})}\n          </li>`:""}\n      </ul>\n    </div>`}(e,t):`<div>${Ce({time:e.lastModificationDate,commentUrl:e.commentDateUrl})}</div>`}`},resolvedCommentDialog:function(e,t){return""+c.a.aui.dialog.dialog2({id:"ic-resolved-comment-dialog",removeOnHide:!0,extraClasses:"ic-resolved-comment-dialog-content",modal:!0,titleText:t({id:"inline.comments.resolved.view.menu"}),footerActionContent:""+c.a.aui.buttons.button({id:"resolved-dialog-close-button",text:t({id:"inline.comments.sidebar.close"}),type:"link"}),content:'\x3c!-- Placeholder for error message --\x3e<div id="ic-resolved-comment-dialog-error" />'})},showmoreReply:function(e,t){return`<div id="ic-showmore-container"><div class="ic-decor-line"/><div class="ic-decor-line"/><div class="ic-collapse-decor-center"><span>${c.a.soy.$$escapeHtml(t({id:"inline.comments.expand.replies"},{0:e.totalReplies}))}</span></div></div>`}};var Ie=m.a.View.extend({el:"[data-inline-comments-target=true]:first",events:{"click .inline-comment-marker.valid":"commentClick","click span[data-mark-type=confluenceInlineComment].valid":"commentClick","click span[data-mark-type=annotation][data-mark-annotation-type=inlineComment].valid":"commentClick"},initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.collection&&(this.listenTo(this.collection,"sync remove change:deleted",this.render),this.listenTo(this.collection,"change:active",this.setActive)),this.listenTo(m.a,"ic:view ic:overlap ic:sidebar-hidden",this.clearSelection),this.listenTo(m.a,"ic:persist",this.persistComment),this.listenTo(m.a,"ic:delete",this.render),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),o.a.bind("qr:add-new-highlight-text.ic-highlight",this._addQuickReloadMarker)},destroy(){o.a.unbind(".ic-highlight"),this.stopListening(),this.undelegateEvents()},render(){this.inlineLinks=[],this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("valid"),this.collection.each((function(e){e.isResolved()||e.get("deleted")||!e.highlights||"current"!==e.attributes.contentStatus||(e.highlights.addClass("valid"),this._pushToInlineLinks(e.highlights))}),this),this._setupLinkDialog(),o.a.trigger("ic-highlight-rendered",this.collection)},_pushToInlineLinks(e){const t=this;e.each((function(){A.getInlineLinks(this).each((function(){Object(i.default)(this).attr("href")&&t.inlineLinks.push(Object(i.default)(this))}))}))},_setupLinkDialog(){const e={width:200,onHover:!0,noBind:!0,calculatePositions:this._calculatePositions,hideDelay:1e3};Object(i.default)(this.inlineLinks).each((function(){const t=this;o.a.InlineDialog(t,"inline-comment-link",(e,n,i)=>(e.addClass("inline-comment-link"),e.html(Oe.highlightTextLink({link:t.attr("href")})),i(),!1),e)}))},_calculatePositions:(e,t,n)=>({displayAbove:!0,popupCss:{top:t.target.offset().top-e.height()-10,left:n.x-e.width()/2},arrowCss:{top:e.height(),left:e.width()/2-4}}),setActive(e){this.$(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("active");const t=this.$(`.inline-comment-marker[data-ref="${e.get("markerRef")}"],span[data-mark-type=confluenceInlineComment][data-reference="${e.get("markerRef")}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${e.get("markerRef")}"]`);e.get("active")&&t.length&&t.addClass("active")},commentClick(e){e.preventDefault(),e.stopPropagation(),Object(g.b)().start({name:b.a.VIEW_INLINE_COMMENT,collect:(e,t)=>{Object(G.a)([b.a.VIEW_INLINE_COMMENT_TOP_LEVEL,b.a.VIEW_INLINE_COMMENT_REPLY])(e,t)},attributes:{renderer:q,mode:$.c.VIEW,framework:$.b.BACKBONE}});try{const t=this.$(e.currentTarget),n=t.parentsUntil(".active",".inline-comment-marker.valid");let i;e.originalEvent.isTrusted||(i="programmaticClick"),t.hasClass("active")?m.a.trigger("ic:hide-sidebar",e,!0):n.length>0?this.displayComment(n.last(),i):this.displayComment(t,i)}catch(t){Object(g.b)().fail({name:b.a.VIEW_INLINE_COMMENT,error:t})}},displayComment(e,t){if(A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){const n=e.data("ref")||e.data("reference")||e.data("id"),i=this.collection.findWhere({markerRef:n});this.sendAnalytics(i),m.a.trigger("ic:view",i,t)}},clearSelection(){(new pe).removeHighlight()},persistComment(e){Object(i.default)("button[data-test-id='fabric-edit-button']")?this.$(".ic-current-selection").removeClass("ic-current-selection").attr("data-mark-type","annotation").attr("data-mark-annotation-type","inlineComment").attr("data-id",e.get("markerRef")).addClass("valid"):this.$(".ic-current-selection").removeClass("ic-current-selection").addClass("inline-comment-marker").attr("data-ref",e.get("markerRef")),this.collection.add(e)},_addQuickReloadMarker(e,t,n){const i=t.comment;if(this.$(`.inline-comment-marker[data-ref="${i.dataRef}"],span[data-mark-type=confluenceInlineComment][data-reference="${i.dataRef}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${i.dataRef}"]`).length)return void n.resolve(t);(new pe).deserializeHighlights(i.serializedHighlights,i.dataRef)?n.resolve(t):n.reject(t)},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e},async sendAnalytics(e){const t=await A.getAnalyticsClient,{attributes:{containerId:n},collection:i}=e,a=A.getUnresolvedComments(i);t.sendTrackEvent({source:"viewPageScreen",actionSubject:"inlineCommentsSidebar",action:"viewed",objectType:"page",objectId:n,attributes:{pageType:o.a.Meta.get("draft-type"),commentsDeckSize:a.length,resolvedComments:i.length-a.length}})}}),we=n("7nmT"),Te=n.n(we),ke=n("Czhu"),Ne=n("HbGN"),_e=n("ERkP"),Me=n.n(_e),je=n("96U/"),Re=n("aWzz"),Se=n.n(Re),Ae=n("EcEE");class De extends _e.Component{render(){var e;const{userId:t}=this.props,n=null!=(e=this.props)&&null!=(e=e.dangerouslySetInnerHTML)?e.__html:e;return Me.a.createElement(Ae.a,{userId:t,fullName:n,isAnonymous:!t,referralSource:"inline-comments-header"})}}var Pe=n("bR0+");const xe=e=>e.getAttribute("data-account-id"),Le=e=>{const t={class:"className"},n={};return(e=>Array.from(e.attributes).map(e=>e.name))(e).forEach(i=>{n[t[i]||i]=e.getAttribute(i)}),n.dangerouslySetInnerHTML={__html:e.innerHTML},n};const $e=e=>{const t=Array.from(e.el.querySelectorAll(".ic-author")).filter(e=>null!==e.querySelector(".confluence-userlink")).map(e=>e.querySelector(".confluence-userlink"));var n,i;(n=t,n.filter(xe).map(e=>{const t=Le(e);t["data-user-hover-bound"]="true",t.href=Object(Pe.a)(t["data-account-id"],null,i);const n=c.a.document.createElement("span");return e.parentNode?(e.parentNode.replaceChild(n,e),{props:t,placeholder:n}):{}})).forEach(e=>{const t=e.props,{"data-account-id":n}=t,i=Object(Ne.a)(t,["data-account-id"]);Object(je.a)(Me.a.createElement(De,Object(ke.a)({userId:n},i),e.props.children),e.placeholder)})},Fe=e=>{Array.from(e.el.querySelectorAll(".ic-author a[data-account-id]")).filter(e=>e.getAttribute("href").startsWith("/people/")).forEach(e=>e.setAttribute("href",`${fe.a}${e.getAttribute("href")}`))};var He=n("yLoQ"),Ve=m.a.View.extend({className:"ic-likes",render(){return this.el&&Object(je.a)(Me.a.createElement(He.a,{contentId:""+this.options.contentId,containerId:""+this.options.containerId,containerType:this.options.containerType,isForInlineComment:!0}),this.el),this}}),Be=n("A79P");function Ue(){o.a.Confluence.EditorLoader.resourcesLoaded()||this.$form.find(".loading-container").spin("small")}function ze(){o.a.Meta.set("content-type","comment"),o.a.Meta.set("use-inline-tasks","false"),o.a.Meta.set("min-editor-height",80)}function Ge(e){var t,n;e.$form.find(".loading-container").hide(),e.$form.find("#rte-button-publish").text(this.formatMessage({id:"inline.comments.sidebar.save"})).removeAttr("title"),e.$form.find("#toolbar-hints-draft-status").hide(),this.hideCancelButton&&e.$form.find("#rte-button-cancel").hide(),e.editor.onPostProcess.add((t="onPostProcess",n=e.editor,function e(){c.a.tinymce.DOM.setStyle(c.a.tinymce.DOM.get(n.id+"_ifr"),"height","80px"),n.execCommand("mceAutoResize",{forceExec:!0}),n[t].remove(e)})),c.a.Confluence.Editor&&!c.a.Confluence.Editor.getContentType&&o.a.Confluence.QuickEdit.QuickEditPage.disable(),c.a.Confluence.Editor.removeAllCancelHandlers(),c.a.Confluence.Editor.removeAllSaveHandlers()}var qe={init:function(e){return"true"!==e.isMacroBrowserCheckEnabled||o.a.MacroBrowser&&o.a.MacroBrowser.setMacroJsOverride?(this.formatMessage=e.formatMessage,o.a.Confluence.QuickEdit.activateEditor({preActivate:Ue,preInitialise:ze,postInitialise:i.default.proxy(Ge,e),toolbar:!1,$container:e.container,$form:e.form,saveHandler:e.saveHandler,cancelHandler:e.cancelHandler,fetchContent:e.fetchContent(),closeAnyExistingEditor:!0,postDeactivate:e.postDeactivate,plugins:A.getSupportedRtePlugins(),excludePlugins:A.getUnsupportedRtePlugins()})):i.default.Deferred().reject()},remove:function(){return o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor()?o.a.Confluence.QuickEdit.deactivateEditor():i.default.Deferred().resolve()},getContent:function(){return o.a.Rte.Content.getHtml()},setEditorBusy:function(e){e?Object(i.default)(".ic-sidebar #rte-spinner").spin():Object(i.default)(".ic-sidebar #rte-spinner").spinStop(),Object(i.default)("#rte-button-publish").prop("disabled",e)}},We=n("gwLK"),Ye=n("lZoD"),Ke=n("rClA"),Qe=n("uDfI"),Je=n("JxFu"),Xe=n("FdGg"),Ze=n("X2PC"),et=n("8TdO"),tt=n("7M9M"),nt=n("lEaq"),it=n.n(nt),at=n("W47X"),ot=n("mGwS");function rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function st(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var ct=function(e){function t(){var n,i;rt(this,t);for(var a=arguments.length,o=Array(a),r=0;r<a;r++)o[r]=arguments[r];return n=i=st(this,e.call.apply(e,[this].concat(o))),i.history=Object(at.a)(i.props),st(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.componentWillMount=function(){it()(!this.props.history,"<BrowserRouter> ignores the history prop. To use a custom history, use `import { Router }` instead of `import { BrowserRouter as Router }`.")},t.prototype.render=function(){return Me.a.createElement(ot.a,{history:this.history,children:this.props.children})},t}(Me.a.Component);ct.propTypes={basename:Se.a.string,forceRefresh:Se.a.bool,getUserConfirmation:Se.a.func,keyLength:Se.a.number,children:Se.a.node};var lt=ct,dt=n("7a7X"),ut=n("KIs4"),mt=n("Vgb+"),ht=n("6z9Z"),pt=n("MV18"),ft=n("9m+Y"),gt=n("+mzV"),bt=n("Al9w"),Et=n("AeT/"),vt=n("HEM+"),yt=n("1U1M"),Ct=n("L21V"),Ot=n("KsTJ"),It=n("RjSO"),wt=n("wMvT"),Tt=n.n(wt),kt=n("wn7R"),Nt=n("zJ/j"),_t=n("3IV/"),Mt=n("rhcL"),jt=n("8Kf2"),Rt=n("ltac"),St=n("dIe6"),At=n("vdGo"),Dt=n("o0lc"),Pt=n("g92I"),xt=n("LPS5"),Lt=n("H5qd"),$t=n.n(Lt);const Ft=$t.a`query InlineCommentEditQuery($contentId:ID!){content(id:$contentId){edges{node{id type body{atlas_doc_format{value}}space{id}status}}}}`,Ht=$t.a`query InlineCommentNewQuery($contentId:ID!){content(id:$contentId){edges{node{id type space{id}status}}}}`,Vt=$t.a`mutation InlineCommentsFabricSaveCommentMutation($params:ExperimentalFabricInlineCommentInput)@experimental{experimentalSaveFabricInlineComment(params:$params){result{id authorAccountId authorDisplayName authorUserName authorAvatarUrl body commentDateUrl hasDeletePermission hasEditPermission hasReplyPermission hasResolvePermission lastModificationDate markerRef parentCommentId originalSelection resolveProperties{resolved resolvedTime resolvedByDangling}}error{errorId message}}}`,Bt=$t.a`mutation InlineCommentsFabricSaveReplyMutation($params:ExperimentalFabricInlineReplyInput)@experimental{experimentalSaveFabricInlineReply(params:$params){result{id authorAccountId authorDisplayName authorUserName authorAvatarUrl body commentDateUrl hasDeletePermission hasEditPermission lastModificationDate commentId}error{errorId message}}}`,Ut=$t.a`query EditContentPermissionQuery($contentId:ID!){content(id:$contentId){nodes{id type operations{operation targetType}}}}`,zt=Ot.default.div`
  height: 143px;
  width: 97%;
  background: ${_t.N0};
`;zt.displayName="StyledLoadingContainer";const Gt=Ot.default.div`
  padding-top: 12px;
  padding-bottom: 12px;
  display: flex;
  justify-content: flex-end;
`,qt=Ot.default.div`
  padding: 30px 0;
`,Wt=Ot.default.div`
  padding-bottom: 12px;
  & [aria-label="calendar"] td > div {
    margin: 0 -1px;
  }
`,Yt=e=>{var t,n,i;const a=null!=(i=e)&&null!=(i=i.content)&&null!=(i=i.edges)&&null!=(i=i[0])&&null!=(i=i.node)&&null!=(i=i.body)&&null!=(i=i.atlas_doc_format)?i.value:i,o=(null!=(n=e)&&null!=(n=n.content)&&null!=(n=n.edges)&&null!=(n=n[0])&&null!=(n=n.node)&&null!=(n=n.space)?n.id:n)||"",r=null!=(t=e)&&null!=(t=t.content)&&null!=(t=t.edges)&&null!=(t=t[0])&&null!=(t=t.node)?t.type:t;return{adfContent:a?JSON.parse(a):null,spaceId:o,contentType:r}},Kt=e=>{switch(e){case W:case Y:return"create";case K:case Q:return"edit"}},Qt=({container:e,model:t,type:n,onCancel:i,onSaveSuccess:a,onSaveError:o,onContentChange:r})=>{var s,c;const{attributes:{id:l,containerId:d,containerType:u}}=t,[m,h]=Object(_e.useState)(e),p=Object(_e.useContext)(ht.a),[f,g]=Object(_e.useState)(b.a.ADD_INLINE_COMMENT),[E,v]=Object(_e.useState)(b.a.ADD_INLINE_COMMENT_LOAD),[y,C]=Object(_e.useState)(b.a.ADD_INLINE_COMMENT_PUBLISH),O=Object(_e.useRef)(()=>{}),{createAnalyticsEvent:I}=Object(It.a)();Object(_e.useEffect)(()=>{e&&h(e.querySelector(".ic-body"))},[e]),Object(_e.useEffect)(()=>{switch(n){case W:g(b.a.ADD_INLINE_COMMENT),v(b.a.ADD_INLINE_COMMENT_LOAD),C(b.a.ADD_INLINE_COMMENT_PUBLISH);break;case Y:g(b.a.REPLY_TO_INLINE_COMMENT),v(b.a.REPLY_TO_INLINE_COMMENT_LOAD),C(b.a.REPLY_TO_INLINE_COMMENT_PUBLISH);break;case K:case Q:g(b.a.EDIT_INLINE_COMMENT),v(b.a.EDIT_INLINE_COMMENT_LOAD),C(b.a.EDIT_INLINE_COMMENT_PUBLISH);break;default:throw new Error("Unknown inline comment type name: "+n)}},[n]);const w=n===W||n===Y,T=w?Ht:Ft,k=w?d:l,{data:N,loading:_,error:M}=Object(yt.d)(T,{variables:{contentId:k}}),{data:j}=Object(yt.d)(Ut,{variables:{contentId:d}}),R=null!=(c=j)&&null!=(c=c.content)&&null!=(c=c.nodes)&&null!=(c=c[0])?c.type:c,S=((null!=(s=j)&&null!=(s=s.content)&&null!=(s=s.nodes)&&null!=(s=s[0])?s.operations:s)||[]).filter(({operation:e,targetType:t})=>"update"===e&&t===R).length>0,[A]=Object(yt.c)(Vt,{refetchQueries:[{query:xt.a,variables:{pageId:d}}]}),[D]=Object(yt.c)(Bt),P=Object(_e.useCallback)(e=>{const{translatedErrorId:t,errorToLog:n}=(e=>{const{message:t,errorId:n}=e;let i;switch(t){case te:i="inline.comments.fabric.editor.error.view.not.permitted";break;case ne:i="inline.comments.fabric.editor.error.create.not.permitted";break;case ie:i="inline.comments.fabric.editor.error.delete.not.permitted";break;case ae:i="inline.comments.fabric.editor.error.resolve.not.permitted";break;case oe:i="inline.comments.fabric.editor.error.edit.not.permitted";break;case se:i="inline.comments.fabric.editor.error.invalid.selection";break;case le:i="inline.comments.fabric.editor.error.cannot.be.empty";break;case ue:i="inline.comments.fabric.editor.error.captcha.check.failed";break;case me:i="inline.comments.fabric.editor.error.captcha.check.succeeded";break;case re:case Z:case ee:case ce:case de:default:i="inline.comments.fabric.editor.error.unexpected"}return{translatedErrorId:i,errorToLog:`${t}${n?` (errorId: ${n})`:""}`}})(e),{errorId:i}=e,a="inline.comments.fabric.editor.error.invalid.selection"===t;if(a||"inline.comments.fabric.editor.error.cannot.be.empty"===t){const e={errorMessage:n,editor:x.d.FABRIC,errorId:i};if(a){const t=new Range;t.selectNode(document.querySelector(".ic-current-selection"));const n=document.getSelection();n.removeAllRanges(),n.addRange(t);const i=Object(Pt.c)(document.querySelector("#content"),n.getRangeAt(0),d);e.matchTrace=JSON.stringify(i)}I({type:"sendOperationalEvent",data:{source:"viewPage",objectType:"page",objectId:d,action:"invalid",actionSubject:a?"highlight":"content",actionSubjectId:"inlineComment",attributes:e}}).fire()}else p.fail({name:f,error:new Error(n)});return o(t),Promise.reject()},[d,I,f,p,o]),L=Object(_e.useCallback)(e=>{e&&!e.isEditorAborted||i()},[i]),$=Object(_e.useCallback)((e,t)=>{const{spaceId:i,contentType:a}=Yt(t),o=n===K||n===Q?"updated":"created",r=e.id,s=e.commentId||e.parentCommentId,c={containerType:"space",containerId:i,source:"viewPageScreen",objectType:"page",objectId:d,action:o,actionSubject:"comment",actionSubjectId:r,attributes:{commentType:"inline",pageType:a,parentCommentId:s,editor:x.d.FABRIC,framework:"BACKBONE"}};I({type:"sendTrackEvent",data:c}).fire()},[d,I,n]),F=Object(_e.useCallback)((e,i)=>{const o=n===W||n===K;if(p.start({name:y,timeout:Be.a.EDITOR_PUBLISH,attributes:{mode:"view"}}),Object(Mt.e)(e))return P({message:le});const{attributes:{originalSelection:r,serializedHighlights:s,numMatches:c,matchIndex:l,authorDisplayName:m,authorAvatarUrl:h,parentCommentId:f,lastFetchTime:g,id:b,authorAccountId:E,commentId:v,lastModificationDate:C,commentDateUrl:O,hasDeletePermission:I,hasEditPermission:w}}=t;let T,k;return o?(T=A,k={variables:{params:{contentId:d,contentType:u||"page",adfContent:JSON.stringify(e),commentId:b,requestType:n===W?"add":"edit",originalSelection:r,serializedHighlights:s,numMatches:c,matchIndex:l,authorDisplayName:m,authorAvatarUrl:h,parentCommentId:f,lastFetchTime:g,createdFrom:"renderer"}}}):(T=D,k={variables:{params:{contentId:d,adfContent:JSON.stringify(e),replyId:b,requestType:n===Y?"reply":"edit-reply",authorDisplayName:m,authorAvatarUrl:h,authorAccountId:E,parentCommentId:v,hasDeletePermission:I,hasEditPermission:w,lastModificationDate:C,commentDateUrl:O}}}),T(k).then(({data:e})=>{let r,s;if(o?(r=e.experimentalSaveFabricInlineComment.error,s=e.experimentalSaveFabricInlineComment.result):(r=e.experimentalSaveFabricInlineReply.error,s=e.experimentalSaveFabricInlineReply.result),r)return P(r);n===Q&&(s.authorAccountId=t.attributes.authorAccountId,s.authorUserName=t.attributes.authorUserName),a(s),$(s,i)}).catch(e=>{if(!e)return Promise.reject();let{message:t}=e;if(-1!==t.indexOf("{")){const e=t.substr(t.lastIndexOf("}")+3);t="GraphQL Error: "+e}return P({message:t})})},[y,d,u,t,$,A,D,P,n,a,p]),H=Object(_e.useCallback)(()=>{r()},[r]),V=Object(_e.useCallback)(()=>{p.succeed({name:E})},[E,p]),B=Object(_e.useCallback)(e=>{if(e&&!Object(Rt.d)(e)){let t=e;for(;t&&!t.classList.contains("ic-create-comment-view");)t=t.parentElement;O.current(t)}},[O]),{adfContent:U,spaceId:z}=Yt(N);return Te.a.createPortal(Me.a.createElement(_e.Fragment,null,_&&Me.a.createElement(_e.Fragment,null,Me.a.createElement(zt,null),Me.a.createElement(Gt,null,Me.a.createElement(kt.a,null,Me.a.createElement(Nt.a,{appearance:"primary",isDisabled:!0},Me.a.createElement(Ct.c,{id:"inline.comments.fabric.inline.button.save",defaultMessage:"Save",description:"Button label for save button for fabric inline comments"})),n!==W&&Me.a.createElement(Nt.a,{appearance:"subtle",isDisabled:!0},Me.a.createElement(Ct.c,{id:"inline.comments.fabric.inline.button.cancel",defaultMessage:"Cancel",description:"Button label for cancel button for fabric inline comments"}))))),M&&Me.a.createElement(St.a,{error:M},Me.a.createElement(qt,null,Me.a.createElement(Tt.a,{size:"medium",primaryColor:_t.R400}),Me.a.createElement(Ct.c,{id:"inline.comments.fabric.sidebar.loading.error",defaultMessage:"An error occurred, please close the comment window and try again",description:"Generic loading error for fabric inline comments sidebar"})),Me.a.createElement(At.a,{name:E,error:M})),N&&Me.a.createElement(Wt,null,Me.a.createElement(jt.a,{pageId:d,pageType:u,appearance:"chromeless",commentMode:Kt(n),spaceId:z,onSaveComment:e=>F(e,N),content:U,showCancelButton:n!==W,onCancelComment:L,onContentChange:H,onEditorReady:V,afterActivation:B,hasMediaUploadPermissions:S}),Me.a.createElement(Dt.a,null,({scrollToElement:e})=>(O.current=e,null)))),m)};var Jt=n("hATe");const Xt=Ot.default.div`
  display: flex;
  align-items: center;
`,Zt=Ot.default.div`
  height: ${({avatarSize:e})=>"medium"===e?"36px":"28px"};
  width: ${({avatarSize:e})=>"medium"===e?"36px":"28px"};
`,en=Ot.default.div`
  padding-left: 4px;
`,tn=Ot.default.div`
  display: flex;
  flex-direction: column;
  padding-left: 4px;
  font-size: 14px;
  line-height: 20px;

  a:first-of-type {
    font-weight: 500;
    color: ${_t.N600};

    &:visited,
    &:hover {
      color: ${_t.N600};
    }
  }
`,nn=Ot.default.a`
  font-size: 11px;
  line-height: 16px;

  &.ic-date-link {
    color: ${_t.N200};

    &:visited,
    &:hover {
      color: ${_t.N200};
    }
  }
`;nn.displayName="StyledCommentDateLink";const an=({model:e,container:t,header:n,avatarSize:i,showDate:a})=>{const[o,r]=Object(_e.useState)(n),{attributes:{authorAccountId:s,authorAvatarUrl:c,authorDisplayName:l,lastModificationDate:d,commentDateUrl:u}}=e;Object(_e.useEffect)(()=>{const e=t.querySelector(".ic-author");for(;e.firstChild;)e.removeChild(e.firstChild);r(e)},[t]);return Te.a.createPortal(Me.a.createElement(Xt,null,Me.a.createElement(Zt,{avatarSize:i},Me.a.createElement(Jt.a,{userId:s,src:c,size:i,trigger:"click"})),a?Me.a.createElement(tn,null,Me.a.createElement(Ae.a,{userId:s,fullName:l,referralSource:"inline-comment",canViewProfile:!1}),Me.a.createElement(nn,{className:"ic-date-link",href:"/wiki"+u},d)):Me.a.createElement(en,null,Me.a.createElement(Ae.a,{userId:s,fullName:l,referralSource:"inline-comment",canViewProfile:!1}))),o)},on=({container:e,model:t,selector:n})=>{const{attributes:{id:i,containerId:a,containerType:o,commentId:r}}=t,[s,c]=Object(_e.useState)(e);Object(_e.useEffect)(()=>{if(e){const t=e.querySelector(n);c(t)}},[e]);return s?Te.a.createPortal(Me.a.createElement(He.a,{contentId:""+i,containerId:a||String(r),containerType:o||"page",isForInlineComment:!0,isForComment:!1,showSeparator:!!t.replies||t.attributes.hasDeletePermission||t.attributes.hasEditPermission}),s):null};var rn=n("bU5Q"),sn=n("i4Pk"),cn=n("3oRx"),ln=n("Iy7w"),dn=n("RKN0");const un=Object(ln.a)("span",{target:"e19gntln0"})("color:",e=>e.isReply?"#707070":_t.N50,";font-size:12px;cursor:pointer;user-select:none;"),mn=Object(ln.a)("div",{target:"e19gntln1"})({name:"dkim4n",styles:"width:200px;user-select:none;"}),hn=Object(ln.a)("span",{target:"e19gntln2"})("color:",_t.B400,";display:inline;padding:0;cursor:pointer;:hover{text-decoration:underline;}"),pn=Object(ln.a)("span",{target:"e19gntln3"})({name:"kdqiw2",styles:"padding:3px 10px;font-size:14px;"}),fn=({container:e,isReply:t})=>{const[n,i]=Object(_e.useState)(e),[a,o]=Object(_e.useState)(!1);Object(_e.useEffect)(()=>{let n;if(t){const t=e.querySelector(".ic-action-edit-reply");t&&(n=t.parentElement)}else n=document.querySelector(".ic-sidebar-heading .ic-action-edit");for(;n&&n.firstChild;)n.removeChild(n.firstChild);i(n)},[e,t]);const r=Object(_e.useCallback)(()=>{const e=document.querySelector(".ic-reply-container textarea");e&&(e.click(),o(!1))},[a]),s=Me.a.createElement(mn,null,Me.a.createElement("p",null,Me.a.createElement(hn,{onClick:r},Me.a.createElement(Ct.c,{id:"no-edit.action.text",defaultMessage:"Add a new comment",description:"option to add a new comment"}))," ",Me.a.createElement(Ct.c,{id:"no-edit.reason",defaultMessage:"since this one cannot be edited; it contains content created in a legacy version of Confluence.",description:"reason for why we prevent editing the content"}))),c=Object(_e.useCallback)(()=>{o(!a)},[a]);return Te.a.createPortal(Me.a.createElement(dn.a,{content:s,isOpen:a,placement:t?"bottom":"bottom-end"},Me.a.createElement(un,{onClick:c,isReply:t},t?Me.a.createElement(Ct.c,{id:"no-edit.action.label",defaultMessage:"Edit is not available",description:"clickable text that tells the user they cannot edit this content"}):Me.a.createElement(pn,null,Me.a.createElement(Ct.c,{id:"no-edit.menu.action",defaultMessage:"Edit",description:"clickable text that is disabled in a menu context"})))),n)},gn=Ot.default.div`
  & .ak-renderer-document h1 {
    font-weight: 500;
  }
`,bn=({contentId:e,container:t,isReply:n,hasEditPermission:i})=>{const[a,o]=Object(_e.useState)(t),[r,s]=Object(_e.useState)(b.a.VIEW_INLINE_COMMENT_TOP_LEVEL),[c,l]=Object(_e.useState)(!1);Object(_e.useEffect)(()=>{let e;if(t&&(e=t.querySelector(".ic-content"),e)){for(;e.firstChild;)e.removeChild(e.firstChild);o(e)}},[t]),Object(_e.useEffect)(()=>{n&&s(b.a.VIEW_INLINE_COMMENT_REPLY)},[n]);const d=Object(_e.useCallback)(()=>{Object(g.b)().succeed({name:r})},[r]),u=Object(_e.useCallback)(e=>{Object(g.b)().fail({name:r,error:e})},[r]),m=Object(_e.useCallback)(()=>{l(!0)},[]);return Te.a.createPortal(Me.a.createElement(rn.d,null,Me.a.createElement(gn,null,Me.a.createElement(sn.a,{contentId:e,appearance:"comment",extensionHandlers:Object(cn.a)(m,e),contentType:n?"inlineReply":"inlineComment",onComplete:d,onError:u,allowDynamicTextSizing:!1}),c&&i&&Me.a.createElement(fn,{container:t,isReply:n}))),a)},En=Object(Et.a)();Object(bt.a)(En);const vn=(e,t={viewToRender:X,currentUserData:{}})=>{let n,i;const{viewToRender:a}=t;a===J?(n=e.el,i=".ic-action-like-reply"):a===Y||a===K||a===Q||a===W?n=e.el:(i=".ic-action-like",n=e.el.querySelector(".ic-container"));const o=n.querySelector(".ic-author"),r=n.innerHTML;let{model:s}=e;if(a===Y){const{currentUserData:{authorAccountId:e,authorDisplayName:n,authorAvatarUrl:i}}=t;s={attributes:{containerId:s.get("containerId"),containerType:"page",spaceKey:s.get("spaceKey"),authorDisplayName:n,authorAvatarUrl:i,authorAccountId:e,commentId:s.get("id"),hasEditPermission:!0,hasDeletePermission:s.get("hasDeletePermission")}}}Object(ut.b)(Object(et.getApolloClient)()).then(e=>{Te.a.render(Me.a.createElement(gt.a.Provider,{value:{spaceKey:s.attributes.spaceKey,contentId:s.attributes.containerId}},Me.a.createElement(Ye.b,null,Me.a.createElement(We.b,{client:Object(et.getApolloClient)()},Me.a.createElement(Qe.Provider,{store:En},Me.a.createElement(mt.a.Provider,{value:e},Me.a.createElement(ht.a.Provider,{value:Object(g.b)()},Me.a.createElement(ft.a,null,Me.a.createElement(Ke.b,{client:Object(h.getAnalyticsWebClient)()},Me.a.createElement(vt.a,null,Me.a.createElement(Je.a,null,Me.a.createElement(lt,null,Me.a.createElement(dt.a,{namedRoutes:tt.a},Me.a.createElement(Xe.a,{attribution:Ze.a.COLLABORATION},Me.a.createElement(_e.Fragment,null,Me.a.createElement("div",{dangerouslySetInnerHTML:{__html:r}}),Me.a.createElement(an,{container:n,model:s,header:o,avatarSize:a!==Y&&a!==W?"medium":"small",showDate:a===X||a===J}),(e=>{if(e===W||e===Y||e===K||e===Q){const{onCancel:i,onSaveSuccess:a,onSaveError:o,onContentChange:r}=t;return Me.a.createElement(Qt,{container:n,model:s,type:e,onCancel:i,onSaveSuccess:a,onSaveError:o,onContentChange:r})}return Me.a.createElement(bn,{contentId:s.id,container:n,isReply:e===J,hasEditPermission:s.get("hasEditPermission")})})(a),i&&Me.a.createElement(on,{container:n,model:s,selector:i}),a===X&&Me.a.createElement(pt.a,{name:b.a.VIEW_INLINE_COMMENT_TOP_LEVEL}),Me.a.createElement(pt.a,{name:b.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,attributes:{pageHasInlineComments:!0}}))))))))))))))),n)})};var yn=m.a.View.extend({tagName:"div",className:"ic-create-comment-view",events:{"click .ic-action-save":"saveComment","click .ic-action-discard":"discardComment","keyup .ic-textarea":"onInput","focus .ic-textarea":"onFocus","click #show-page-comment":"showPageComment"},template:Oe.createComment,initialize(e){this.formatMessage=e.formatMessage,this.selection=e.selection,this.type=e.type,this.onFinished=e.onFinished||function(){},this.commentText=e.commentText||"",this.stopFocus=e.stopFocus,this.serializedHighlights=e.serializedHighlights,this.isMacroBrowserCheckEnabled=e.isMacroBrowserCheckEnabled,this.isFabricEditorDirty=!1,"edit"!==e.type&&"reply"!==e.type&&"edit-reply"!==e.type||(this.template=Oe.commentForm,m.a.trigger("ic:discard-edit"),this.listenTo(m.a,"ic:discard-edit",this.discardComment)),this.listenTo(m.a,"ic:sidebar:close",this.discardComment),A.isSPAPage()?(this.isTinymceResourceReady="true"===Object(i.default)("."+A.getPageContentClassName()).attr("data-editor-resource-loaded"),this.isPendingRenderEditor=!1,this.listenTo(m.a,"ic:tinymce-resource-loaded",this.tinymceResourceLoaded)):this.isTinymceResourceReady=!0},tinymceResourceLoaded(){this.isTinymceResourceReady=!0,this.isPendingRenderEditor&&(this.isPendingRenderEditor=!1,this.renderEditor())},finish(){this.onFinished(),o.a.trigger("ic-jim-async-supported")},async render(){const e=await this._getAuthorObject(),t={type:this.type,text:this.commentText,showMenu:!1,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled},n=d.a.extend({},e,t,{darkFeatures:A.getDarkFeatures()});return this.$el.html(this.template(n,this.formatMessage)),this.renderEditor(!0),$e(this),"true"===this.options.isFrontendPeopleDirectoryEnabled&&Fe(this),A.addSidebarHeadingTooltip(this),this},onInput(e){const t=""!==this.$(e.target).val().trim();this._saveDisable(!t)},onFocus(){if("edit"===this.type||"edit-reply"===this.type){const e=this.$(".textarea");A.moveCaretToEnd(e[0]),this._saveDisable(""===e.text())}},saveComment(e){e.preventDefault(),this._isValid()&&(this._disableForm(),"reply"===this.type?this._addReply():"edit"===this.type||"edit-reply"===this.type?this._saveEdit():this._addComment())},_getAuthorObject(){let e,t,n;return"edit"===this.type||"edit-reply"===this.type?(e=this.model.get("authorAvatarUrl"),t=this.model.get("authorDisplayName"),n=this.model.get("authorAccountId"),Promise.resolve({authorAvatarUrl:e,authorDisplayName:t,authorAccountId:n})):A.getCurrentUserData()},_saveEdit(){const e=this._getContent(),t={wait:!0,beforeSend:d.a.bind(this.beforeSendAjax,this),success:d.a.bind(this._onSaveSuccess,this),error:d.a.bind(this._onEditError,this)};Object(g.b)().start({name:b.a.EDIT_INLINE_COMMENT_PUBLISH,timeout:Be.a.EDITOR_PUBLISH,attributes:{editor:x.d.TINY_MCE,mode:"view"}}),this.model.save({body:e},t)},_onEditError(e,t){if(this.showCaptchaError(t))return;let n,i;401===t.status?(i=this.formatMessage({id:"inline.comments.edit.permission"}),n="legacy-inline-comments edit permission error; status = "+t.status):(i=this.formatMessage({id:"inline.comments.server.edit.error"}),n="legacy-inline-comments edit error; status = "+t.status),this._triggerError(i),Object(g.c)(b.a.EDIT_INLINE_COMMENT_PUBLISH,new Error(n))},_triggerError(e,t){m.a.trigger("ic:error",e,t),this._disableForm(!1)},_addReply(){const e=new F({body:this._getContent(),commentId:this.model.get("id"),hasDeletePermission:Boolean(o.a.Meta.get("atlassian-account-id"))||this.model.get("hasDeletePermission")});Object(g.b)().start({name:b.a.REPLY_TO_INLINE_COMMENT_PUBLISH,timeout:Be.a.EDITOR_PUBLISH,attributes:{editor:x.d.TINY_MCE,mode:"view"}}),e.save(null,{beforeSend:d.a.bind(this.beforeSendAjax,this),success:d.a.bind(this._onSaveSuccess,this),error:d.a.bind((function(e,t){this.showCaptchaError(t)||(this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.reply"})),Object(g.c)(b.a.REPLY_TO_INLINE_COMMENT_PUBLISH,new Error("legacy-inline-comments reply save error; status = "+t.status)))}),this)})},_addComment(){const e=new V({originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),body:this._getContent(),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights});Object(g.b)().start({name:b.a.ADD_INLINE_COMMENT_PUBLISH,timeout:Be.a.EDITOR_PUBLISH,attributes:{editor:x.d.TINY_MCE,mode:"view"}}),e.save(null,{beforeSend:d.a.bind(this.beforeSendAjax,this),success:d.a.bind(this._onSaveSuccess,this),error:d.a.bind(this._onAddError,this)})},_onAddError(e,t){if(this.showCaptchaError(t))return;let n;409===t.status?(this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.stale"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),{callback:this.bindPageReloadLink}),n="legacy-inline-comments stale page; status = "+t.status):412===t.status?(o.a.trigger("analytics",{name:"confluence.comment.inline.cannot.create"}),this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.create.comment"})),n="legacy-inline-comments error create; status = "+t.status):(this._triggerError(this.formatMessage({id:"inline.comments.sidebar.error.save.comment"})),n="legacy-inline-comments error save; status = "+t.status),Object(g.c)(b.a.ADD_INLINE_COMMENT_PUBLISH,new Error(n))},_isValid(){return"<p><br /></p>"!==i.default.trim(this._getContent())||(m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.sidebar.comment.empty"})),!1)},_onSaveSuccess(e){let t;switch(this.type){case"topLevel":e.set&&e.set("hasDeletePermission",!0),m.a.trigger("ic:persist",e),m.a.trigger("ic:view",e,void 0),t=b.a.ADD_INLINE_COMMENT_PUBLISH;break;case"reply":this.model.replies.push(e),m.a.trigger("ic:reply:persist",e),this.finish(),t=b.a.REPLY_TO_INLINE_COMMENT_PUBLISH;break;case"edit":case"edit-reply":m.a.trigger("ic:edit"),this.finish(),t=b.a.EDIT_INLINE_COMMENT_PUBLISH}Object(g.b)().succeed({name:t})},_setEditorIsNotDirty(){o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor()&&(o.a.Rte.getEditor().isNotDirty=1)},_disableForm(e){void 0===e&&(e=!0),this._saveDisable(e),A.getDarkFeatures().RICH_TEXT_EDITOR||this.$(".ic-action-discard,.ic-textarea").prop("disabled",e).attr("aria-disabled",e)},_saveDisable(e){if(A.getDarkFeatures().RICH_TEXT_EDITOR){qe.setEditorBusy(e);const t=Object(i.default)("#rte-button-cancel");t.length>0&&(t[0].disabled=e)}else this.$(".ic-action-save").prop("disabled",e).attr("aria-disabled",e)},renderEditor(e){const t=this,n=this.$(".ic-body"),a=this.commentText;if(!e){const e=o.a.Confluence.QuickEdit.QuickComment;if(o.a.Confluence.QuickEdit)try{o.a.Confluence.QuickEdit.deactivateEditor()}catch(r){}return qe.init({formatMessage:t.formatMessage,container:n,form:n.find("form.aui"),saveHandler:"pageComment"===this.type?e.createSaveHandler(d.a.bind(this._successCreatePageComment,this),e.saveCommentErrorHandler):d.a.bind(this.saveComment,this),cancelHandler:d.a.bind(this.discardComment,this),fetchContent(){const e=new i.default.Deferred;return e.resolve({editorContent:a}),e},postDeactivate:d.a.bind((function(){m.a.trigger("ic:clearError"),this.finish()}),this),hideCancelButton:"topLevel"===this.type,isMacroBrowserCheckEnabled:this.isMacroBrowserCheckEnabled}).done(d.a.bind(this.renderEditorCompleted,this)).fail(d.a.bind(this.renderEditorFail,this))}{let e;switch(this.type){case"edit":e=K;break;case"reply":e=Y;break;case"edit-reply":e=Q,this.model.set({containerId:o.a.Meta.get("latest-page-id"),containerType:"page"});break;case"topLevel":default:e=W,this.model=new V({authorAccountId:A.getAuthorAccountId(),originalSelection:this.selection.searchText.selectedText.replace(/\n/g,""),matchIndex:this.selection.searchText.index,numMatches:this.selection.searchText.numMatches,serializedHighlights:this.serializedHighlights,parentCommentId:0})}this.model.set({spaceKey:o.a.Meta.get("space-key")}),vn(this,{viewToRender:e,onCancel:this.discardComment.bind(this),onSaveSuccess:e=>this.onFabricSaveSuccess(e),onSaveError:e=>this.onFabricSaveError(e),onContentChange:()=>this.onFabricContentChange(),currentUserData:{authorAccountId:A.getAuthorAccountId(),authorAvatarUrl:A.getAuthorAvatarUrl(),authorDisplayName:A.getAuthorDisplayName()}}),this.isReactRootMounted=!0}},showPageComment(e){const t=Object(i.default)(e.target).data("comment-id"),n=Object(i.default)("#comment-"+t);n.addClass("focused"),n.scrollToElement()},_successCreatePageComment(e){c.a.Confluence.CommentDisplayManager.addComment(A.getCurrentUserInfo(),e,!1,!1,!0),o.a.trigger("page.commentAddedOrUpdated",{commentId:e.id}),this._setEditorIsNotDirty(),A.getDarkFeatures().RICH_TEXT_EDITOR&&(this.keepSidebar=!0,qe.remove()),this.$el.html(Oe.pageComment({commentId:e.id},this.formatMessage)),A.addSidebarHeadingTooltip(this)},renderEditorCompleted(){m.a.trigger("ic:clearError"),"topLevel"!==this.type&&"pageComment"!==this.type||(this.$("#rte-button-cancel").hide(),"pageComment"===this.type&&(m.a.trigger("ic:error",this.formatMessage({id:"page.comments.sidebar.warning"})),this.focusEditor())),this.captchaManager=new o.a.Confluence.QuickEditCaptchaManager(o.a.Confluence.EditorLoader.getEditorForm()),"topLevel"===this.type?Object(g.b)().succeed({name:b.a.ADD_INLINE_COMMENT_LOAD}):"edit"===this.type||"edit-reply"===this.type?Object(g.b)().succeed({name:b.a.EDIT_INLINE_COMMENT_LOAD}):"reply"===this.type&&Object(g.b)().succeed({name:b.a.REPLY_TO_INLINE_COMMENT_LOAD})},renderEditorFail(){const e={closeable:!0,callback:this.bindPageReloadLink};switch(this.type){case"pageComment":this._setEditorIsNotDirty();break;case"topLevel":this.$(".loading-container").hide(),this.$(".ic-create-comment").hide(),e.closeable=!1;break;case"edit":case"edit-reply":case"reply":this.finish()}m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.editor.timeout"},{0:"<a href='#' class='ic-reload-page'>",1:"</a>"}),e),m.a.trigger("ic:editor:load:fail")},bindPageReloadLink(){Object(i.default)(".ic-error").off("click",".ic-reload-page").on("click",".ic-reload-page",()=>(c.a.location.reload(),!1))},discardComment(e){e&&e.preventDefault(),this.isFabricEditorDirty=!1,m.a.trigger("ic:fabric-editor-dirty",!1),"edit"!==this.type&&"edit-reply"!==this.type&&"reply"!==this.type||Object(g.b)().abort({name:"reply"===this.type?b.a.REPLY_TO_INLINE_COMMENT:b.a.EDIT_INLINE_COMMENT,reason:"cancel pressed"}),m.a.trigger("ic:clearError"),this.finish()},_getContent(){return A.getDarkFeatures().RICH_TEXT_EDITOR?qe.getContent():this.$("textarea").val()},focusEditor(){if(A.getDarkFeatures().RICH_TEXT_EDITOR)if("pageComment"===this.type){const e=Object(i.default)(o.a.Rte.getEditor()&&o.a.Rte.getEditor().getBody()).find("div")[0];o.a.Rte.getEditor().selection.select(e,1),o.a.Rte.getEditor().selection.collapse(1),e.focus()}else o.a&&o.a.Rte&&o.a.Rte.getEditor&&o.a.Rte.getEditor()&&o.a.Rte.getEditor().focus();else this.$(".ic-textarea:visible").focus()},destroy(){A.getDarkFeatures().RICH_TEXT_EDITOR&&qe.remove(),this.unmountReactBridge(),this.remove()},beforeSendAjax(e){const t=this.captchaManager.getCaptchaData();t&&t.id&&(e.setRequestHeader("X-Atlassian-Captcha-Id",t.id),e.setRequestHeader("X-Atlassian-Captcha-Response",t.response))},showCaptchaError(e){return!(404!==e.status||!e.responseText||-1==e.responseText.search(/captcha/i))&&(this.captchaManager.refreshCaptcha(),this._triggerError(this.formatMessage({id:"captcha.response.failed"})),!0)},trackAnalyticEvent(e,t){let n,a,r;try{n=e.attributes.id.toString(),a=e.changed.active?null:e.attributes.commentId.toString(),r=Object(i.default)(".view-page-body").get(0).dataset.spaceId}catch(c){}const s={containerType:"space",containerId:r,source:"viewPageScreen",objectType:"page",objectId:o.a.Meta.get("content-id"),action:"edit"===t||"edit-reply"===t?"updated":"created",actionSubject:"comment",actionSubjectId:n,attributes:{commentType:"inline",pageType:o.a.Meta.get("draft-type"),parentCommentId:a,editor:x.d.FABRIC}};Object(h.getAnalyticsWebClient)().then(e=>{e.sendTrackEvent(s)})},onFabricSaveSuccess(e){if(m.a.trigger("ic:clearError"),this.isFabricEditorDirty=!1,m.a.trigger("ic:fabric-editor-dirty",!1),"reply"===this.type){const t=new F(e);this._onSaveSuccess(t)}else this.model.set(e),this._onSaveSuccess(this.model)},onFabricSaveError(e){this._triggerError(this.formatMessage({id:e}))},onFabricContentChange(){this.isFabricEditorDirty||(this.isFabricEditorDirty=!0,m.a.trigger("ic:fabric-editor-dirty",!0))},unmountReactBridge(){if(this.isReactRootMounted){const e=this.el;Te.a.unmountComponentAtNode(e)&&(this.isReactRootMounted=!1)}}}),Cn=m.a.View.extend({tagName:"div",className:"ic-confirm-container",initialize(e){this.formatMessage=e.formatMessage,this.$menuEl=e.$menuEl,this.$bodyEl=e.$bodyEl,this.$menuEl.addClass("ic-action-menu-active"),this.render(),d.a.bindAll(this,"clickOutside"),this.$bodyEl.on("click",this.clickOutside)},events:{"click .ic-action-cancel-confirm":"cancel","click .ic-action-delete-confirm":"confirm"},template:Oe.confirmDialog,render(){return this.$el.html(this.template(this.model.toJSON(),this.formatMessage)),this},clickOutside(e){i.default.contains(this.el,e.target)||this.el===e.target||this.cancel()},cancel(){this.destroy()},confirm(){this.trigger("ic:confirm"),this.destroy()},destroy(){this.$bodyEl.off("click",this.clickOutside),this.$menuEl.removeClass("ic-action-menu-active"),this.remove()}}),On=m.a.View.extend({tagName:"div",className:"ic-display-reply",template:Oe.renderReply,events:{"click .ic-action-edit-reply":"editReply","click .ic-action-delete-reply":"confirmDelete"},initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),d.a.bindAll(this,"onEditCallback"),this.$el.attr("data-comment-id",this.model.get("id"))},_renderLikes(){const e=this.el&&this.el.querySelector(".ic-action-like-reply");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(t=>{t?(this.likesView&&this.likesView.remove(),this.likesView=new Ve({contentId:this.model.id,el:e,container:this.el,selector:".ic-action-like-reply"}).render()):e&&e.remove()}):e&&e.remove()},render(){try{const e=d.a.extend(this.model.toJSON(),{resolved:this.options.resolved,darkFeatures:A.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled});if(!0===this.isReactRootMounted){Te.a.unmountComponentAtNode(this.el)&&(this.isReactRootMounted=!1)}const t=this.template(e,this.formatMessage);this.$el.html(t),vn(this,{viewToRender:J}),this.isReactRootMounted=!0}catch(e){Object(g.b)().fail({name:b.a.VIEW_INLINE_COMMENT_REPLY,error:e})}return"true"===this.options.isFrontendPeopleDirectoryEnabled&&Fe(this),this},editReply(e){if(A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){Object(L.b)({name:b.a.EDIT_INLINE_COMMENT,id:P()(),attributes:{editor:x.d.FABRIC,type:"reply",mode:$.c.VIEW,framework:$.b.BACKBONE}},{name:b.a.EDIT_INLINE_COMMENT_LOAD},{name:b.a.EDIT_INLINE_COMMENT_PUBLISH});A.getEditorFormat(this.model.get("id")).done(e=>{Te.a.unmountComponentAtNode(this.el)&&(this.isReactRootMounted=!1),this.editView=new yn({model:this.model,type:"edit-reply",selection:{},onFinished:this.onEditCallback,commentText:e,formatMessage:this.formatMessage,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.$el.html(this.editView.$el),this.editView.render()}).fail((e,t,n)=>{A.failEditDisplay(this.formatMessage({id:"inline.comments.server.error.edit.reply"}),{errorThrown:n})})}else e&&e.currentTarget.blur()},onEditCallback(){this.editView&&this.editView.destroy(),this.editView=null,this.render()},deleteFail(e,t){401===t.status?m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.permission"})):m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.server.error"}))},confirmDelete(e){!0===window.confirm(this.formatMessage({id:"inline.comments.delete.reply.confirmation.message"}))&&this.deleteReply(e)},deleteReply(e){Object(i.default)(e.target).attr("aria-disabled",!0).prop("disabled",!0),this.model.destroy({wait:!0,error:this.deleteFail,success(){m.a.trigger("ic:reply:delete")}})},destroy(){this.likesView&&this.likesView.remove(),this.editView&&this.editView.destroy(),this.remove()},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e}}),In=m.a.View.extend({tagName:"div",className:"ic-replies",events:{"click #ic-showmore-container":"forceShowAllReplies"},initialize(e){if(this.formatMessage=e.formatMessage,!e.commentModel)throw new Error("Inline Comment Model should be passed as a parameter when init ReplyListView","ReplyListView");this.replyViews=[],this.collection=e.commentModel.replies,this.source=e.source,this.listenTo(this.collection,"add remove",this.render),!0!==this.collection.isFetched&&(this.listenToOnce(this.collection,"sync",this.fetchComplete),this.collection.fetch({reset:!0,cache:!1})),this.expandReplies=!1,this.COMMENT_NUMBER_TO_COLLAPSE=4},fetchComplete(){this.collection.isFetched=!0,this.render(),A.resizeContentAfterLoadingImages(this.$el)},render(e){if(!0!==this.collection.isFetched)return this;this.replyExperienceHasStarted||(this.replyExperienceHasStarted=!0,Object(g.b)().start({name:b.a.VIEW_INLINE_COMMENT_REPLY,attributes:{mode:$.c.VIEW,framework:$.b.BACKBONE}}));try{return e&&this.collection.last()===e?void this.appendReply(e):(this.cleanUpReplyViews(),this.$el.empty(),this.collection.length>this.COMMENT_NUMBER_TO_COLLAPSE&&!1===this.expandReplies&&"permalink"!==this.source&&this.options.commentModel&&!this.options.commentModel.isResolved()?this.renderCollapsibleReplies():this.renderFullReplies(),this.trigger("ic:reply-rendered",this.options.commentModel),this._hightlightReply(),o.a.trigger("ic-jim-async-supported"),this)}catch(t){Object(g.b)().fail({name:b.a.VIEW_INLINE_COMMENT_REPLY,error:t})}},renderFullReplies(){0===this.collection.length&&Object(g.b)().succeed({name:b.a.VIEW_INLINE_COMMENT_REPLY}),this.collection.each((function(e){this.appendReply(e)}),this)},forceShowAllReplies(){this.expandReplies=!0,this.render()},renderCollapsibleReplies(){this.renderExpendButton();const e=this.collection.last();this.appendReply(e)},appendReply(e){const t=this.createReplyView(e);this.replyViews.push(t),this.$el.append(t.render().el)},renderExpendButton(){this.$el.append(Oe.showmoreReply({totalReplies:this.collection.length-1},this.formatMessage))},createReplyView(e){return new On({formatMessage:this.formatMessage,model:e,resolved:this.options.commentModel.isResolved(),shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled})},_hightlightReply(){if("permalink"!==this.source)return;const e=c.a.location.search.match(/(focusedCommentId|replyToComment)=(\d+)/);if(null==e)return;const t=parseInt(e[2],10);t&&0!==t&&this.$(`[data-comment-id=${t}]`).addClass("ic-comment-reply-highlight")},cleanUpReplyViews(){let e;for(e=0;e<this.replyViews.length;e++)this.replyViews[e].destroy(),this.replyViews[e]=null;this.replyViews=[]},destroy(){this.cleanUpReplyViews(),this.remove()}});let wn=!1;var Tn=m.a.View.extend({tagName:"div",events:{"click #ic-nav-previous":"showPrevious","click #ic-nav-next":"showNext"},template:Oe.navigation,initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.collection=this.model.collection,this.listenTo(this.collection,"change:resolveProperties",this.onResolveToggle),this.disabled=this.collection.getCommentsOnPageCount()<=1,this.listenTo(m.a,"ic:show-previous",this.showPrevious),this.listenTo(m.a,"ic:show-next",this.showNext),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty)},render(){return this.$el.html(this.template({disabled:this.disabled,showIndex:!(this.model.isResolved()||this.model.get("deleted")),index:this.collection.getActiveIndexWithinPageComments()+1,size:this.collection.getCommentsOnPageCount()},this.formatMessage)),this},onResolveToggle(){this.disabled=this.collection.getCommentsOnPageCount()<=1,this.render()},showPrevious(e){if(!this.disabled&&!wn&&A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){const t=this.collection.getPrevCommentOnPage();null!=t&&(m.a.trigger("ic:view",t,"nav"),e.clientX>0||e.clientY>0?this.sendAnalytics("clicked","previous"):this.sendAnalytics("pressed","previous")),e.view||(wn=!0,setTimeout(()=>{wn=!1},500))}},showNext(e){if(!this.disabled&&!wn&&A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){const t=this.collection.getNextCommentOnPage();null!=t&&(m.a.trigger("ic:view",t,"nav"),e.clientX>0||e.clientY>0?this.sendAnalytics("clicked","next"):this.sendAnalytics("pressed","next")),e.view||(wn=!0,setTimeout(()=>{wn=!1},500))}},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e},async sendAnalytics(e,t){const n=await A.getAnalyticsClient,{attributes:{containerId:i}}=this.model,a={source:"inlineCommentsSideBar",actionSubjectId:t,objectType:"comment",objectId:String(this.model.id),attributes:{pageId:i}};"pressed"===e?(a.action="pressed",a.attributes.key="previous"===t?"p":"n",a.actionSubject="keyboardShortcut"):(a.action="clicked",a.actionSubject="button"),n.sendUIEvent(a)}}),kn=m.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:Oe.displayComment,events:{"click .ic-action-reply":"replyComment","click .ic-action-resolve":"resolveComment","click .ic-action-edit":"editComment","click #show-resolved-comments":"showResolvedDialogDiscovery","click .ic-reply-placeholder .textarea":"replyComment","focus .ic-reply-container .textarea":"onReplyPlaceholderFocus"},initialize(e){this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,d.a.bindAll(this,"confirm","destroy","deleteFail","replyComment","resolveComment","editComment","renderCommentOnly"),this.model.set("active",!0),this.listenTo(this.model,"change:resolveProperties",this.render),this.listenTo(this.model,"remove",this.destroy),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),Object(i.default)("body").on("click",".ic-action-delete a",this.confirm),Object(i.default)("body").on("click",".ic-action-reply a",this.replyComment),Object(i.default)("body").on("click",".ic-action-resolve a",this.resolveComment),Object(i.default)("body").on("click",".ic-action-edit a",this.editComment),this.replyListView=new In({formatMessage:this.formatMessage,commentModel:this.model,source:e.source,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled})},render(){return Object(g.b)().start({name:b.a.VIEW_INLINE_COMMENT_TOP_LEVEL,attributes:{totalReplies:this.model.replies&&this.model.replies.length,mode:$.c.VIEW,framework:$.b.BACKBONE}}),A.getCurrentUserData().then(e=>{this.$el.html(this.template(d.a.extend(this.model.toJSON(),{showMenu:!0,currentAuthorAvatarUrl:e.authorAvatarUrl,currentAuthorDisplayName:e.authorDisplayName,currentAuthorAccountId:e.authorAccountId,darkFeatures:A.getDarkFeatures(),isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled}),this.formatMessage)),this.model.isResolved()?this.$(".ic-comment-container").addClass("ic-resolved"):this.$(".ic-list").append(this.replyListView.render().el),this._renderNavigation(),A.addSidebarHeadingTooltip(this),vn(this),this.isReactRootMounted=!0,"true"===this.options.isFrontendPeopleDirectoryEnabled&&Fe(this)}).catch(e=>{Object(g.c)(b.a.VIEW_INLINE_COMMENT_TOP_LEVEL,e)}),this},_renderNavigation(){this.navigationView&&this.navigationView.remove(),this.navigationView=new Tn({model:this.model,formatMessage:this.formatMessage}),this.navigationView.render(),this.$("#ic-nav-container").html(this.navigationView.el)},_renderLikes(){const e=this.el&&this.el.querySelector(".ic-action-like");this.options.shouldShowInlineCommentLikes?this.options.shouldShowInlineCommentLikes.then(t=>{t?(this.likesView&&this.likesView.remove(),this.likesView=new Ve({contentId:this.model.id,containerId:this.model.get("containerId"),containerType:this.model.get("containerType"),el:e,container:this.el,selector:".ic-action-like"}).render()):e&&e.remove()}):e&&e.remove()},editComment(e){if(e.preventDefault(),Object(L.b)({name:b.a.EDIT_INLINE_COMMENT,attributes:{editor:x.d.FABRIC,type:"topLevel",mode:$.c.VIEW,framework:$.b.BACKBONE}},{name:b.a.EDIT_INLINE_COMMENT_LOAD},{name:b.a.EDIT_INLINE_COMMENT_PUBLISH}),this.editView)this.editView.focusEditor();else if(A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)){A.getEditorFormat(this.model.get("id")).done(e=>{const t=this.el.querySelector(".ic-container");Te.a.unmountComponentAtNode(t)&&(this.isReactRootMounted=!1),this.editView=new yn({model:this.model,type:"edit",selection:{},onFinished:this.renderCommentOnly,commentText:e,formatMessage:this.formatMessage,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isUnifiedProfileCardsEnabled:this.options.isUnifiedProfileCardsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.$(".ic-display-comment").html(this.editView.$el),this.editView.render()}).fail((e,t,n)=>{A.failEditDisplay(this.formatMessage({id:"inline.comments.server.error.edit.comment"}),{errorThrown:n})})}},renderCommentOnly(){this.editView&&this.editView.destroy(),this.editView=null;const e=d.a.extend(this.model.toJSON(),{darkFeatures:A.getDarkFeatures()});if(this.isReactRootMounted){const e=this.el.querySelector(".ic-container");Te.a.unmountComponentAtNode(e)&&(this.isReactRootMounted=!1)}this.$(".ic-display-comment").html(Object(i.default)(Oe.comment(e,this.formatMessage)).children()),this.isReactRootMounted||(vn(this),this.isReactRootMounted=!0)},replyComment(e){e&&e.preventDefault(),Object(L.b)({name:b.a.REPLY_TO_INLINE_COMMENT,attributes:{editor:x.d.FABRIC,mode:$.c.VIEW,framework:$.b.BACKBONE}},{name:b.a.REPLY_TO_INLINE_COMMENT_LOAD},{name:b.a.REPLY_TO_INLINE_COMMENT_PUBLISH}),this.createReplyView?this.createReplyView.focusEditor():A.confirmProcess(this.formatMessage,!1,this.isFabricEditorDirty)?(this.createReplyView=new yn({formatMessage:this.formatMessage,model:this.model,type:"reply",isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,onFinished:d.a.bind((function(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null}),this),isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.$(".ic-reply-container").prepend(this.createReplyView.$el),this.createReplyView.render()):e&&e.currentTarget.blur()},confirm(e){if(e.preventDefault(),this.model.replies.length>0)return m.a.trigger("ic:error",this.formatMessage({id:"inline.comments.delete.with.reply"})),!1;const t=new Cn({formatMessage:this.formatMessage,model:new m.a.Model({label:this.formatMessage({id:"inline.comments.sidebar.delete"}),message:this.formatMessage({id:"inline.comments.delete.confirmation.message"})}),$menuEl:Object(i.default)(".ic-action-menu"),$bodyEl:Object(i.default)("body")});this.$(".ic-sidebar-heading").append(t.$el),this.listenTo(t,"ic:confirm",this.deleteComment)},deleteComment(){Object(g.b)().start({name:b.a.DELETE_INLINE_COMMENT,mode:$.c.VIEW,framework:$.b.BACKBONE}),this.model.destroy({wait:!0,success:()=>{this.$el.html(Oe.deleteComment(this.formatMessage)),this.model.set("deleted",!0),this._renderNavigation(),A.removeInlineLinksDialog(this.model.highlights),A.addSidebarHeadingTooltip(this),Object(g.b)().succeed({name:b.a.DELETE_INLINE_COMMENT}),m.a.trigger("ic:delete"),this.sendAnalytics("deleted",this.model)},error:this.deleteFail})},deleteFail(e,t){let n;n=401===t.status?this.formatMessage({id:"inline.comments.delete.permission"}):409===t.status?t.responseText:this.formatMessage({id:"inline.comments.server.error"}),Object(g.b)().fail({name:b.a.DELETE_INLINE_COMMENT,error:n}),m.a.trigger("ic:error",n)},destroy(e){Object(i.default)("body").off("click",".ic-action-delete a",this.confirm),Object(i.default)("body").off("click",".ic-action-reply a",this.replyComment),Object(i.default)("body").off("click",".ic-action-resolve a",this.resolveComment),Object(i.default)("body").off("click",".ic-action-edit a",this.editComment),this.createReplyView&&this.createReplyView.destroy(),this.editView&&this.editView.destroy(),this.replyListView.destroy(),this.navigationView&&this.navigationView.remove(),this.likesView&&this.likesView.remove(),!0!==e&&this.remove()},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e},resolveComment(e){e&&e.preventDefault(),A.confirmProcess(this.formatMessage,!0,this.isFabricEditorDirty)&&(Object(g.b)().start({name:b.a.RESOLVE_INLINE_COMMENT,attributes:{resolved:!0,mode:$.c.VIEW,framework:$.b.BACKBONE}}),this.model.resolve(!0,{wait:!0,success:d.a.bind(this.onResolveComplete,this),error:this.onResolveFail}))},onResolveComplete(){this.createReplyView&&this.createReplyView.destroy(),this.createReplyView=null,Object(g.b)().succeed({name:b.a.RESOLVE_INLINE_COMMENT}),m.a.trigger("ic:resolved"),A.removeInlineLinksDialog(this.model.highlights),this.sendAnalytics("resolved",this.model)},onResolveFail(e,t){let n;n=401===t.status?this.formatMessage({id:"inline.comments.resolve.permission"}):this.formatMessage({id:"inline.comments.server.error"}),Object(g.b)().fail({name:b.a.RESOLVE_INLINE_COMMENT,error:n}),m.a.trigger("ic:error",n)},showResolvedDialogDiscovery(){m.a.trigger("ic:resolved:show:recovery")},onReplyPlaceholderFocus(e){if(A.getDarkFeatures().RICH_TEXT_EDITOR){-1!==navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&e.currentTarget.blur()}},async sendAnalytics(e,t){const n=await A.getAnalyticsClient,{attributes:{id:i,containerId:a}}=t;n.sendTrackEvent({source:"viewPageScreen",action:e,actionSubject:"comment",actionSubjectId:String(i),objectType:"page",objectId:a,attributes:{pageType:o.a.Meta.get("draft-type"),commentType:"inline"}})}});var Nn=m.a.View.extend({tagName:"div",className:"ic-sidebar",events:{"click button.ic-action-hide":function(e){this.hide(e,!0)&&(this.sendUIEvent(),m.a.trigger("ic:sidebar:close"),Object(g.b)().abort({name:b.a.ADD_INLINE_COMMENT,reason:"close sidebar"}),Object(g.b)().abort({name:b.a.EDIT_INLINE_COMMENT,reason:"close sidebar"}),Object(g.b)().abort({name:b.a.REPLY_TO_INLINE_COMMENT,reason:"close sidebar"}))},"updateYPosition .ic-display-comment-view > .ic-comment-container":function(){this.setSidebarYPos()},"requestInlineCommentsClose .ic-display-comment-view > .ic-comment-container":function(e){const t=e.originalEvent.detail;let n;if(null!=this.commentView)n=this.commentView.model.highlight;else{if(null==this.createCommentView)return;n=Object(i.default)(".ic-current-selection")}if(t.parentElement.contains(n[0])){!1===this.hide(null,!0)?e.preventDefault():m.a.trigger("ic:sidebar:close")}}},initialize(e){e=e||{};const t=this;this.analyticsClient=A.getAnalyticsClient,this.shouldSqueeze=e.shouldSqueeze,this.formatMessage=e.formatMessage,this.isFabricEditorDirty=!1,this.isScrollToActiveHighlightCalled=!1,this.listenTo(m.a,"ic:view ic:overlap",this.displayComment),this.listenTo(m.a,"ic:create",this.displayCreateComment),this.listenTo(m.a,"ic:error",this.displayError),this.listenTo(m.a,"ic:hide-sidebar",this.hide),this.listenTo(m.a,"ic:clearError",this.clearError),this.listenTo(m.a,"ic:fabric-editor-dirty",this.setIsFabricEditorDirty),A.getDarkFeatures().RICH_TEXT_EDITOR?o.a.bind("rte-quick-edit-ready.ic-sidebar",()=>{const e=t.$el.find("#wysiwygTextarea_ifr");if(0!==e.length){new MutationObserver(()=>{e.resize()}).observe(e[0],{attributes:!0,attributeFilter:["style"]}),o.a&&o.a.Rte&&o.a.Rte.getEditor&&!o.a.Rte.getEditor().getContent()&&t._scrollToEditorView(e)}else{t.$el.is(":visible")||(t.$wikiContent.css("position","static"),E.destroy())}}):o.a.bind("init.rte.ic-sidebar",d.a.bind(this.hideInEditMode,this)),this.defaultNavOffset=130,this.defaultPermalinkedCommentOffset=100,this.$wikiContent=e.$wikiContent||Object(i.default)("[data-inline-comments-target=true]").first(),this.sidebarObserver=new MutationObserver(d.a.bind(this.setSidebarYPos,this)),this.sidebarObserver.observe(this.el,{childList:!0,subtree:!0}),Object(i.default)(c.a).on("resize.ic-sidebar",d.a.debounce(d.a.bind(this.setSidebarYPos,this),100)),o.a.bind("sidebar.expanded sidebar.collapsed.ic-sidebar",d.a.debounce(d.a.bind(this.setSidebarYPos,this),50));Object(i.default)("#confluence-ui .wrapper-space-view-page").length>0&&this.$el.addClass("ic-is-spa-view-page"),this.$el.addClass("ic-is-fabric-renderer-enabled")},destroy(){o.a.unbind(".ic-sidebar"),Object(i.default)(c.a).off(".ic-sidebar"),this.hide(),this.remove()},displayComment(e,t,n){let a;this.sendTrackEvent(e),e.highlights.each(t=>{const n=e.highlights[t],o=Object(i.default)(n).closest('div[mode="stick"]').length>0,r=Object(i.default)(n).closest(".pm-table-container .pm-table-wrapper").length>0;(o||r&&!a)&&(a=Object(i.default)(n))}),a&&a!==e.highlight&&(e.highlight=a);(function(){if(e.highlight.is(":hidden")&&(A.showHighlightContent(e.highlight),e.highlight.is(":hidden")))return;this.isFabricEditorDirty=!1,m.a.trigger("ic:fabric-editor-dirty",!1),this.distanceToTop=this.previousHighlightOffset||this.defaultNavOffset,this._emptySidebar(!0),this.commentView=new kn({formatMessage:this.formatMessage,model:e,source:t,shouldShowInlineCommentLikes:this.options.shouldShowInlineCommentLikes,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.show(!0);const a=this.$wikiContent.offset()||Object(i.default)("[data-inline-comments-target=true]").first().offset()||{top:0},o=e.highlight.offset().top-a.top;this.previousHighlightOffset=o;const r=this.commentView.render().$el;r.css("visibility","hidden"),"nav"===t?A.scrollToActiveHighlight(o,this.distanceToTop):"permalink"!==t||this.isScrollToActiveHighlightCalled?"quickreload"===t?this._scrollToQuickReloadComment(e):"programmaticClick"===t&&c.a.scrollTo(0,o):(this.isScrollToActiveHighlightCalled=!0,A.scrollToActiveHighlight(o,this.defaultPermalinkedCommentOffset).done(()=>{n&&n.isReplyComment&&this.commentView.replyComment()})),this.$el.html(r),c.a.Confluence.Binder&&c.a.Confluence.Binder.userHover()}).call(this),o.a.trigger("ic-jim-async-supported")},_scrollToQuickReloadComment(e){const t=Object(i.default)(".qr-feedback:first");let n=this.defaultPermalinkedCommentOffset;t.length>0&&(n=t.height()+67);const a=e.highlight.position().top;A.scrollToActiveHighlight(a,n)},_scrollToEditorView(e){const t=Object(i.default)("body, html"),n=this.$(".ic-display-comment-view").position().top,a=e.closest(".ic-create-comment-view").position().top+n;(t.height()<a||t.scrollTop()>a)&&t.animate({scrollTop:a},100)},displayCreateComment(e,t,n){const a=this.isOnUnsupportedMacro();this._emptySidebar(!0),this.createCommentView=new yn({formatMessage:this.formatMessage,collection:e,selection:t,type:a?"pageComment":"topLevel",isFocus:!1,stopFocus:!0,isGDPRInlineCommentsEnabled:this.options.isGDPRInlineCommentsEnabled,commentText:a?`<blockquote>${Object(i.default)("<div/>").text(t.text).html()}</blockquote> <div/>`:"",onFinished:d.a.bind((function(){this.createCommentView.keepSidebar||this.isShowing&&this.hide()}),this),serializedHighlights:n,isFrontendPeopleDirectoryEnabled:this.options.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:this.options.isMacroBrowserCheckEnabled}),this.show(),this.createCommentView.$el.css("visibility","hidden"),this.$el.html(this.createCommentView.$el),this.createCommentView.render()},isOnUnsupportedMacro(){const e=Object(i.default)(".ic-current-selection");return A.containUnsupportedMacro(e)||A.containInternalLink(e)||A.containUserMetion(e)},displayError(e,t){t=d.a.extend({closeable:!0},t),this.clearError(),o.a.messages.warning(".ic-error",{body:e,closeable:t.closeable}),t.callback&&t.callback()},clearError(){Object(i.default)(".ic-error").empty()},show(e){this.isShowing||(this._toggleSidebar(e),this.isShowing=!0)},hideInEditMode(e){"comment"!==o.a.Meta.get("content-type")&&(this.sidebarObserver.disconnect(),this.hide(e))},hide(e,t){return e&&e.preventDefault(),!!A.confirmProcess(this.formatMessage,!0,this.isFabricEditorDirty)&&(!this.isShowing||(this._toggleSidebar(t).done(()=>{E.destroy(),m.a.trigger("ic:sidebar-hidden"),m.a.trigger("ic:fabric-editor-dirty",!1),this.isShowing=!1}),!0))},async sendUIEvent(){const e=Object(i.default)(".view-page-body").attr("data-content-id");(await this.analyticsClient).sendUIEvent({source:"viewPageScreen",actionSubject:"button",actionSubjectId:"closeInlineCommentsSidebar",objectType:"page",objectId:String(e),action:"clicked"})},async sendTrackEvent(e){const{attributes:{id:t,containerId:n},collection:i,cid:a}=e,r=A.getUnresolvedComments(i),s=r.map(e=>e.cid).indexOf(a)+1;(await this.analyticsClient).sendTrackEvent({source:"viewPageScreen",actionSubject:"comment",actionSubjectId:String(t),objectType:"page",objectId:n,action:"viewed",attributes:{commentType:"inline",pageType:o.a.Meta.get("draft-type"),commentsDeckSize:r.length,position:s}})},_toggleSidebar(e){const t=Object(i.default)(".inline-comment-marker.active:first, .ic-current-selection:first");let n;t.length>0&&(n=A.getOffsetTopRelativeInWindowCoordinate(t));const a=i.default.Deferred();let o=a.promise();return this.isShowing?e&&A.isAnimationSupported()?o=A.animateSidebar(this,!1):(E.destroy(),this.$wikiContent.css("position","static"),this._emptySidebar(),a.resolve()):("true"===this.shouldSqueeze&&E.shrinkToShowSideBar(),e&&A.isAnimationSupported()?o=A.animateSidebar(this,!0):a.resolve(),this.$wikiContent.css("position","relative")),o.done(()=>{A.scrollToCommentAfterToggleSideBar(n,t)}),o},_emptySidebar(e){this.commentView&&(this.commentView.model.unset&&this.commentView.model.unset("active"),this.commentView.destroy(),this.commentView=null),this.createCommentView&&(this.createCommentView.keepSidebar=e,this.createCommentView.destroy(),this.createCommentView=null)},setSidebarYPos(){if(!this.isShowing)return;const e=this.$el.offset().top;let t,n;if(null!=this.commentView)t=this.commentView.$el,n=this.commentView.model.highlight;else{if(null==this.createCommentView)return;t=this.createCommentView.$el,n=Object(i.default)(".ic-current-selection")}if(!n)return;const a=this.$(".ic-sidebar-heading").height();t.css({visibility:"visible",position:"absolute",top:n.offset().top-e-a+"px"}),A.recalculateContentHeight(t)},setIsFabricEditorDirty(e){this.isFabricEditorDirty=e}}),_n=m.a.View.extend({tagName:"div",className:"ic-display-comment-view",template:Oe.comment,events:{"click .ic-action-unresolve":"unresolveComment","click .ic-action-show-reply":"showReply"},initialize(e){this.formatMessage=e.formatMessage,d.a.bindAll(this,"onUnresolveComplete","destroy"),this.replyListView=new In({formatMessage:this.formatMessage,commentModel:this.model}),this.listenTo(this.replyListView,"ic:reply-rendered",(function(){this.renderNumberOfReplies()}))},render(){const e=this.template(d.a.extend(this.model.toJSON(),{showMenu:!1,isDangling:this.model.isDangling(),darkFeatures:A.getDarkFeatures(),hasReply:this.model.replies.length>0}),this.formatMessage);return this.$el.html(e),this.likesView&&this.likesView.remove(),this.likesView=new Ve({contentId:this.model.id,showLikeButton:!1}).render(),this.$(".ic-action-like").html(this.likesView.el),this.$el.append(this.replyListView.$el.hide()),this.replyListView.render(),this},unresolveComment(){m.a.trigger("ic:resolvedClearError"),this.model.resolve(!1,{wait:!0,success:this.onUnresolveComplete,error:this.onUnresolveFail})},onUnresolveComplete(){m.a.trigger("ic:unresolved"),this.$el.slideUp(this.destroy)},onUnresolveFail(e,t){401===t.status?m.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.resolve.permission"})):m.a.trigger("ic:resolvedError",this.formatMessage({id:"inline.comments.server.error"}))},showReply(){this.$(".ic-action-show-reply").parent().remove(),this.$(".ic-replies").slideDown()},renderNumberOfReplies(){const e=this.model.replies.length,t=this.$(".ic-action-show-reply");if(e>0){let n;n=1===e?this.formatMessage({id:"inline.comments.resolved.menu.show.reply"},{0:e}):this.formatMessage({id:"inline.comments.resolved.menu.show.replies"},{0:e}),t.text(n),t.parent().removeClass("hidden")}else t.parent().remove()},destroy(){this.replyListView.destroy(),this.remove()}}),Mn=m.a.View.extend({events:{"click #resolved-dialog-close-button":"destroy"},template:Oe.resolvedCommentDialog,initialize(e){this.formatMessage=e.formatMessage,d.a.bindAll(this,"render","destroy","_onKeyDown"),this._resolvedCommentViews=[],this.listenTo(this.collection,"change:resolveProperties",this.onResolvedChanged),this.listenTo(m.a,"ic:resolvedError",this.displayError),this.listenTo(m.a,"ic:resolvedClearError",this.clearErrors);const t=Object(i.default)(this.template(null,this.formatMessage));this.setElement(t),this.dialog=o.a.dialog2(this.$el),Object(i.default)(c.a.document).bind("keydown",this._onKeyDown),o.a.trigger("remove-bindings.keyboardshortcuts")},render(){Object(h.getAnalyticsWebClient)().then(e=>{e.sendTrackEvent({action:"opened",actionSubject:"dialog",attributes:{componentVersion:"v1"},source:"ResolvedInlineCommentsDialog"}).fire()});const e=Object(i.default)("<div>"),t=this.collection.getResolvedCount();return 0!==t?d.a.each(this.collection.getResolvedCommentsDesc(),(function(t){const n=new _n({formatMessage:this.formatMessage,model:t});this._resolvedCommentViews.push(n),e.append(n.render().$el)}),this):this.displayNoCommentMessage(),this.$(".aui-dialog2-content").append(e),this.dialog.show(),this.options.focusCommentId&&this.scrollToComment(this.options.focusCommentId),m.a.trigger("ic:resolved:view",t),o.a.trigger("ic-jim-async-supported"),this},onResolvedChanged(){0===this.collection.getResolvedCount()&&this.displayNoCommentMessage()},displayNoCommentMessage(){o.a.messages.generic(this.$(".aui-dialog2-content"),{body:this.formatMessage({id:"inline.comments.resolved.dialog.empty"}),closeable:!1})},displayError(e){this.clearErrors(),o.a.messages.warning(this.$("#ic-resolved-comment-dialog-error"),{body:e})},clearErrors(){this.$("#ic-resolved-comment-dialog-error").empty()},scrollToComment(e){const t=this.$(o.a.format("[data-comment-id={0}]",e));if(t.length)return t.addClass("focused"),this.$(".aui-dialog2-content").animate({scrollTop:t.parent().position().top},100);return(new i.default.Deferred).reject()},_onKeyDown(e){this.$el&&this.$el.is(":visible")&&e.keyCode===o.a.keyCode.ESCAPE&&this.destroy()},destroy(){o.a.trigger("add-bindings.keyboardshortcuts"),Object(i.default)(c.a.document).unbind("keydown",this._onKeyDown),this.dialog.hide(),this.dialog.remove(),d.a.each(this._resolvedCommentViews,e=>{e.destroy()}),this._resolvedCommentViews=null,this.remove()}}),jn=m.a.Model.extend({}),Rn=m.a.Collection.extend({model:jn,url:o.a.contextPath()+"/rest/experimental/webfragment/panels?location=atl.page.content.footer.actions"});let Sn,An=null;var Dn={init(e,t){Sn=t,An=e.commentCollection;const n=new Promise(t=>{A.getDarkFeatures().LIKES_ADMIN_TOGGLE?(e.webPanelCollection||(e.webPanelCollection=new Rn),e.webPanelCollection.fetch({cache:!1}).done(e=>{t(e.length>0)})):t(!0)});e.views.sidebar&&e.views.sidebar.destroy(),e.views.sidebar=new Nn({formatMessage:Sn,$wikiContent:Object(i.default)("[data-inline-comments-target=true]").first(),shouldShowInlineCommentLikes:n,shouldSqueeze:e.shouldSqueeze,isGDPRInlineCommentsEnabled:e.isGDPRInlineCommentsEnabled,isFrontendPeopleDirectoryEnabled:e.isFrontendPeopleDirectoryEnabled,isMacroBrowserCheckEnabled:e.isMacroBrowserCheckEnabled}),E.$el.append(e.views.sidebar.$el),e.views.highlight&&e.views.highlight.destroy(),e.views.highlight=new Ie({formatMessage:Sn,collection:An}),e.views.highlight.render()},loadSidebarOnClick(e,t){if(A.confirmProcess(Sn,!1,t)){m.a.trigger("ic:highlight-panel-click"),Object(i.default)(".inline-comment-marker,span[data-mark-type=confluenceInlineComment],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment]").removeClass("active");const t=A.overlappedSelection(e,An);if(t){const e=Object(i.default)(`.inline-comment-marker[data-ref="${t.get("markerRef")}"],span[data-mark-type=confluenceInlineComment][data-reference="${t.get("markerRef")}"],span[data-mark-type=annotation][data-mark-annotation-type=inlineComment][data-id="${t.get("markerRef")}"]`);c.a.Confluence.HighlightAction.clearTextSelection(),t.highlight=e,m.a.trigger("ic:overlap",t)}else{const t=(new pe).removeHighlight().highlight(e.range);m.a.trigger("ic:create",An,e,t)}}},updateResolvedCommentCountInToolsMenu(){Object(i.default)("#view-resolved-comments>span").text(Sn({id:"inline.comments.resolved.view.menu"})+o.a.format(" ({0})",An.getResolvedCount()))},afterSyncCommentCollection(){const e=this;An.once("sync",t=>{e.displayPermalinkedComment(t)}),An.on("change:resolveProperties",()=>{e.updateResolvedCommentCountInToolsMenu()}),this.updateResolvedCommentCountInToolsMenu()},displayPermalinkedComment(e){const t=c.a.location.search;A.showFocusedComment(e,t,Mn)},createResolvedCommentListView(){new Mn({formatMessage:Sn,collection:An}).render()}};let Pn,xn;const Ln=function(e){return Dn.init(e,xn),Dn};function $n(){return Fn.firstCaller&&(Fn.firstCaller=!1,Pn&&Pn.isResolved()?Ln(Fn):(Pn=i.default.Deferred(),Pn.resolve(Ln(Fn)))),Fn.isSidebarLoaded=!1,Pn.promise()}const Fn={firstCaller:!0,isSidebarLoaded:!1,commentCollection:null,webPanelCollection:null,shouldSqueeze:!1,views:{sidebar:null},init(e){e=e||{},Fn.firstCaller=!0,Fn.isSidebarLoaded=!1,Fn.shouldSqueeze=e.shouldSqueeze,Fn.isUnifiedProfileCardsEnabled=e.isUnifiedProfileCardsEnabled,Fn.isGDPRInlineCommentsEnabled=e.isGDPRInlineCommentsEnabled,Fn.isFrontendPeopleDirectoryEnabled=e.isFrontendPeopleDirectoryEnabled,Fn.isMacroBrowserCheckEnabled=e.isMacroBrowserCheckEnabled,Fn.isFabricEditorDirty=!1,Fn.commentCollection||(Fn.commentCollection=new B),Fn.commentCollection.reset(),E.setPageContentElByCSSSelector(e.pageContentCSSSelector),E.setPageHeaderElByCSSSelector(e.pageHeaderCSSSelector),Fn.bindDOMEvents(),Fn.fetch(),Fn.bindQuickReloadEvents(),Fn.bindAppEvents(),Fn.focusOnComment(),Fn.updateResolvedCount(),o.a.bind("ic.force-refetch",Fn.fetch)},initAsync(){$n().done(e=>{e.afterSyncCommentCollection(),e.displayPermalinkedComment(Fn.commentCollection)})},destroy(){o.a.unbind(".ic-app"),E.destroy()},bindDOMEvents(){Object(i.default)("body").off("click.ic-app","#view-resolved-comments").on("click.ic-app","#view-resolved-comments",e=>{e.preventDefault(),$n().done(e=>{e.createResolvedCommentListView()})})},bindAppEvents(){m.a.listenTo(m.a,"ic:resolved..ic-app",()=>{Fn.initAsync()}),m.a.listenTo(m.a,"ic:fabric-editor-dirty",e=>{Fn.isFabricEditorDirty=e})},fetch:()=>Fn.commentCollection.fetch({cache:!1}).done(()=>{Fn.commentCollection.getCommentsOnPageCount()>0&&Fn.initAsync(),Fn.commentCollection.getResolvedCount()>0&&$n().done(e=>{e.updateResolvedCommentCountInToolsMenu()}),o.a.trigger("ic-fetch-completed",Fn.commentCollection)}),focusOnComment(){-1!==c.a.location.search.indexOf("focusedCommentId")&&Fn.initAsync()},bindQuickReloadEvents(){o.a.unbind("qr:show-new-thread.ic-app").bind("qr:show-new-thread.ic-app",(e,t)=>{$n().done(()=>{!function(e,t){let n=Fn.commentCollection.get(t),i=!1;void 0===n&&(n=new V({id:t}),i=!0),n.fetch({success(e){e._setHighlights(e.get("markerRef")),i?Fn.commentCollection.add(e):n.replies.isFetched=!1,m.a.trigger("ic:view",n,"quickreload")}})}(0,t)})}),o.a.unbind("qr:add-new-highlight.ic-app").bind("qr:add-new-highlight",(e,t,n)=>{$n().done(()=>{o.a.trigger("qr:add-new-highlight-text",[t,n])})})},updateResolvedCount(){Object(i.default)("#view-resolved-comments>span").text(xn({id:"inline.comments.resolved.view.menu"})+o.a.format(" ({0})",Fn.commentCollection.getResolvedCount()))}};function Hn(){c.a.removeEventListener("create-inline-comment",Vn),Object(i.default)(".tipsy").remove()}function Vn(e){Bn(e.detail)}function Bn(e){Object(L.b)({name:b.a.ADD_INLINE_COMMENT,id:P()(),attributes:{editor:x.d.FABRIC,mode:$.c.VIEW,framework:$.b.BACKBONE}},{name:b.a.ADD_INLINE_COMMENT_LOAD},{name:b.a.ADD_INLINE_COMMENT_PUBLISH}),$n().done(t=>{Fn.isSidebarLoaded||(Fn.isSidebarLoaded=!0,t.loadSidebarOnClick(e,Fn.isFabricEditorDirty))})}var Un={init:function(e){xn=e.formatMessage,z.start(),Hn(),Fn.init(e),c.a.addEventListener("create-inline-comment",Vn),c.a.Confluence&&c.a.Confluence.HighlightAction&&c.a.Confluence.HighlightAction.registerButtonHandler("com.atlassian.confluence.plugins.confluence-inline-comments:create-inline-comment",{onClick:Bn,shouldDisplay:c.a.Confluence.HighlightAction.WORKING_AREA.MAINCONTENT_ONLY})},destroy:function(){Hn(),Fn.destroy()},notifyEditor:function(){m.a.trigger("ic:tinymce-resource-loaded")}};const zn=Object(r.d)("skate");if(!A.isSPAPage()){const e=o.a.Meta.get("page-id"),t=o.a.Meta.get("latest-page-id");e&&e===t&&Object(i.default)(Un.init)}const Gn=(e,t)=>{const n=e.getAttribute("data-page-content-css-selector"),i=e.getAttribute("data-page-header-css-selector"),a=e.getAttribute("data-content-id"),o=e.getAttribute("data-should-squeeze"),r=e.getAttribute("data-gdpr-inline-comments"),s=e.getAttribute("data-frontend-people-directory"),c=e.getAttribute("data-inline-comments-macro-browser");Un.init({formatMessage:t,pageContentCSSSelector:n,pageHeaderCSSSelector:i,contentId:a,shouldSqueeze:o,isGDPRInlineCommentsEnabled:r,isFrontendPeopleDirectoryEnabled:s,isMacroBrowserCheckEnabled:c})};t.default=(e,t=!1)=>{var n;if(n=A.getPageContentClassName(),__skate&&__skate.registry&&void 0!==__skate.registry[n]){if(t){const t=document.getElementsByClassName(A.getPageContentClassName())[0];t&&(Un.destroy(),Gn(t,e))}}else zn(A.getPageContentClassName(),{type:zn.types.CLASS,attributes:{"data-content-id":{updated(e){this._init(e)}},"data-editor-resource-loaded":{updated(){Un.notifyEditor()}}},attached(e){this._init(e)},detached(){Un.destroy()},_init(t){Gn(t,e)}})}},jYB6:function(e){e.exports=JSON.parse('{"a":"@atlaskit/tooltip","b":"17.0.0"}')},jqY8:function(e,t,n){"use strict";function i(){return"undefined"!=typeof window?window.location:void 0}function a(){if("undefined"==typeof window||!window.location)return;let e=window.location.origin;return e||(e=`${window.location.protocol}//${window.location.hostname}${window.location.port?":"+window.location.port:""}`),e}function o(){"undefined"!=typeof window&&window.location.reload()}function r(e){return"undefined"==typeof window||window.confirm(e)}function s(...e){"undefined"!=typeof window&&window.addEventListener.apply(window,e)}function c(...e){"undefined"!=typeof window&&window.removeEventListener.apply(window,e)}function l(){return"undefined"==typeof window?0:window.pageYOffset}function d(){return"undefined"==typeof window?0:window.innerHeight}function u(...e){if(window&&window.require)return window.require.apply(window,e)}function m(){return window}n.d(t,"f",(function(){return i})),n.d(t,"g",(function(){return a})),n.d(t,"i",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"j",(function(){return c})),n.d(t,"h",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"d",(function(){return u})),n.d(t,"c",(function(){return m}))},liuE:function(e,t,n){"use strict";var i=n("ERkP"),a=n.n(i),o=n("Czhu"),r=n("3IV/"),s=n("8pvK");const c={default:{light:r.N40,dark:r.N40},inprogress:{light:r.B50,dark:r.B50},moved:{light:r.Y75,dark:r.Y75},new:{light:r.P50,dark:r.P50},removed:{light:r.R50,dark:r.R50},success:{light:r.G50,dark:r.G50}},l={default:{light:r.N500,dark:r.N500},inprogress:{light:r.B500,dark:r.B500},moved:{light:r.N800,dark:r.N800},new:{light:r.P500,dark:r.P500},removed:{light:r.R500,dark:r.R500},success:{light:r.G500,dark:r.G500}},d={default:{light:r.N500,dark:r.N500},inprogress:{light:r.B400,dark:r.B400},moved:{light:r.Y500,dark:r.Y500},new:{light:r.P400,dark:r.P400},removed:{light:r.R400,dark:r.R400},success:{light:r.G400,dark:r.G400}},u={default:{light:r.N0,dark:r.N0},inprogress:{light:r.N0,dark:r.N0},moved:{light:r.N800,dark:r.N800},new:{light:r.N0,dark:r.N0},removed:{light:r.N0,dark:r.N0},success:{light:r.N0,dark:r.N0}},m=Object(s.a)(({appearance:e,isBold:t,maxWidth:n})=>Object(o.a)(Object(o.a)({},"object"==typeof e?Object(o.a)({backgroundColor:(t?d:c).default.light,textColor:(t?u:l).default.light},e):{backgroundColor:(t?d[e]:c[e]).light,textColor:(t?u[e]:l[e]).light}),{},{maxWidth:n}));var h=n("l1C2"),p=n("BMbf");const f=Object(p.c)()+"px";var g=({backgroundColor:e,textColor:t,children:n,testId:i})=>Object(h.f)("span",{css:{backgroundColor:e,borderRadius:f,boxSizing:"border-box",color:t,display:"inline-block",fontSize:"11px",fontWeight:700,lineHeight:1,maxWidth:"100%",padding:"2px 0 3px 0",textTransform:"uppercase",verticalAlign:"baseline"},"data-testid":i},n);const b=Object(p.h)()/2+"px";var E=({maxWidth:e,children:t})=>Object(h.f)("span",{css:{display:"inline-block",verticalAlign:"top",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",boxSizing:"border-box",padding:"0 "+b,maxWidth:"number"==typeof e?e+"px":e,width:"100%"}},t);n.d(t,"a",(function(){return v}));class v extends i.PureComponent{render(){const{theme:e,children:t,testId:n}=this.props;return a.a.createElement(m.Provider,{value:e},a.a.createElement(m.Consumer,Object.assign({},this.props),e=>a.a.createElement(g,Object.assign({testId:n},e),a.a.createElement(E,Object.assign({},e),t))))}}v.defaultProps={isBold:!1,appearance:"default",maxWidth:200}},ltac:function(e,t,n){"use strict";function i(e){let t=e.offsetTop;for(;e.offsetParent;)t+=(e=e.offsetParent).offsetTop;return t}function a(e,t){if(!e)return!1;t=t||document.scrollingElement||document.body.parentNode;const n=e.offsetHeight,a=i(e),o=i(t)+t.scrollTop,r=t.offsetHeight;return a>=o&&a+n<=o+r}function o(e){if(!e||e===document)return null;const t=window.getComputedStyle(e);return e.scrollHeight>e.clientHeight&&"hidden"!==e.style.overflow&&"visible"!==t.overflow?e:o(e.parentNode)}function r(e,t){t=t||o(e),e&&t&&!a(e,t)&&(t.scrollTop=i(e)-i(t)-t.clientHeight/2)}function s(e){return e.getBoundingClientRect()}function c(e,t){const n=t?t.documentElement:window.document.documentElement;if(!e||!n)return;const i=e.getBoundingClientRect(),{top:a,bottom:o}=i,r=n.offsetHeight;return 0<=a&&a<r||0<=o&&o<=r||a<=0&&0<=o&&o>=r}function l(e,t){const n=t?t.documentElement:window.document.documentElement;if(!e||!n)return;const i=e.getBoundingClientRect(),{top:a}=i,o=n.offsetHeight;return 0<=a&&a<o}n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"g",(function(){return r})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l}))},mAAb:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));const i={EDIT:"edit",VIEW:"view"},a={REACT:"react",BACKBONE:"backbone"},o={INVALID_SELECTION:"Invalid text selection. Cannot create inline comments on macros (mentions, images, emojis, etc.)",FAILED_TO_INSERT_MARK:"Failed to insert highlight, invalid originalSelection, numMatches, or matchIndex",INVALID_ARGUMENT_CREATED_FROM:"Invalid createdFrom, please specify if created from editor or renderer",INVALID_ARGUMENT_MATCHES:"Invalid arguments provided for matchIndex and/or numMatches",STALE_SELECTION:"Selection was made against a stale version of the content",COMMENT_NOT_FOUND:"Content with id %d for comment container is not found. Please provide correct container id.",PARENT_NOT_FOUND:"Parent comment with id %d is not found. Please provide correct parent comment id.",INCOMPATIBLE_PARENT_TYPE:"Incompatible parent type. Please provide comment id.",DELETE_ERROR:"Exception occurred while deleting comment with id",NO_DELETE_PERMS:"Parent page view is restricted",NO_UPDATE_PERMS:"Could not update Content of type : class com.atlassian.confluence.pages.Comment with id %d"}},mGwS:function(e,t,n){"use strict";var i=n("xbks");t.a=i.a},o0lc:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n("ERkP"),a=n.n(i),o=n("lZoD"),r=n("WWAs"),s=n("03Pf");const c=({children:e})=>{const t=Object(i.useRef)(0),n=Object(i.useCallback)(e=>{Object(s.b)(e,-t.current)},[t]);return a.a.createElement(o.c,{to:[r.a]},i=>(t.current=i.getTotalHeight(),e({scrollToElement:n})))};c.displayName="DocumentScroller"},pWz0:function(e,t,n){"use strict";var i=n("rhcL"),a=n("GBQy"),o=n("mAAb"),r=n("L21V");const s=Object(r.g)({invalidHighlight:{id:"inline-comments.error.invalid.highlight",defaultMessage:"Youve highlighted text that appears elsewhere on this page. Try highlighting more text to make your selection different from other instances on the page.",description:"A message informing the use their highight is invalid due to the content being duplicated elsewhere on the page and how to remedy it"},staleContent:{id:"inline-comments.error.stale.content",defaultMessage:"Refresh the page to see the latest updates, and try adding your comment again.",description:"A message informing the user that the content is old and needs to be refreshed"},viewNotPermitted:{id:"inline-comments.error.view.not.permitted",defaultMessage:"Your permission settings dont allow you to view the comment. Check with your administrator if you need this ability.",description:"A message informing the user they don't have permissions to view comments"},createNotPermitted:{id:"inline-comments.error.create.not.permitted",defaultMessage:"Your permission settings dont allow you to create comments. Check with your administrator if you need this ability.",description:"A message informing the user they don't have permissions to create comments"},deleteNotPermitted:{id:"inline-comments.error.delete.not.permitted",defaultMessage:"Your permission settings dont allow you to view the comment. Check with your administrator if you need this ability.",description:"A message informing the user they don't have permissions to delete comments"},resolveNotPermitted:{id:"inline-comments.error.resolve.not.permitted",defaultMessage:"Your permission settings dont allow you to resolve the comment. Check with your administrator if you need this ability.",description:"A message informing the user they don't have permissions to resolve comments"},editNotPermitted:{id:"inline-comments.error.edit.not.permitted",defaultMessage:"Your permission settings dont allow you to edit the comment. Check with your administrator if you need this ability.",description:"A message informing the user they don't have permissions to edit comments"},unableToMarkDOM:{id:"inline-comments.error.unable.to.mark.dom",defaultMessage:"Your comment has been successfully created. Refresh the page to see it.",description:"A message to tell the user their comment is created, but the mark could not be added to the DOM"},unexpectedError:{id:"inline-comments.error.unexpected",defaultMessage:"Something went wrong when saving this comment. Close the comment or refresh the page, and try adding your comment again.",description:"A message explaining an unexpected error occurred"}});n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return l})),n.d(t,"a",(function(){return d})),n.d(t,"k",(function(){return u})),n.d(t,"j",(function(){return m})),n.d(t,"i",(function(){return h})),n.d(t,"h",(function(){return p})),n.d(t,"e",(function(){return f})),n.d(t,"g",(function(){return b})),n.d(t,"m",(function(){return v})),n.d(t,"f",(function(){return y})),n.d(t,"n",(function(){return O})),n.d(t,"l",(function(){return I})),n.d(t,"d",(function(){return w}));const c="inline-create-comment-selection",l="inline-highlight",d="active-highlight",u=e=>{const{message:t}=e;let n,i;if(-1!==t.indexOf("GraphQL error:")){const o=t.lastIndexOf(":")+1;i=t.substr(o,t.length-o).trim(),n=Object(a.b)(e)}else i=t;return{errorId:n,message:i}},m=(e,t="")=>{let n;switch(e){case o.a.INVALID_SELECTION:case o.a.FAILED_TO_INSERT_MARK:n=s.invalidHighlight;break;case o.a.STALE_SELECTION:n=s.staleContent;break;case o.a.NO_UPDATE_PERMS.replace("%d",t):n=s.editNotPermitted;break;case o.a.NO_DELETE_PERMS:n=s.deleteNotPermitted;break;case o.a.INVALID_ARGUMENT_CREATED_FROM:case o.a.INVALID_ARGUMENT_MATCHES:case o.a.COMMENT_NOT_FOUND.replace("%d",t):case o.a.PARENT_NOT_FOUND.replace("%d",t):case o.a.INCOMPATIBLE_PARENT_TYPE:case o.a.DELETE_ERROR:default:n=s.unexpectedError}return n},h=(e,t)=>{const n=Array.from(document.querySelectorAll(p(t))).map(e=>e.getAttribute(Object(i.d)(t)));return[...new Set(n)].filter(t=>e.includes(t))},p=e=>e?'[data-mark-annotation-type="inlineComment"]':".inline-comment-marker",f=()=>{document.querySelectorAll("."+d).forEach(e=>{e.classList.remove(d)})},g=e=>{let t=e,n=t.nextSibling;for(;!n;)n=t.parentElement.nextSibling,n||(t=t.parentElement);for(;n&&n.nodeType!==Node.TEXT_NODE;)n=n.firstChild;return n},b=()=>{const e=window.getSelection();if(!e||"None"===e.type)return;(e=>{const t=[],{startContainer:n,startOffset:i,endContainer:a,endOffset:o}=e;if(n.isSameNode(a))t.push(e);else{const e=new Range;e.setStart(n,i),e.setEnd(n,n.length),t.push(e);let r=g(n);for(;r&&!r.isSameNode(a);){if(r.length){const e=new Range;e.selectNodeContents(r),t.push(e)}r=g(r)}const s=new Range;s.setStart(a,0),s.setEnd(a,o),t.push(s)}return t})(e.getRangeAt(0)).forEach(e=>{const t=document.createElement("span");t.classList.add(c),t.appendChild(e.extractContents()),e.insertNode(t)}),e.removeAllRanges()},E=e=>{for(;e.length;){const t=e.shift();if(!t)return;const{parentNode:n}=t;for(;t.firstChild;)null==n||n.insertBefore(t.firstChild,t);null==n||n.removeChild(t),null==n||n.normalize()}},v=()=>{const e=Array.from(document.querySelectorAll("."+c));E(e)},y=(e,t)=>{const n=document.querySelectorAll("."+c);n.length&&n.forEach(n=>{e?(n.setAttribute(i.a,t),n.setAttribute("data-mark-annotation-type","inlineComment")):(n.setAttribute(i.b,t),n.classList.add("inline-comment-marker")),n.classList.add(l,d),n.classList.remove(c)})},C=e=>{e.classList.contains(l)&&e.classList.add(d);const{children:t}=e;for(let n=0;n<t.length;++n)C(t[n])},O=(e,t)=>{(document.querySelectorAll(`[${Object(i.d)(t)}="${e}"]`)||[]).forEach(e=>C(e))},I=(e,t)=>{const n=Array.from(document.querySelectorAll(`[${Object(i.d)(t)}="${e}"]`));E(n),f()},w=e=>{if(e){const t=e.getBoundingClientRect(),n=document.querySelector(".fabric-editor-popup-scroll-parent");let i=0;return n&&(i=n.scrollTop-n.offsetTop),t.top+i+e.offsetHeight+4}return 300}},pwfR:function(e,t,n){"use strict";var i=n("ERkP"),a=n.n(i),o=n("bhMQ");n.d(t,"b",(function(){return d}));const r={appear:!0,isExiting:!1},s=Object(i.createContext)(r),c=(e,t=r)=>a.a.createElement(s.Provider,{key:e.key+"-provider",value:t},e),l=e=>e.reduce((e,t)=>(e[t.key]=t,e),{}),d=()=>Object(i.useContext)(s);t.a=({appear:e=!1,children:t,exitThenEnter:n})=>{const a=(e=>{const t=[];return i.Children.toArray(e).forEach(e=>{"boolean"!=typeof e&&t.push(e)}),t})(t),r=l(a),s=Object(i.useRef)([]),d=Object(i.useRef)([]),u=(()=>{const[,e]=Object(i.useState)({});return Object(i.useCallback)(()=>e({}),[])})(),m=Object(i.useRef)({}),h=Object(i.useRef)(e),p=Object(i.useMemo)(()=>({appear:h.current,isExiting:!1}),[h.current]);return Object(o.a)()?a:(h.current||(h.current=!0),s.current.length&&((e,t)=>{for(let n=0;n<t.length;n++){if(!e[t[n].key])return!0}return!1})(r,s.current)?((0===d.current.length||((e,t)=>{let n=!1;return t.forEach(t=>{e.current[t.key]&&(n=!0,delete e.current[t.key])}),n})(m,a))&&(d.current=s.current),s.current=a,(n?d.current:((e,t)=>{const n=t.concat([]),i=l(t);for(let a=0;a<e.length;a++){const t=e[a];!i[t.key]&&n.splice(a+1,0,t)}return n})(a,d.current)).map(e=>{const t=r[e.key];return t?c(t,p):(m.current[e.key]=!0,c(e,{isExiting:!0,appear:!0,onFinish:()=>{delete m.current[e.key],0===Object.keys(m.current).length&&(s.current=[],d.current=[],u())}}))})):(s.current=a,a.map(e=>c(e,p))))}},uvkf:function(e,t,n){"use strict";var i=n("ERkP"),a=n("l1C2"),o=n("BMbf");const r=Object(a.e)("z-index:",o.i.tooltip(),";pointer-events:none;"),s=Object(i.forwardRef)((function({style:e,className:t,children:n,placement:i,testId:o},s){return Object(a.f)("div",{role:"tooltip",ref:s,style:e,className:t,css:r,"data-placement":i,"data-testid":o},n)}));s.displayName="TooltipPrimitive",t.a=s},v1Ui:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("H5qd"),a=n.n(i),o=n("wHM1");const r=a.a`query InlineCommentsQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ROOT){nodes{...inlineCommentFragment replies{...inlineCommentFragment}}}}${o.a}`},vdGo:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("ERkP"),a=n("hpu0"),o=n("9LlU");function r({name:e,error:t}){const n=Object(i.useContext)(o.a);return Object(i.useEffect)(()=>Object(a.b)().fail({name:e||n,error:t}),[e,t]),null}},vzxV:function(e,t,n){"use strict";n.r(t);var i=n("ERkP"),a=n.n(i),o=n("1U1M"),r=n("IC1n"),s=n.n(r),c=n("lZoD"),l=n("6z9Z"),d=n("3VMZ"),u=n("J7sl"),m=n("dIe6"),h=n("FdGg"),p=n("X2PC"),f=n("QqfF"),g=n("zCQI"),b=n("Ua4J");const E=()=>{const{getQueryParams:e}=Object(i.useContext)(b.a),{focusedCommentId:t,editComment:n,commentId:a,replyToComment:o}=e();return{focusedCommentId:t||void 0,editCommentId:n&&"true"===n&&a?a:void 0,replyToCommentId:o||void 0}};var v=n("rhcL"),y=n("nLwH"),C=n("2DyF"),O=n("a0gl"),I=n("+CY+"),w=n("bWlm"),T=n("1N1n"),k=n("TaKn"),N=n("mAAb"),_=n("v1Ui"),M=n("pWz0");const j=(e,t)=>t&&e?"inlineComment"===t.getAttribute("data-mark-annotation-type"):t.classList.contains("inline-comment-marker"),R=Object(i.memo)(({markerRefs:e,onHighlightClick:t,isFabricPage:n,dialogs:a})=>{const o=Object(i.useRef)(null),{hasContentChanged:r,resetContentChanged:s}=Object(i.useContext)(f.a);Object(i.useEffect)(()=>{o.current=document.querySelector("#content")},[]);const c=Object(i.useCallback)(e=>{let{target:i}=e,o=!1;for(;i&&j(n,i)&&(o=i.classList.contains(M.c),!o);)i=i.parentElement;if(!i||!o)return;e.preventDefault();const c=e=>{if(s(),e.classList.contains(M.a))Object(M.e)(),t("");else{Object(M.e)();const i=e.getAttribute(Object(v.d)(n));e.classList.add(M.a),Object(M.n)(i,n),t(i)}};r?a.showDialog(y.a,{onConfirm:()=>c(i)}):c(i)},[a,t,n,r,s]);return Object(i.useEffect)(()=>{const t=e.reduce((e,t)=>(e[t]=!0,e),{});document.querySelectorAll(Object(M.h)(n)).forEach(e=>{const i=e.getAttribute(Object(v.d)(n));if(i){t[i]?e.classList.add(M.c):e.classList.remove(M.c)}})},[e,n]),Object(i.useEffect)(()=>{var e;if(o.current)return null===(e=o.current)||void 0===e||e.addEventListener("click",c),()=>{var e;null===(e=o.current)||void 0===e||e.removeEventListener("click",c)}},[o,c]),null});var S=n("Iy7w"),A=n("7nmT"),D=n("0dje"),P=n.n(D),x=n("3IV/");const L=Object(S.a)("div",{target:"efsks5y0"})("position:absolute;top:-50px;left:-50px;width:200px;background:white;border-radius:4px;box-shadow:0 1px 2px rgba(0,0,0,0.2);box-sizing:content-box;padding:8px 12px;span:first-of-type{text-decoration:none;color:",x.N200,";padding-right:5px;line-height:inherit;svg{padding-bottom:2px;}}"),$=Object(i.memo)(()=>{const e=Object(i.useRef)(null),t=Object(i.useRef)(null),n=Object(i.useRef)(null),[o,r]=Object(i.useState)(null);Object(i.useEffect)(()=>{e.current=document.querySelector("#content")},[]);const s=Object(i.useCallback)(e=>{const{target:i}=e;i.removeEventListener("mouseleave",s),n.current=setTimeout(()=>{t.current=null,r(null)},2e3)},[n,t]),c=Object(i.useCallback)(e=>{const{target:i}=e;let a=!1;for(let t=0;t<i.children.length;++t)if(i.children[t].classList.contains(M.c)){a=!0;break}if(a){const e=(e=>e.length>19?e.substr(0,20)+"...":e)(i.getAttribute("href"));if(e===o)return;n.current&&clearTimeout(n.current),i.setAttribute("style","position: relative"),t.current=i,i.addEventListener("mouseleave",s),r(e)}},[n,t,o,s]);return Object(i.useEffect)(()=>{var t;if(e.current)return null===(t=e.current)||void 0===t||t.querySelectorAll("a[href]").forEach(e=>e.addEventListener("mouseenter",c)),()=>{var t;null===(t=e.current)||void 0===t||t.querySelectorAll("a[href]").forEach(e=>e.removeEventListener("mouseenter",c))}},[e,c]),o&&t.current?Object(A.createPortal)(a.a.createElement(L,null,a.a.createElement(P.a,{size:"medium",label:"inline-comment-hyperlink-icon",primaryColor:x.N200}),o),t.current):null});var F=n("L21V"),H=n("gHio"),V=n.n(H),B=n("a8dO"),U=n("MV18"),z=n("Czhu"),G=n("XFpn"),q=n.n(G),W=n("WEdt"),Y=n("K3K7"),K=n("xlny"),Q=n("wpph");const J=Object(F.g)({resolvedCommentDescription:{id:"inline-comments.resolved-comment-description",description:"Message to be displayed when user Resolves a comment",defaultMessage:"You can view all the comments from the More actions menu."},resolvedCommentTitle:{id:"inline-comments.resolved-comment-title",description:"Title to be displayed when user Resolves a comment",defaultMessage:"Comment Resolved"},resolvedCommentLabel:{id:"inline-comments.resolved-comment-label",description:"Label to be displayed when user Resolves a comment",defaultMessage:"Comment Resolved"}}),X=({commentId:e,reopenComment:t})=>{const[n]=Object(o.c)(Y.a),[r,s]=Object(i.useState)(null),c=Object(i.useCallback)(i=>{i.preventDefault();const a={variables:{commentId:e,resolved:!1}};n(Object(z.a)({},a)).then(()=>{t()}).catch(e=>{s(e)})},[e,t,n]);return a.a.createElement(i.Fragment,null,a.a.createElement(Q.h,null,a.a.createElement(F.c,Object(z.a)({},J.resolvedCommentLabel),e=>a.a.createElement(q.a,{size:"xlarge",primaryColor:x.G400,label:e})),a.a.createElement(Q.i,{mixin:Object(W.h400)()},a.a.createElement(F.c,Object(z.a)({},J.resolvedCommentTitle))),a.a.createElement(F.c,Object(z.a)(Object(z.a)({},J.resolvedCommentDescription),{},{tagName:"p"})),a.a.createElement("a",{onClick:c},a.a.createElement(F.c,{id:"inline-comments.undo-resolved-comment",defaultMessage:"Undo resolved comment",description:"Undo Resolved comment"}))),r&&a.a.createElement(K.a,{error:r,action:"reopen"}))};var Z=n("HMAF"),ee=n.n(Z),te=n("PLaw"),ne=n.n(te);const ie=Object(F.g)({nextCommentLabel:{id:"inline-comments.next-comment-label",description:"Label displayed for the Next comment",defaultMessage:"Next Comment"},previousCommentLabel:{id:"inline-comments.previous-comment-label",description:"Label displayed for the Previous comment",defaultMessage:"Previous Comment"},nextCommentToolTip:{id:"inline-comments.next-comment-tooltip",description:"ToolTip displayed for the Next comment",defaultMessage:"Next comment (N)"},previousCommentToolTip:{id:"inline-comments.previous-comment-tooltip",description:"ToolTip displayed for the Previous comment",defaultMessage:"Previous comment (P)"}}),ae=Object(S.a)("span",{target:"e1qtveb40"})({name:"4g6ai3",styles:"cursor:pointer;"}),oe=({currentCommentIndex:e,commentsCount:t,navigateToComment:n,comment:i})=>a.a.createElement(Q.d,null,a.a.createElement(B.a,{content:a.a.createElement(F.c,Object(z.a)({},ie.previousCommentToolTip)),hideTooltipOnClick:!0,position:"top"},a.a.createElement(ae,{onClick:()=>{n("previous",i)},"data-cy":"inline-nav-previous"},a.a.createElement(F.c,Object(z.a)({},ie.previousCommentLabel),e=>a.a.createElement(ee.a,{label:e,primaryColor:x.N90,size:"medium"})))),a.a.createElement(B.a,{content:a.a.createElement(F.c,Object(z.a)({},ie.nextCommentToolTip)),hideTooltipOnClick:!0,position:"top"},a.a.createElement(ae,{onClick:()=>{n("next",i)},"data-cy":"inline-nav-next"},a.a.createElement(F.c,Object(z.a)({},ie.nextCommentLabel),e=>a.a.createElement(ne.a,{label:e,primaryColor:x.N90,size:"medium"})))),a.a.createElement("span",null,`${e+1} of ${t}`));var re=n("VZRV");const se=Object(S.a)("div",{target:"e16v7mfs0"})("padding:5px 18px 5px 16px;border-bottom:1px solid ",x.N40,";font-size:12px;"),ce=({resolvedUser:e,resolvedTime:t})=>e&&t?a.a.createElement(se,null,a.a.createElement(F.c,{id:"inline-comments.reopened.message",defaultMessage:"Reopened by {person}",description:"A message telling the user the comment was reopened and who did it",values:{person:e}})," ",a.a.createElement(re.b,{date:t})):null,le=Object(S.a)("div",{target:"e6x96340"})("border-bottom:1px solid ",x.N40,";text-align:center;height:29px;"),de=Object(S.a)("div",{target:"e6x96341"})("height:9px;border-bottom:1px solid ",x.N40,";"),ue=Object(S.a)("div",{target:"e6x96342"})("position:relative;> span{top:-16px;cursor:pointer;padding:0 5px;background-color:",x.N0,";position:relative;}"),me=({numCollapsedReplies:e,onClick:t})=>a.a.createElement(le,null,a.a.createElement(de,null),a.a.createElement(de,null),a.a.createElement(ue,{"data-testid":"collapsed-inline-replies",onClick:t},a.a.createElement(F.c,{id:"inline-comments.collapsed.replies.more",defaultMessage:"{numCollapsedReplies} more replies",description:"text telling the user how many replies are collapsed",values:{numCollapsedReplies:e}})));var he=n("daKX"),pe=n("MntV"),fe=n("H5qd"),ge=n.n(fe);const be=ge.a`mutation DeleteInlineCommentMutation($commentIdToDelete:ID!){deleteComment(commentIdToDelete:$commentIdToDelete)}`;var Ee=n("RjSO"),ve=n("8Kf2"),ye=n("g92I"),Ce=n("uSyi"),Oe=n("wHM1");const Ie=ge.a`mutation CreateInlineCommentMutation($input:CreateInlineCommentInput!){createInlineComment(input:$input){...inlineCommentFragment replies{...inlineCommentFragment}}}${Oe.a}`;var we=n("ir9L");const Te=({pageId:e,pageType:t,spaceId:n,isFabricPage:r,isReply:s,userId:c,parentId:u,onNewCommentSuccess:m,shouldShowReplyEditor:h,lastFetchTime:p})=>{const[b,E]=Object(i.useState)(!1),[v]=Object(o.c)(Ie),[y]=Object(o.c)(we.a),{onChange:C,resetContentChanged:O}=Object(i.useContext)(f.a),{newCommentHighlight:I}=Object(i.useContext)(g.a),{createAnalyticsEvent:w}=Object(Ee.a)(),T=Object(i.useContext)(l.a);Object(i.useEffect)(()=>{s&&!h&&E(!0)},[u,s,h]);const k=t=>{const{errorId:n,message:i}=Object(M.k)(t);return i!==N.a.FAILED_TO_INSERT_MARK&&i!==N.a.INVALID_SELECTION||((t,n)=>{const i={errorMessage:n,editor:"FABRIC",framework:N.b.REACT,errorId:t},a=new Range,o=document.querySelector(".ic-current-selection");if(o){a.selectNode(o);const t=document.getSelection();if(t){t.removeAllRanges(),t.addRange(a);const n=Object(ye.c)(document.querySelector("#content"),t.getRangeAt(0),e);i.matchTrace=JSON.stringify(n)}}w({type:"sendOperationalEvent",data:{source:"viewPage",objectType:"page",objectId:e,action:"invalid",actionSubject:"highlight",actionSubjectId:"inlineComment",attributes:i}}).fire()})(n,i),T.stopOnError({error:t,name:s?d.a.REPLY_TO_INLINE_COMMENT_PUBLISH:d.a.ADD_INLINE_COMMENT_PUBLISH}),Promise.reject({error:Object(M.j)(i)})},j=t=>{if(s)return{containerId:e,parentCommentId:u,commentBody:{value:JSON.stringify(t),representationFormat:"ATLAS_DOC_FORMAT"}};if(!p||!I)throw new Error("Invalid variable input for 'create' comment");const{numMatches:n,matchIndex:i,selectedText:a}=I;return{containerId:e,commentBody:{value:JSON.stringify(t),representationFormat:"ATLAS_DOC_FORMAT"},numMatches:n,matchIndex:i,originalSelection:a.replace(/\n/g,""),createdFrom:"RENDERER",lastFetchTimeMillis:p}},R=({id:i})=>{w({type:"sendTrackEvent",data:{containerType:"space",containerId:n,source:"viewPageScreen",objectType:"page",objectId:e,action:"created",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:t,parentCommentId:u,framework:"REACT"}}}).fire()};return a.a.createElement(Q.a,{isReply:s,"data-testid":"inline-comment-create-container"},a.a.createElement(Ce.a,{size:s?"small":"medium",mode:s?"reply":"create",userId:c}),a.a.createElement(ve.a,{pageId:e,spaceId:n,appearance:"chromeless",commentMode:s?"reply":"create",showCancelButton:s,onSaveComment:(t,n)=>{let i,a;T.start({name:s?d.a.REPLY_TO_INLINE_COMMENT_PUBLISH:d.a.ADD_INLINE_COMMENT_PUBLISH});try{i=s?y:v,a={variables:{input:j(t)},update:(t,{data:n})=>{var i;const a=t.readQuery({query:_.a,variables:{pageId:e}}),o=(null!=(i=a)&&null!=(i=i.comments)?i.nodes:i)||[];if(s){const e=o.find(e=>e.id===u);e&&e.replies.push(n.replyInlineComment)}else o.push(n.createInlineComment);t.writeQuery({query:_.a,variables:{pageId:e},data:a})}}}catch(o){return k(o)}return i(Object(z.a)({},a)).then(({data:e})=>(n(),(e=>{if(s){const{replyInlineComment:t}=e;R(t),m&&m(),T.succeed({name:d.a.REPLY_TO_INLINE_COMMENT_PUBLISH})}else{const{createInlineComment:t}=e,n=t.location.inlineMarkerRef;if(!n)return k(new Error("Can't make the mark on the DOM permanent"));Object(M.f)(r,n),R(t),T.succeed({name:d.a.ADD_INLINE_COMMENT_PUBLISH}),m&&m(n)}})(e))).catch(e=>k(e))},onCancelComment:()=>{O()},useNewWarningModal:!0,onEditorReady:()=>{s||O(),T.succeed({name:s?d.a.REPLY_TO_INLINE_COMMENT_LOAD:d.a.ADD_INLINE_COMMENT_LOAD})},isViewMode:!0,onContentChange:()=>{C()},shouldResetEditor:b,onEditorReset:()=>{E(!1)},expandEditor:h,shouldWarnOnInternalNavigation:!0}))};var ke=n("DL3M"),Ne=n.n(ke);const _e=ge.a`mutation UpdateInlineCommentMutation($input:UpdateCommentInput!){updateComment(input:$input){id}}`,Me=({pageId:e,pageType:t,spaceId:n,resetComment:r,userId:s,avatarUrl:c,commentId:u,content:m,displayName:h,parentId:p,version:g,isReply:b,isFabricPage:E})=>{const y=Object(i.useRef)(null),{onChange:C}=Object(i.useContext)(f.a),[O]=Object(o.c)(_e),{createAnalyticsEvent:I}=Object(Ee.a)(),w=Object(i.useContext)(l.a);Object(i.useEffect)(()=>{y&&y.current&&Object(v.g)(y.current,E)},[y,E]);const T=Object(i.useCallback)(()=>{r()},[r]),k=m&&m.length?JSON.parse(m):null;return a.a.createElement(i.Fragment,null,a.a.createElement(Q.a,{ref:y,"data-testid":"inline-comment-edit-container"},a.a.createElement(Ce.a,{mode:"edit",userId:s,displayName:h,avatarUrl:c}),a.a.createElement(ve.a,{pageId:e,spaceId:n,appearance:"chromeless",commentMode:"edit",content:k,onSaveComment:(i,a)=>{w.start({name:d.a.EDIT_INLINE_COMMENT_PUBLISH});const o={variables:{input:{commentId:u,version:g+1,commentBody:{value:JSON.stringify(i),representationFormat:"ATLAS_DOC_FORMAT"}}},update:t=>{var n;const a=t.readQuery({query:_.a,variables:{pageId:e}}),o=(null!=(n=a)&&null!=(n=n.comments)?n.nodes:n)||[];let r;if(b){const e=o.find(e=>e.id===p);r=null==e?void 0:e.replies.find(e=>e.id===u)}else r=o.find(e=>e.id===u);r&&(Ne()(r,"body.value",JSON.stringify(i)),Ne()(r,"version.number",g+1),t.writeQuery({query:_.a,variables:{pageId:e},data:a}))}};return O(Object(z.a)({},o)).then(({data:i})=>{a();const{updateComment:o}=i;(({id:i})=>{I({type:"sendTrackEvent",data:{containerType:"space",containerId:n,source:"viewPageScreen",objectType:"page",objectId:e,action:"updated",actionSubject:"comment",actionSubjectId:i,attributes:{commentType:"inline",pageType:t,parentCommentId:p,framework:"REACT"}}}).fire()})(o),r(),w.succeed({name:d.a.EDIT_INLINE_COMMENT_PUBLISH})}).catch(e=>(e=>{const{message:t}=Object(M.k)(e);return w.stopOnError({error:e,name:d.a.EDIT_INLINE_COMMENT_PUBLISH}),Promise.reject({error:Object(M.j)(t)})})(e))},onCancelComment:T,showCancelButton:!0,useNewWarningModal:!0,onContentChange:()=>{C()},onEditorReady:()=>{w.succeed({name:d.a.EDIT_INLINE_COMMENT_LOAD})},isViewMode:!0,shouldWarnOnInternalNavigation:!0})))},je=Object(he.a)("inline-comment"),Re=({pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:r,shouldOpenCommentEditor:s,shouldShowReplyEditor:c,userId:u,onDeleteSuccess:m,comment:h,parentId:p,isReply:g,isFabricPage:b,onNewCommentSuccess:v,onResolve:y,lastFetchTime:C})=>{const[O,I]=Object(i.useState)(h?"view":"create"),[w,T]=Object(i.useState)(null),[k,N]=Object(i.useState)(!1),{resetContentChanged:j}=Object(i.useContext)(f.a),R=Object(i.useContext)(l.a);Object(i.useEffect)(()=>{!g&&h&&R.succeed({name:d.a.VIEW_INLINE_COMMENT})},[g,h,R]);const{focusedCommentId:S,editCommentId:A}=E(),[D]=Object(o.c)(be),[P]=Object(o.c)(Y.a),x=(t,n)=>i=>{try{var a;const n=(null!=(a=i.readQuery({query:_.a,variables:{pageId:e}}))&&null!=(a=a.comments)?a.nodes:a)||[],o=n.findIndex(e=>e.id===t);if(-1!==o){const t=[...n];t.splice(o,1),i.writeQuery({query:_.a,variables:{pageId:e},data:{comments:{nodes:t,__typename:"PaginatedCommentList"}}})}}catch(o){je.error`An Error occured when updating cache to ${n} comment - ${o}`}};Object(i.useEffect)(()=>{h&&I("view")},[h]),Object(i.useEffect)(()=>{if(s&&h){const{id:e,permissions:{isEditable:t}}=h;A===e&&t&&I("edit")}},[s,A,h]);const L=()=>{I("edit")},$=()=>{j(),I("view")};if(h){const{id:o,body:{value:s},author:{accountId:c,profilePicture:{path:l},displayName:u},links:{webui:p},parentId:f,permissions:E,version:{number:v,when:C}}=h,{replies:I,location:{inlineMarkerRef:_}}=h,j=g&&S===o;return"view"===O?a.a.createElement(i.Fragment,null,a.a.createElement(pe.a,{pageId:e,pageType:t,avatarUrl:l,commentId:o,content:s,date:C,displayName:u,permissions:E,dateUrl:p,userId:c,deleteComment:()=>((e,t)=>{N(!0);const n={variables:{commentIdToDelete:e},update:x(e,"delete")};D(n).then(({data:{deleteComment:e}})=>{if(!e){const e=new Error("Delete failed");throw R.stopOnError({name:d.a.DELETE_INLINE_COMMENT,error:e}),e}g||Object(M.l)(t,b),m&&m(),R.succeed({name:d.a.DELETE_INLINE_COMMENT})}).catch(e=>{N(!1),T({error:e,action:"delete"}),R.stopOnError({name:d.a.DELETE_INLINE_COMMENT,error:e})})})(o,_),editComment:L,isReply:g,hasReplies:I&&I.length>0,isRemoving:k,resolveComment:()=>(e=>{const t={variables:{commentId:e,resolved:!0}};P(Object(z.a)(Object(z.a)({},t),{},{update:x(e,"resolve")})).then(()=>{y&&y(e),R.succeed({name:d.a.RESOLVE_INLINE_COMMENT})}).catch(e=>{R.stopOnError({name:d.a.RESOLVE_INLINE_COMMENT,error:e}),T({error:e,action:"resolve"})})})(o),isFocused:j,shouldScrollIntoView:r,isFabricPage:b,isViewMode:!0}),w&&a.a.createElement(K.a,{error:w.error,action:w.action})):a.a.createElement(Me,{pageId:e,pageType:t,spaceId:n,resetComment:$,avatarUrl:l,commentId:o,content:s,displayName:u,version:v,userId:c,parentId:f,isReply:g,isFabricPage:b})}return a.a.createElement(Te,{pageId:e,pageType:t,spaceId:n,isReply:g,isFabricPage:b,userId:u,parentId:p,onNewCommentSuccess:v,shouldShowReplyEditor:c,lastFetchTime:C})},Se=Object(S.a)("div",{target:"e1628rut0"})("position:relative;display:flex;padding:0 12px 0;justify-content:",({shouldShowNavigation:e})=>e?"space-between":"flex-end",";",({shouldShowNavigation:e})=>e&&"height: 25px; padding-top: 10px");Se.displayName="SidebarHeader";const Ae=({pageId:e,pageType:t,spaceId:n,onClose:o,onDeleteSuccess:r,onNewCommentSuccess:s,canReplyToComment:c,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,shouldShowReplyEditor:m,userId:h,comment:p,newCommentHighlight:g,isFabricPage:b,refetchComments:E,navigateToComment:C,currentCommentIndex:O,commentsCount:w,dialogs:T,lastFetchTime:k})=>{var N,_;const[j,R]=Object(i.useState)(300),[S,A]=Object(i.useState)(!1),[D,P]=Object(i.useState)(!l&&!u),[L,$]=Object(i.useState)(""),{hasContentChanged:H}=Object(i.useContext)(f.a);Object(i.useEffect)(()=>{if(!p&&L)return void A(!0);if(!p&&!g)return void A(!1);let e=0;if(p){const{inlineMarkerRef:t}=p.location,n=document.querySelector(`[${Object(v.d)(b)}="${t}"]`);e=Object(v.c)(n,b)}else if(g){Object(M.m)(),Object(M.g)();const t=document.querySelector("."+M.b);e=Object(v.c)(t,b)}if(b){const t=document.querySelector("#content .ak-renderer-wrapper");t&&(e+=t.offsetTop)}else{const t=document.querySelector("#content-body .page-metadata-modification-info");t&&(e-=t.offsetTop-t.offsetHeight)}$(""),P(!l&&!u),R(e),A(!0)},[p,g,b,l,u,L]);const z=Object(i.useCallback)(()=>{const e=()=>{P(!0),$(""),o&&o()};H?T.showDialog(y.a,{onConfirm:e}):e()},[o,H,T]),G=Object(i.useCallback)(()=>{if(!p)return null;const o=p.replies.length>0,d=D&&p.replies.length>4,f=d?p.replies.slice(-1):p.replies;return a.a.createElement(i.Fragment,null,o&&a.a.createElement(Q.f,{"data-testid":"inline-comment-reply-container"},d&&a.a.createElement(me,{numCollapsedReplies:p.replies.length-1,onClick:()=>P(!1)}),f.map(i=>a.a.createElement(Re,{key:i.id,pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,userId:h,comment:i,parentId:p.id,onDeleteSuccess:r,isReply:!0}))),c&&a.a.createElement(Q.e,{"data-testid":"inline-comment-new-reply-container"},a.a.createElement(Re,{pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,shouldShowReplyEditor:m,userId:h,parentId:p.id,isReply:!0,onNewCommentSuccess:s,onDeleteSuccess:r})))},[p,c,e,t,n,l,u,m,h,D,s,r]),q=(null!=(_=p)&&null!=(_=_.location)&&null!=(_=_.inlineResolveProperties)?_.resolvedUser:_)||void 0,W=(null!=(N=p)&&null!=(N=N.location)&&null!=(N=N.inlineResolveProperties)?N.resolvedTime:N)||void 0;return S?a.a.createElement(Q.j,{id:"inline-comment-sidebar",offset:j,isViewMode:!0},a.a.createElement(Se,{shouldShowNavigation:Boolean(p),"data-testid":"inline-comment-sidebar-header"},p&&a.a.createElement(oe,{navigateToComment:C,currentCommentIndex:O,commentsCount:w,comment:p}),a.a.createElement(B.a,{content:a.a.createElement(F.c,{id:"inline-comments.close.icon.tooltip",defaultMessage:"Close sidebar (])",description:"A tooltip message informing the user what the icon does on hover and its hotkey"}),hideTooltipOnClick:!0,position:"top"},a.a.createElement(Q.b,{"data-testid":"close-sidebar-icon",onClick:z},a.a.createElement(V.a,{label:"close-icon",primaryColor:x.N90,size:"small"})))),L?a.a.createElement(X,{commentId:L,reopenComment:()=>{$(""),E()}}):a.a.createElement(i.Fragment,null,a.a.createElement(Re,{pageId:e,pageType:t,spaceId:n,shouldShowFocusedComment:l,shouldOpenCommentEditor:u,userId:h,comment:p,isFabricPage:b,onNewCommentSuccess:s,onResolve:e=>{$(e)},onDeleteSuccess:r,lastFetchTime:k}),a.a.createElement(ce,{resolvedUser:q,resolvedTime:W}),G(),a.a.createElement(U.a,{name:d.a.VIEW_PAGE_DISCOVER_INLINE_COMMENTS_FEATURE,attributes:{pageHasInlineComments:!0}})),a.a.createElement(I.a,{accelerator:["]"],listener:z})):null};n.d(t,"InlineComments",(function(){return De}));const De=({pageId:e,isFabricPage:t})=>{var n,r,b;const[j,S]=Object(i.useState)(""),[A,D]=Object(i.useState)({}),[P,x]=Object(i.useState)([]),[L,F]=Object(i.useState)({}),[H,V]=Object(i.useState)(!1),[B,U]=Object(i.useState)(!1),[z,G]=Object(i.useState)(!1),[q,W]=Object(i.useState)(null),[Y,K]=Object(i.useState)(0),{userId:Q}=Object(O.a)(),{hasContentChanged:J,resetContentChanged:X}=Object(i.useContext)(f.a),Z=Object(i.useContext)(l.a),{newCommentHighlight:ee,clearCreateHighlight:te}=Object(i.useContext)(g.a),{focusedCommentId:ne,editCommentId:ie,replyToCommentId:ae}=E(),{data:oe,loading:re,error:se,refetch:ce}=Object(o.d)(_.a,{variables:{pageId:e},fetchPolicy:"cache-and-network"});Object(w.a)({name:"commentsInline",types:[T.e.content,T.e.comment],reload:ce,priority:T.d.background});const{data:le,loading:de,error:ue}=Object(o.d)(k.a,{variables:{pageId:e}}),me=()=>{S(""),Object(M.e)(),Object(M.m)(),te(),X(),fe([d.a.ADD_INLINE_COMMENT,d.a.EDIT_INLINE_COMMENT,d.a.REPLY_TO_INLINE_COMMENT],"sidebar closed")},he=t=>{t&&(S(t),te()),X(),ce({pageId:e})},pe=Object(i.useCallback)(e=>{const n=L[e];return!!n&&(Object(M.n)(n,t),S(n),!0)},[L,t]),fe=Object(i.useCallback)((e,t)=>{e.forEach(e=>Z.abort({name:e,reason:t}))},[Z]);Object(i.useEffect)(()=>{K(Date.now())},[]),Object(i.useEffect)(()=>{var e;if(!oe)return;const n=(null!=(e=oe)&&null!=(e=e.comments)?e.nodes:e)||[],i=n.reduce((e,t)=>{const{inlineMarkerRef:n}=t.location;return n?(e[n]=t,e):e},{}),a=n.reduce((e,t)=>{const{id:n}=t,{inlineMarkerRef:i}=t.location;return i?(e[n]=i,t.replies.forEach(({id:t})=>{e[t]=i}),e):e},{});D(i);const o=Object(M.i)(Object.keys(i),t);x(o),F(a)},[oe,t]),Object(i.useEffect)(()=>{ee&&(V(!1),U(!1),G(!1),S(""),Object(M.e)(),fe([d.a.EDIT_INLINE_COMMENT,d.a.REPLY_TO_INLINE_COMMENT],"new comment highlighted"),Object(u.b)({name:d.a.ADD_INLINE_COMMENT,id:s()(),attributes:{mode:N.c.VIEW,framework:N.b.REACT}},{name:d.a.ADD_INLINE_COMMENT_LOAD},{name:d.a.ADD_INLINE_COMMENT_PUBLISH}))},[ee,Z,fe]),Object(i.useEffect)(()=>{ne&&q!==ne&&pe(ne)&&(W(ne),V(!0))},[q,ne,pe]),Object(i.useEffect)(()=>{ie&&q!==ie&&pe(ie)&&(W(ie),U(!0))},[q,ie,pe]),Object(i.useEffect)(()=>{ae&&q!==ae&&pe(ae)&&(W(ae),G(!0))},[q,ae,pe]),Object(i.useEffect)(()=>{j.length&&Object(v.g)(document.querySelector(`[${Object(v.d)(t)}="${j}"]`),t)},[j,t]);const ge=e=>P.findIndex(t=>t===e),be=Object(i.useCallback)(e=>{if(e.length){var t;const n=((null!=(t=A[e])?t.replies:t)||[]).length;Z.start({name:d.a.VIEW_INLINE_COMMENT,attributes:{totalReplies:n,mode:N.c.VIEW,framework:N.b.REACT}})}},[Z,A]),Ee=(e,n,i)=>{const a=(e,n)=>{X(),Object(M.e)();const i=((e,t)=>{let n;return"next"===e?n=t===P.length-1?0:t+1:"previous"===e&&(n=0===t?P.length-1:t-1),P[n]})(e,ge(n));be(i),S(i),Object(M.n)(i,t)},{inlineMarkerRef:o}=n.location;J?i.showDialog(y.a,{onConfirm:()=>a(e,o)}):a(e,o)},ve=Object(i.useCallback)(e=>{be(e),G(!1),V(!1),U(!1),S(e),Object(M.m)(),te(),X(),fe([d.a.ADD_INLINE_COMMENT,d.a.EDIT_INLINE_COMMENT,d.a.REPLY_TO_INLINE_COMMENT],e.length?"new comment selected":"active comment closed")},[te,be,fe,X]);if(!oe&&re||de)return null;if(se)return a.a.createElement(m.a,{error:se});if(ue)return a.a.createElement(m.a,{error:ue});const ye=null!=(b=le)&&null!=(b=b.content)&&null!=(b=b.nodes)&&null!=(b=b[0])&&null!=(b=b.space)?b.id:b,Ce=null!=(r=le)&&null!=(r=r.content)&&null!=(r=r.nodes)&&null!=(r=r[0])?r.type:r,Oe=(null!=(n=le)&&null!=(n=n.content)&&null!=(n=n.nodes)&&null!=(n=n[0])?n.operations:n)||[],Ie=Boolean(Oe.find(e=>"create"===e.operation&&"comment"===e.targetType));return a.a.createElement(h.a,{attribution:p.a.COLLABORATION},a.a.createElement(c.c,{to:[C.a]},n=>a.a.createElement(i.Fragment,null,a.a.createElement(R,{markerRefs:P,onHighlightClick:ve,isFabricPage:t,dialogs:n}),a.a.createElement($,null),a.a.createElement(Ae,{pageId:e,pageType:Ce,spaceId:ye,onClose:me,onDeleteSuccess:ce,onNewCommentSuccess:he,canReplyToComment:Ie,userId:Q,comment:A[j],newCommentHighlight:ee,shouldShowFocusedComment:H,shouldOpenCommentEditor:B,shouldShowReplyEditor:z,isFabricPage:t,navigateToComment:(e,t)=>Ee(e,t,n),currentCommentIndex:ge(j),commentsCount:P.length,refetchComments:ce,dialogs:n,lastFetchTime:Y}),j&&a.a.createElement(I.a,{accelerator:["n","p"],listener:e=>((e,t)=>{e&&("n"===e.key?Ee("next",A[j],t):"p"===e.key&&Ee("previous",A[j],t))})(e,n)}))))}},wS3D:function(e,t){!function(e,t,n,i){const a=1,o=3,r="textHighlighter";function s(t,n){this.context=t,this.$context=e(t),this.options=e.extend({},e[r].defaults,n),this.init()}s.prototype={init(){this.$context.addClass(this.options.contextClass),this.bindEvents()},destroy(){this.unbindEvents(),this.$context.removeClass(this.options.contextClass),this.$context.removeData(r)},bindEvents(){},unbindEvents(){},highlightHandler(e){e.data.self.doHighlight()},doHighlight(t){const n=t||this.getCurrentRange();if(!n||n.collapsed)return;const i=n.toString();let a="";if(1==this.options.onBeforeHighlight(n)){const t=e.textHighlighter.createWrapper(this.options),o=this.highlightRange(n,t);a=this.normalizeHighlights(o),this.options.onAfterHighlight(a,i)}return this.removeAllRanges(),a},getCurrentRange(){const e=this.getCurrentSelection();let t;return e.rangeCount>0&&(t=e.getRangeAt(0)),t},removeAllRanges(){this.getCurrentSelection().removeAllRanges()},getCurrentSelection(){const t=this.getCurrentWindow();let n;return t.getSelection?n=t.getSelection():e("iframe").length?e("iframe",top.document).each((function(){if(this.contentWindow===t)return n=rangy.getIframeSelection(this),!1})):n=rangy.getSelection(),n},getCurrentWindow(){const e=this.getCurrentDocument();return e.defaultView?e.defaultView:e.parentWindow},getCurrentDocument(){return this.context.ownerDocument?this.context.ownerDocument:this.context},highlightRange(t,n){if(t.collapsed)return;const i=["SCRIPT","STYLE","SELECT","BUTTON","OBJECT","APPLET"];let a=t.startContainer,r=t.endContainer;const s=t.commonAncestorContainer;let c=!0;if(0==t.endOffset){for(;!r.previousSibling&&r.parentNode!=s;)r=r.parentNode;r=r.previousSibling}else r.nodeType==o?t.endOffset<r.nodeValue.length&&r.splitText(t.endOffset):t.endOffset>0&&(r=r.childNodes.item(t.endOffset-1));a.nodeType==o?t.startOffset==a.nodeValue.length?c=!1:t.startOffset>0&&(a=a.splitText(t.startOffset),r==a.previousSibling&&(r=a)):a=t.startOffset<a.childNodes.length?a.childNodes.item(t.startOffset):a.nextSibling;let l=!1,d=a;const u=[];do{if(c&&d.nodeType==o){if(/\S/.test(d.nodeValue)){const t=n.clone(!0).get(0),i=d.parentNode;if(e.contains(this.context,i)||i===this.context){const n=e(d).wrap(t).parent().get(0);u.push(n)}}c=!1}d!=r||r.hasChildNodes()&&c||(l=!0),-1!=e.inArray(d.tagName,i)&&(c=!1),c&&d.hasChildNodes()?d=d.firstChild:null!=d.nextSibling?(d=d.nextSibling,c=!0):(d=d.parentNode,c=!1)}while(!l);return u},normalizeHighlights(t){this.flattenNestedHighlights(t),this.mergeSiblingHighlights(t);return e.map(t,e=>void 0!==e.parentElement?null!=e.parentElement?e:null:null!=e.parentNode?e:null)},flattenNestedHighlights(t){const i=this;e.each(t,(function(a){const o=e(this),r=o.parent(),s=r.prev(),c=r.next();if(i.isHighlight(r))if(r.css("background-color")!=o.css("background-color"))i.isHighlight(s)&&!o.get(0).previousSibling&&s.css("background-color")!=r.css("background-color")&&s.css("background-color")==o.css("background-color")&&o.insertAfter(s),i.isHighlight(c)&&!o.get(0).nextSibling&&c.css("background-color")!=r.css("background-color")&&c.css("background-color")==o.css("background-color")&&o.insertBefore(c),r.is(":empty")&&r.remove();else{const i=n.createTextNode(r.text());r.empty(),r.append(i),e(t[a]).remove()}}))},mergeSiblingHighlights(t){const n=this;function i(t,i){return!(!i||i.nodeType!=a||e(t).css("background-color")!=e(i).css("background-color")||!e(i).hasClass(n.options.highlightedClass))}e.each(t,(function(){const t=this,n=t.previousSibling,a=t.nextSibling;if(i(t,n)){var o=e(n).text()+e(t).text();e(t).text(o),e(n).remove()}if(i(t,a)){o=e(t).text()+e(a).text();e(t).text(o),e(a).remove()}}))},setColor(e){this.options.color=e},getColor(){return this.options.color},removeHighlights(t){const n=void 0!==t?t:this.context,i=this;this.getAllHighlights(n,!0).each((function(){if(1==i.options.onRemoveHighlight(this)){e(this).contents().unwrap().get(0)}}))},getAllHighlights(t,n){const i="."+this.options.highlightedClass;let a=e(t).find(i);return 1==n&&e(t).hasClass(this.options.highlightedClass)&&(a=a.add(t)),a},isHighlight(e){return e.hasClass(this.options.highlightedClass)},serializeHighlights(t){const n=t||this.getAllHighlights(this.context),i=this.context,a=[];return n.each((t,n)=>{let r=0;const s=n.firstChild.length,c=function(t,n){const i=[];do{const n=e.inArray(t,t.parentNode.childNodes);i.unshift(n),t=t.parentNode}while(t!==n);return i}(n,i);e(n).clone().empty().get(0).outerHTML;n.previousSibling&&n.previousSibling.nodeType===o&&(r=n.previousSibling.length),a.push([e(n).text(),c.join(":"),r,s])}),JSON.stringify(a)},deserializeHighlights(t,n){try{var i=JSON.parse(t)}catch(c){throw new Error("Can't parse serialized highlights: "+c)}const a=[],r=this;let s=!0;return e.each(i,(t,i)=>{try{!function(t){const i=t[0],s=t[1].split(":"),c=t[2],l=t[3];let d=s.pop(),u=null,m=r.context;for(;void 0!==(u=s.shift());)m=m.childNodes[u];m.childNodes[d-1]&&m.childNodes[d-1].nodeType===o&&(d-=1);const h=m.childNodes[d].splitText(c);if(h.splitText(l),h.nextSibling&&""==h.nextSibling.nodeValue&&h.parentNode.removeChild(h.nextSibling),h.previousSibling&&""==h.previousSibling.nodeValue&&h.parentNode.removeChild(h.previousSibling),i!==h.nodeValue)throw new Error("Different text");const p=e(h).wrap(n).parent().get(0);a.push(p)}(i)}catch(c){return console&&console.warn&&console.warn(`Can't deserialize ${t}-th descriptor. Cause: ${c}`),s=!1,!0}}),s&&a}},e.fn.getHighlighter=function(){return this.data(r)},e.fn[r]=function(t){return this.each((function(){e.data(this,r)||e.data(this,r,new s(this,t))}))},e.textHighlighter={createWrapper:t=>e("<span></span>").css("backgroundColor",t.color).addClass(t.highlightedClass),defaults:{color:"#ffff7b",highlightedClass:"highlighted",contextClass:"highlighter-context",onRemoveHighlight:()=>!0,onBeforeHighlight:()=>!0,onAfterHighlight(){}}}}(jQuery,window,document)},xkEZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return d}));var i=n("Czhu"),a=n("ERkP"),o=n.n(a),r=n("FdGg"),s=n("fDrt");function c(e){return d(r.a,e)}function l(e){return d(s.a,e)}function d(e,t){return function(n){return a=>o.a.createElement(e,Object(i.a)({},t),o.a.createElement(n,Object(i.a)({},a)))}}},y4bl:function(e,t,n){var i=n("c72w"),a=n("xoyU"),o=n("pnw1"),r=n("tQYX"),s=n("Ypsa");e.exports=function(e,t,n,c){if(!r(e))return e;for(var l=-1,d=(t=a(t,e)).length,u=d-1,m=e;null!=m&&++l<d;){var h=s(t[l]),p=n;if(l!=u){var f=m[h];void 0===(p=c?c(f,h,m):void 0)&&(p=r(f)?f:o(t[l+1])?[]:{})}i(m,h,p),m=m[h]}return e}},zCQI:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i=n("ERkP"),a=n.n(i);const o=Object(i.createContext)({newCommentHighlight:void 0,createComment:()=>{},clearCreateHighlight:()=>{}});o.displayName="InlineCommentsContext";const r=({children:e})=>{const[t,n]=Object(i.useState)();return a.a.createElement(o.Provider,{value:{newCommentHighlight:t,createComment:e=>n(e),clearCreateHighlight:()=>n(void 0)}},e)}}}]);
//# sourceMappingURL=inline-comments~493df0b3.6X3hRpxY3t.js.map