(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{"/t1H":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("RfuI");const a=Object(o.a)({id:"427Xv",name:"InlineCommentNudge",loader:async()=>(await n.e("inlinecomment-nudge~b59ad437").then(n.bind(null,"U0JC"))).InlineCommentNudge})},ElYY:function(e,t,n){"use strict";var o=n("Czhu"),a=n("zjfJ"),r=n("lSUb"),i=n("ERkP"),s=n.n(i),c=n("L21V"),l=n("jCA7"),d=n("KsTJ"),u=n("lZoD"),p=n("Jygk"),h=n.n(p),b=n("kvU/"),m=n("GlNo"),f=n("Tos6"),g=n("H5Ms"),v=n("bU5Q"),O=n("3IV/"),j=n("9lk5"),I=n("bQlP"),C=n("ztP5"),w=n("cld1"),E=n("v2B8"),k=n("JncL"),x=n("WWAs"),y=n("v5SA"),P=n("1Y1u"),R=n("gIJ9"),T=n("S+bX"),H=n("8TdO"),V=n("KIs4"),A=n("b/OQ"),D=n("4LHq");var S=n("frZf"),_=n("bR0+"),N=n("gScn"),L=n("/t1H"),U=n("U63R"),F=n("kVKD"),K=n("LoMN"),M=n("KfvY"),W=n("xpeE"),q=n("tKrt"),$=n("T+3T"),z=n("6y+9");const Y=e=>!!e&&!!e["confluence.frontend.fabric.renderer.table.sorting"],J=e=>!!e&&!!e["confluence.frontend.fabric.editor.media.linking"],Z=e=>!!e&&!!e["confluence.frontend.fabric.renderer.sticky-headers"],B=e=>!!e&&!!e["confluence.frontend.open.expand.when.following.link"],G=e=>!!e&&!!e["confluence.frontend.fabric.editor.codeblock.copy"],X=d.default.div`
  div[mode="stick"] {
    z-index: 1;
    background: #fff;
  }
  span {
    &.inline-highlight {
      cursor: pointer;
      background-color: ${O.Y50};
      border-bottom: 2px solid ${O.Y100};

      &.active-highlight {
        background-color: ${O.Y75};
        border-bottom: 2px solid ${O.Y200};
        box-shadow: 0 2px 2px ${O.N50};
      }
    }

    &.inline-create-comment-selection {
      background-color: ${O.Y75};
      border-bottom: 2px solid ${O.Y200};
      box-shadow: 0 2px 2px ${O.N50};
    }
  }
`;class Q extends i.PureComponent{constructor(...e){super(...e),Object(a.a)(this,"state",{_root:void 0,justConvertedContentId:"",rerender:""}),Object(a.a)(this,"_handleActionToggle",(e,t)=>{const{objectId:n,updateInlineTask:o}=this.props;o({contentId:n,status:"TODO"===t?"UNCHECKED":"CHECKED",taskId:e.localId,trigger:"VIEW_PAGE"})}),Object(a.a)(this,"_handleProfileCardActions",e=>{const{inProductPeopleDirectory:t,push:n}=this.props;return[{label:this.props.intl.formatMessage({id:"view.profile"}),callback:()=>{t?n(Object(_.a)(e,null,S.a)):h.a.open(Object(_.a)(e,null),"_blank").focus()}}]}),Object(a.a)(this,"getExpandHash",()=>"requested"===this.state.rerender?"":this.props.getHash()),Object(a.a)(this,"getExtensionHandlers",e=>{const{objectId:t,spaceKey:n,showTemplateVariablesInPreview:o,showTemplateInputInPreview:a,isJposMacroEnabled:r}=this.props;return Object(W.a)({contentId:t,showTemplateVariablesInPreview:o,showTemplateInputInPreview:a,spaceKey:n,isJposMacroEnabled:r,shouldIncludeMacroHandlers:e})}),Object(a.a)(this,"_handleMediaClick",e=>{const{objectId:t,openPreviewer:n}=this.props;n({parentId:t,item:e.mediaItemDetails})}),Object(a.a)(this,"_handleLinkClick",e=>{const{isPersonalSpace:t,contentTitle:n}=this.props;if(t&&"Get to know Confluence"===n){e&&e.preventDefault();const t=e.target.href;h.a.open(t,"_blank")}}),Object(a.a)(this,"getEventHandlers",()=>{const{isMediaViewerNextGen:e,matchRoute:t,push:n}=this.props,a=e?void 0:{onClick:this._handleMediaClick};return Object(o.a)({link:{onClick:this._handleLinkClick},media:a},Object(E.a)({matchRoute:t,push:n}))}),Object(a.a)(this,"_setRoot",e=>this.setState({_root:e})),Object(a.a)(this,"shouldUseExtensionV2",(e={})=>e[I.l]||!1),Object(a.a)(this,"getProviders",Object(r.a)(()=>{const{accountId:e,containerId:t,contentType:n,cloudId:o,environment:a,featureFlags:r,objectId:i,spaceKey:s,isExternalShareRequest:c,sessionData:l}=this.props,d=b.a.create({mediaProvider:Object(P.b)({contentId:i,isExternalShare:c}),taskDecisionProvider:Promise.resolve(new z.a(this._handleActionToggle)),cardProvider:Promise.resolve(new R.a)});o&&e&&d.setProvider("mentionProvider",Object($.a)(o,e).then(e=>e.mentionResource).catch(e=>Promise.reject())),o&&(null==l?void 0:l.isLicensed)&&(d.setProvider("emojiProvider",Object(T.a)(f.a,{cloudId:o,source:"view"})),(async()=>{const e=await Object(V.b)(Object(H.getApolloClient)()),{featureFlags:t}=e;if(!t[D.a])return!0;const{data:n,errors:o}=await Object(H.getApolloClient)().query({query:A.a,errorPolicy:"all"});return!!o||!!(n&&n.globalOperations&&n.globalOperations.length>0&&n.globalOperations.some(e=>e&&"read"===e.operation&&"userProfile"===e.targetType))})().then(e=>{e&&d.setProvider("profilecardProvider",Object($.b)(o,this._handleProfileCardActions))})),t&&d.setProvider("contextIdentifierProvider",Promise.resolve({containerId:t,objectId:i,product:"confluence"}));const u=!!r&&r[I.E],p=!!r&&r["confluence.frontend.forge.editor.manifest"],h=[];if(this.shouldUseExtensionV2(r)&&h.push(Object(q.b)({contentId:i,spaceKey:s},this.getExtensionHandlers(!0))),u&&p&&o){const r=Object(j.d)(),c=["ari:cloud:confluence::site/"+o];h.push(Object(C.d)(r,c,d,Object(j.c)(a),"confluence","confluence:macroRenderer",Object(j.b)(e,o,i,s),!1,Object(w.getAnalyticsWebClient)(),Object(j.a)({objectId:i,objectType:n,containerId:t,containerType:"space"})))}return h.length>0&&d.setProvider("extensionProvider",Promise.resolve(Object(m.a)(h))),d})),Object(a.a)(this,"handleClicksInRenderer",e=>{if(e.target.hash==="#"+this.getExpandHash()){const e=document.getElementById(decodeURIComponent(this.getExpandHash()));if(e){const t=e.closest("[data-node-type='expand']");t&&"false"===t.getAttribute("data-expanded")&&this.setState({rerender:"requested"})}}}),Object(a.a)(this,"renderRenderer",e=>{const{adf:t,id:n,className:a,style:r,allowInlineComments:c,ignoreHeadingAnchorLinksFeatureFlag:l,renderWhenReady:d,onComplete:u,featureFlags:p,objectId:h,featureFlagClient:b}=this.props;if(!t)return null;const m=!l&&(e=>!!e&&!!e["confluence.frontend.fabric.renderer.heading.anchor"])(p),{offsetTop:f,appearance:O}=this.props,j="mobile"!==O&&void 0!==f&&Z(p)&&{offsetTop:f},I=(e=>!!e&&"variation"===e.getVariantValue("confluence.frontend.inline.comments.nudge",{default:"not-enrolled",oneOf:["control","not-enrolled","variation"],shouldTrackExposureEvent:!0}))(b),C=(e=>!!e&&"variation"===e.getVariantValue("confluence.frontend.view.all.inline.comments",{default:"not-enrolled",oneOf:["control","not-enrolled","variation"]}))(b),w=(e=>!!e&&!!e["confluence.frontend.fabric.renderer-spec-based-validator"])(p);return s.a.createElement(i.Fragment,null,s.a.createElement(X,{id:n,"data-inline-comments-target":c?"true":"false",className:a,innerRef:this._setRoot,style:Object(o.a)(Object(o.a)({},r),{},{width:"100%"}),"data-test-appearance":this.props.appearance},s.a.createElement(v.d,null,s.a.createElement("div",{onClick:B(p)?this.handleClicksInRenderer:void 0},s.a.createElement(g.a,{allowDynamicTextSizing:this.props.allowDynamicTextSizing,appearance:this.props.appearance,document:t,adfStage:"stage0",dataProviders:this.getProviders(),eventHandlers:this.getEventHandlers(),extensionHandlers:e,portal:this.state._root,onComplete:u,allowColumnSorting:Y(p),allowHeadingAnchorLinks:B(p)?{allowNestedHeaderLinks:m,activeHeadingId:decodeURIComponent(this.getExpandHash())}:m,allowAltTextOnImages:!0,media:{allowLinking:J(p)},stickyHeaders:j,useSpecBasedValidator:w,allowCopyToClipboard:G(p)}))),d&&d()),this.state._root&&C?s.a.createElement(M.a,{content:this.state._root}):null,this.state._root&&"full-page"===O&&I?s.a.createElement(L.a,{content:this.state._root,contentId:h,priority:U.a.BACKGROUND}):null)}),Object(a.a)(this,"renderRendererWithXen",(e,t,n,a,r)=>{const c=Object(j.d)(t),l=!!r&&r["confluence.frontend.forge.editor.manifest"];return s.a.createElement(C.b,{analyticsWebClient:Object(w.getAnalyticsWebClient)(),apolloClient:c,contextIds:e,dataProviders:this.getProviders(),forgeContext:n,forgeUIAnalyticsContext:a,environment:Object(j.c)(t),product:"confluence",page:"confluence:macroRenderer"},({extensionHandlers:e})=>{const t=!this.shouldUseExtensionV2(r);return s.a.createElement(i.Fragment,null,this.renderRenderer(Object(o.a)(Object(o.a)({},this.getExtensionHandlers(t)),l?{}:e)))})})}componentDidMount(){const{adf:e,featureFlags:t,sessionData:n}=this.props;e&&t&&t["confluence.frontend.fabric.fire-event-media"]&&(null==n?void 0:n.isLicensed)&&Object(k.a)()}componentDidUpdate(e){const{rerender:t}=this.state;"requested"===t&&this.setState({rerender:""})}componentWillUnmount(){const{adf:e,featureFlags:t,sessionData:n}=this.props;e&&t&&t["confluence.frontend.fabric.fire-event-media"]&&(null==n?void 0:n.isLicensed)&&Object(k.b)()}render(){h.a.performance.mark("CFP-63.view.page.classic.renderer.rendered");const{accountId:e,cloudId:t,containerId:n,contentType:o,environment:a,featureFlags:r,objectId:i,spaceKey:s}=this.props;if(!!r&&r[I.E]){if(!t||!a)return null;const c="ari:cloud:confluence::site/"+t;return this.renderRendererWithXen([c],a,Object(j.b)(e,t,i,s),Object(j.a)({objectId:i,objectType:o,containerId:n,containerType:"space"}),r)}const c=!this.shouldUseExtensionV2(r);return this.renderRenderer(this.getExtensionHandlers(c))}}Object(a.a)(Q,"contextTypes",{store:l.storeShape.isRequired});const ee=Object(c.h)(Q);class te extends i.PureComponent{render(){const{featureFlags:e,allowStickyHeaders:t}=this.props;return Z(e)&&!1!==t?s.a.createElement(u.c,{to:[x.a,y.a]},(e,t)=>{const n=e.getTotalHeight()+t.getFloatingHeight();return s.a.createElement(ee,Object(o.a)({offsetTop:n},this.props))}):s.a.createElement(ee,Object(o.a)({},this.props))}}Object(a.a)(te,"contextTypes",{store:l.storeShape.isRequired});t.a=Object(F.a)(Object(K.a)(Object(N.a)(te)))},KfvY:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var o=n("Iy7w"),a=n("ERkP"),r=n.n(a),i=n("lZoD"),s=n("xkEZ"),c=n("X2PC"),l=n("WWAs"),d=n("ZsZh"),u=n("fTLd");const p=Object(o.a)("div",{target:"e1liiq6x0"})("position:absolute;overflow:scroll;width:300px;min-height:200px;max-height:",({height:e})=>e+"px",";top:",({top:e})=>e+"px",";right:0px;padding:5px;display:flex;flex-direction:column;align-items:flex-end;z-index:0;"),h=Object(a.memo)(({content:e})=>{const t=Object(a.useRef)(null),n=Object(a.useRef)(0),[o,s]=Object(a.useState)({height:0,top:0}),{isViewAllInlineCommentsVisible:c}=Object(a.useContext)(d.a);return Object(a.useEffect)(()=>{if(t.current=e&&e.getElementsByClassName("ak-renderer-document")[0]||null,t.current){const{top:e,height:o}=(e=>e&&e.getBoundingClientRect())(t.current),a=e-n.current;s({height:o,top:a})}},[e]),r.a.createElement(i.c,{to:[l.a]},e=>{const t=e.getTotalHeight();return n.current=t,r.a.createElement(p,{top:o.top,height:o.height},c?r.a.createElement(u.ViewAllInlineComments,null):null)})}),b=Object(s.b)({attribution:c.a.COLLABORATION})(h)},LoMN:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n("Czhu"),a=n("ERkP"),r=n.n(a),i=n("a0gl");function s(e){function t(t){const n=Object(i.a)();return r.a.createElement(e,Object(o.a)({sessionData:n},t))}return t.displayName=`withSessionData(${e.displayName||e.name})`,t}},ZsZh:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var o=n("ERkP"),a=n.n(o);const r=Object(o.createContext)({isViewAllInlineCommentsVisible:!1,viewAllInlineComments:()=>{}});r.displayName="ViewAllInlineCommentsContext";const i=({children:e})=>{const[t,n]=Object(o.useState)(!1);return a.a.createElement(r.Provider,{value:{isViewAllInlineCommentsVisible:t,viewAllInlineComments:e=>n(e)}},e)}},fTLd:function(e,t,n){"use strict";n.r(t);var o=n("ERkP"),a=n.n(o),r=n("1U1M"),i=n("+mzV"),s=n("pWz0"),c=n("kF9a"),l=n("dIe6"),d=n("H5qd");const u=n.n(d).a`query ViewAllInlineCommentsQuery($pageId:ID!){comments(pageId:$pageId type:UNRESOLVED depth:ROOT){count nodes{id location{type ...on InlineComment{inlineMarkerRef}}}}content(id:$pageId){nodes{id type properties(key:"editor"){nodes{id key value}}}}}`;n.d(t,"ViewAllInlineComments",(function(){return p}));const p=Object(o.memo)(()=>{var e;const[t,n]=Object(o.useState)([]),{contentId:d}=Object(o.useContext)(i.a),{loading:p,data:h,error:b}=Object(r.d)(u,{variables:{pageId:d},fetchPolicy:"cache-and-network"}),m=null!=(e=h)&&null!=(e=e.content)&&null!=(e=e.nodes)&&null!=(e=e[0])?e.type:e;return Object(o.useEffect)(()=>{if(h){var e,t;const o=((null!=(t=h)&&null!=(t=t.comments)?t.nodes:t)||[]).map(e=>{const{inlineMarkerRef:t}=e.location;return t}),a='"v2"'===(null!=(e=h)&&null!=(e=e.content)&&null!=(e=e.nodes)&&null!=(e=e[0])&&null!=(e=e.properties)&&null!=(e=e.nodes)&&null!=(e=e[0])?e.value:e);n(Object(s.i)(o,a))}},[h]),p?null:b?a.a.createElement(l.a,{error:b}):t&&t.length>0?a.a.createElement(o.Fragment,null,t.map((e,t)=>a.a.createElement(c.a,{key:t,inlineMarkerRef:e,mode:"view",pageType:m}))):null})},kF9a:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var o=n("RfuI");const a=Object(o.a)({id:"C2fVF",name:"InlineCommentsLoader",loader:async()=>(await Promise.all([n.e("atlaskit~66e23772"),n.e("afp~af75c846"),n.e("vendors~4134d62c"),n.e(0),n.e(4),n.e(5),n.e(6),n.e(7),n.e(11),n.e(10),n.e(9),n.e(12),n.e(13),n.e(17),n.e(15),n.e(18),n.e(20),n.e(19),n.e(21),n.e(22),n.e(26),n.e(27),n.e(31),n.e(35),n.e(38),n.e(37),n.e(36),n.e(39),n.e(40),n.e(41),n.e(44),n.e(46),n.e(56),n.e(59),n.e(87),n.e("inline-comments~493df0b3")]).then(n.bind(null,"vzxV"))).InlineComments}),r=Object(o.a)({id:"e+EUE",name:"InlineCommentView",loader:async()=>(await Promise.all([n.e("atlaskit~66e23772"),n.e("vendors~4134d62c"),n.e(4),n.e(5),n.e(12),n.e(13),n.e(18),n.e(20),n.e(19),n.e(21),n.e(26),n.e(35),n.e(38),n.e(59),n.e("inline-comment-view~b59ad437")]).then(n.bind(null,"NZ/4"))).InlineCommentView})},v2B8:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("lSUb"),a=n("NMWM"),r=n("0K0H");const i=Object(o.a)(e=>e&&"function"==typeof e.push?{smartCard:{onClick(t,n){const o=Object(r.b)(t,e);o&&o===n?(t.preventDefault(),e.push(o,Object(a.a)())):s(t,n)}}}:void 0),s=(e,t)=>{c(e)?window.open(t,"_blank"):window.open(t,"_self")},c=e=>e.isDefaultPrevented()&&(window.parent!==parent||l(e)||(e=>1===e.button)(e)),l=e=>e.ctrlKey||e.metaKey}}]);
//# sourceMappingURL=130.EMMcFUSsyH.js.map