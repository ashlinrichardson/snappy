(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{"8AuC":function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"d",(function(){return i}));const a="inEditorTemplatesPanel",n="open",o=e=>e()[a]===n,i=e=>{e({[a]:null},!0)}},GFmV:function(e,t,r){"use strict";r.d(t,"g",(function(){return p})),r.d(t,"e",(function(){return d})),r.d(t,"b",(function(){return g})),r.d(t,"d",(function(){return b})),r.d(t,"h",(function(){return f})),r.d(t,"c",(function(){return h})),r.d(t,"a",(function(){return E})),r.d(t,"f",(function(){return y}));var a=r("Czhu"),n=r("EfWO"),o=r.n(n),i=r("frZf"),c=r("ViWs");const s="createBlankFabricPage",l="parentPageId",u="spaceKey",p=e=>{const t=e[s];return"string"==typeof t?"true"===t:!!t},d=e=>{const t={};return e[l]&&(t.parentPageId=e[l]),e[u]&&(t.spaceKey=e[u]),t},g=(e,t={})=>({[s]:e||null,[l]:t.parentPageId||null,[u]:t.spaceKey||null}),b=e=>(e=>{const t=e.getBooleanValue("confluence.frontend.fabric.editor.blank.page",{default:!1,shouldTrackExposureEvent:!1}),r=e.getBooleanValue("confluence.frontend.fabric.editor.all-pages",{default:!1,shouldTrackExposureEvent:!1});return t||r})(e)&&Object(c.a)(e),f=(e,t)=>{var r,a,n;if((null!=(n=e)&&null!=(n=n.content)&&null!=(n=n.nodes)&&null!=(n=n[0])&&null!=(n=n.space)?n.key:n)!==t)return!1;if("page"!==(null!=(a=e)&&null!=(a=a.content)&&null!=(a=a.nodes)&&null!=(a=a[0])?a.type:a))return!1;const o=null!=(r=e)&&null!=(r=r.content)&&null!=(r=r.nodes)&&null!=(r=r[0])?r.operations:r;return!!(o&&o.find(e=>"page"===e.targetType&&"create"===e.operation))},h=(e,t)=>({value:e||t,usedOverride:!!e}),E=(e,t)=>{const r=o.a.parse(e,!0);return o.a.format(Object(a.a)(Object(a.a)({},r),{},{search:void 0,query:Object(a.a)(Object(a.a)({},r.query),t)}))},y=e=>{if(!e)throw new Error("No url for new content");return e.startsWith(i.a)?e:`${i.a}${e}`}},ViWs:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));let a;!function(e){e.NOT_ENROLLED="not-enrolled",e.IN_EDITOR_TEMPLATES_EXPERIENCE="in-editor-templates-experience",e.DEFAULT_TEMPLATES_EXPERIENCE="default-templates-experience"}(a||(a={}));const n=e=>e.getVariantValue("confluence.frontend.in-editor-templates.phase-1",{default:a.NOT_ENROLLED,oneOf:Object.values(a),shouldTrackExposureEvent:!0})===a.IN_EDITOR_TEMPLATES_EXPERIENCE},Xmxh:function(e,t,r){"use strict";r.r(t);var a=r("ERkP"),n=r.n(a),o=r("T+Mg"),i=r("+mzV"),c=r("Ua4J"),s=r("GFmV"),l=r("Czhu"),u=r("zjfJ"),p=r("L21V"),d=r("X2PC"),g=r("6z9Z"),b=r("3VMZ"),f=r("8TdO"),h=r("F4Ur"),E=r("BX6b"),y=r("8AuC"),m=r("h4hg");const O=Object(p.g)({errorTitle:{id:"create-blank-fabric-page.error.title",description:"title for all error flags created by create-blank-fabric-page",defaultMessage:"We can’t create a page for you"},invalidPermissions:{id:"create-blank-fabric-page.error.invalid-permissions",description:"error message when they cant create in any space",defaultMessage:"You don’t have the right permissions; talk to your admin about adjusting them."},pageCreationError:{id:"create-blank-fabric-page.error.page-creation-error",description:"error message when the page creation endpoint errors or doesnt return a link to follow",defaultMessage:"Refresh the page and try again. If this keeps happening, contact Support."}});var P=r("H5qd"),v=r.n(P);const j=v.a`mutation CreateBlankFabricPageQuery($spaceKey:String!$parentPage:String)@SLA@experimental{experimentalCreateBlankFabricPage(spaceKey:$spaceKey parentPage:$parentPage){links{draftUrl}}}`,C=v.a`mutation CreateFabricBlogpostQuery($spaceKey:String!)@experimental{experimentalCreateFabricBlogpost(spaceKey:$spaceKey){links{draftUrl}}}`,k=v.a`query GetPromotedSpacesQuery($promotedSpaceKey:String)@experimental{experimentalPromotedSpaces(promotedSpacesLimit:1 otherSpacesLimit:1 promotedSpaceKey:$promotedSpaceKey){nodes{id}}}`,w=v.a`query ParentPageQuery($contentId:ID){content(id:$contentId){nodes{id type operations{operation targetType}space{id key}}}}`,S=v.a`query GetSpaceOperationsQuery($spaceKey:String!){space(key:$spaceKey){id operations{operation targetType}}}`;class T extends Error{}const x=Object(p.h)(Object(g.b)(class extends a.PureComponent{constructor(...e){super(...e),Object(u.a)(this,"handleError",e=>{const{flags:t,intl:r,onError:a}=this.props;t.showErrorFlag({title:r.formatMessage(O.errorTitle),description:r.formatMessage(e)}),a()}),Object(u.a)(this,"handleCreationError",e=>{this.props.experienceTracker.fail({name:b.a.CREATE_PAGE,error:e}),Object(E.c)().submitError(e,{attribution:d.a.TAILORED_EXPERIENCES}),this.handleError(O.pageCreationError)}),Object(u.a)(this,"handlePermissionsError",e=>{this.props.experienceTracker.abort({name:b.a.CREATE_PAGE,reason:e.message}),this.handleError(O.invalidPermissions)}),Object(u.a)(this,"checkSpacePermissions",async e=>{var t;const r={spaceKey:e},a=(null!=(t=(await Object(f.getApolloClient)().query({query:S,variables:r})).data)&&null!=(t=t.space)?t.operations:t)||[];return{canCreatePage:!!a.find(e=>"create"===e.operation&&"page"===e.targetType),canCreateBlog:!!a.find(e=>"create"===e.operation&&"blogpost"===e.targetType)}}),Object(u.a)(this,"createBlogpost",async e=>{var t;const r=null!=(t=(await Object(f.getApolloClient)().mutate({mutation:C,variables:e})).data)&&null!=(t=t.experimentalCreateFabricBlogpost)&&null!=(t=t.links)?t.draftUrl:t;return Object(s.f)(r)}),Object(u.a)(this,"createBlankPage",async e=>{var t;const r=null!=(t=(await Object(f.getApolloClient)().mutate({mutation:j,variables:e})).data)&&null!=(t=t.experimentalCreateBlankFabricPage)&&null!=(t=t.links)?t.draftUrl:t;return Object(s.f)(r)}),Object(u.a)(this,"createContent",async e=>{const{canCreatePage:t,canCreateBlog:r}=await this.checkSpacePermissions(e);if(t){const t=await this.getParentPageIdForCreation(e),r=await this.createBlankPage({spaceKey:e,parentPage:t});return Object(s.a)(r,{[y.a]:y.b})}if(r)return await this.createBlogpost({spaceKey:e});throw new Error("Spaces endpoint returned a space without page or blog permissions")}),Object(u.a)(this,"getSpaceKeyForCreation",async()=>{var e;const{currentSpaceKey:t,creationOverrides:r}=this.props,{value:a,usedOverride:n}=Object(s.c)(r.spaceKey,t),o={promotedSpaceKey:a},i=null!=(e=(await Object(f.getApolloClient)().query({query:k,variables:o})).data)&&null!=(e=e.experimentalPromotedSpaces)&&null!=(e=e.nodes)&&null!=(e=e[0])?e.id:e;if(i){if(n&&i!==a)throw new T("invalid space used as override");return i}throw new T("no spaces for creation")}),Object(u.a)(this,"getParentPageIdForCreation",async e=>{const{currentParentPageId:t,creationOverrides:r}=this.props,{value:a,usedOverride:n}=Object(s.c)(r.parentPageId,t);if(!a)return null;let o;async function i(t=!1){try{const r={contentId:a},n=(await Object(f.getApolloClient)().query(Object(l.a)({query:w,variables:r},t?{fetchPolicy:"network-only"}:{}))).data;return Object(s.h)(n,e)}catch(u){var r,n,i,c;if(Object(h.a)(u),u.message!==(null===(r=o)||void 0===r?void 0:r.message))403!==(null==u||null===(n=u.graphQLErrors)||void 0===n||null===(i=n[0])||void 0===i||null===(c=i.extensions)||void 0===c?void 0:c.statusCode)&&Object(E.c)().submitError(u,{attribution:d.a.TAILORED_EXPERIENCES});return o=u,!1}}if(await i()||await i(!0))return a;if(!n)return null;throw new T("invalid parent page used as override")}),Object(u.a)(this,"createBlankFabricPage",async()=>{try{this.props.experienceTracker.start({name:b.a.CREATE_PAGE,attributes:{flow:"createBlankFabricPage"}});const e=await this.getSpaceKeyForCreation(),t=await this.createContent(e);this.props.onSuccess(t),this.props.experienceTracker.succeed({name:b.a.CREATE_PAGE})}catch(e){Object(h.a)(e),e instanceof T?this.handlePermissionsError(e):this.handleCreationError(e)}})}componentDidMount(){this.createBlankFabricPage()}render(){return n.a.createElement(m.a,null)}}));var K=r("1U1M");const I=({currentSpaceKey:e})=>{var t;const{data:r}=Object(K.d)(k,{variables:{promotedSpaceKey:e}}),a=(null!=(t=r)&&null!=(t=t.experimentalPromotedSpaces)&&null!=(t=t.nodes)&&null!=(t=t[0])?t.id:t)||"";return Object(K.d)(S,{variables:{spaceKey:a},skip:!a}),null};r.d(t,"CreateBlankFabricPageListener",(function(){return F}));const A=({flags:e})=>{const{setQueryParams:t,getQueryParams:r,push:o}=Object(a.useContext)(c.a),{spaceKey:l,contentId:u}=Object(a.useContext)(i.a),p=Object(a.useCallback)(()=>{t(Object(s.b)(!1,{}),!0)},[t]),d=Object(a.useCallback)(e=>{p(),o(e)},[o,p]),g=r(),b=Object(s.e)(g),f=Object(s.g)(g);return n.a.createElement(a.Fragment,null,n.a.createElement(I,{currentSpaceKey:l}),f&&n.a.createElement(x,{flags:e,currentSpaceKey:l,currentParentPageId:"string"==typeof u?u:null,creationOverrides:b,onError:p,onSuccess:d}))},F=Object(o.a)(Object(a.memo)(A))},h4hg:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var a=r("ERkP"),n=r.n(a),o=r("KsTJ"),i=r("lRcl"),c=r("BMbf"),s=r("3IV/");const l=o.default.div`
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: ${c.i.blanket()+1};
`,u=o.default.div`
  z-index: ${c.i.blanket};
  height: 100%;
  width: 100%;
  position: fixed;
  left: 0;
  top: 0;
  background-color: ${s.N0};
  opacity: 0.54;
  transition: opacity 0.2s;
  transition-delay: 0.1s;
`,p=()=>n.a.createElement(a.Fragment,null,n.a.createElement(l,null,n.a.createElement(i.a,{size:26})),n.a.createElement(u,null))}}]);
//# sourceMappingURL=155.8D24N4Kejx.js.map