(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{H29T:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const r="fabric-elements"},HkWh:function(e){e.exports=JSON.parse('{"a":"@atlaskit/mention","b":"19.0.5"}')},MjPE:function(e,t,n){"use strict";var r,s,i,a;function o(e){return!!e&&e!==s[s.CONTAINER]}function c(e){return!!e.userType&&e.userType===i[i.SPECIAL]}function u(e){return e.userType&&e.userType===i[i.APP]}function h(e){return e.userType&&e.userType===i[i.TEAM]}function l(e){return e&&("@all"===e||"@here"===e)}n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"h",(function(){return c})),n.d(t,"e",(function(){return u})),n.d(t,"j",(function(){return h})),n.d(t,"i",(function(){return l})),n.d(t,"f",(function(){return d})),function(e){e[e.SELF=0]="SELF",e[e.RESTRICTED=1]="RESTRICTED",e[e.DEFAULT=2]="DEFAULT"}(r||(r={})),function(e){e[e.NONE=0]="NONE",e[e.SITE=1]="SITE",e[e.APPLICATION=2]="APPLICATION",e[e.CONTAINER=3]="CONTAINER"}(s||(s={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SPECIAL=1]="SPECIAL",e[e.APP=2]="APP",e[e.TEAM=3]="TEAM",e[e.SYSTEM=4]="SYSTEM"}(i||(i={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SERVICE_ERROR=1]="SERVICE_ERROR",e[e.OK=2]="OK"}(a||(a={}));const d=e=>!(!e||!e.then)},kQ1B:function(e,t,n){"use strict";var r=n("zDE1"),s=n("xV3C");class i{constructor(e,t){this.presence=e,this.expiry=Date.now()+t}expired(){return Date.now()>this.expiry}}class a extends s.b{refreshPresence(e){throw new Error("not yet implemented.\nParams: userIds="+e)}notifyListeners(e){this.changeListeners.forEach((t,n)=>{try{t(e)}catch(s){Object(r.a)(`error from listener '${n}', ignoring`,s)}})}}class o extends a{constructor(e){if(super(),!e.url)throw new Error("config.url is a required parameter");if(!e.cloudId)throw new Error("config.cloudId is a required parameter");this.config=e,this.config.url=o.cleanUrl(e.url),this.presenceCache=e.cache||new c(e.cacheExpiry),this.presenceParser=e.parser||new u}refreshPresence(e){const t=this.presenceCache.getBulk(e);this.notifyListeners(t);const n=this.presenceCache.getMissingUserIds(e);n.length&&this.retrievePresence(n)}retrievePresence(e){this.queryDirectoryForPresences(e).then(e=>this.presenceParser.parse(e)).then(e=>{this.notifyListeners(e),this.presenceCache.update(e)})}queryDirectoryForPresences(e){const t={query:"query getPresenceForMentions($organizationId: String!, $userIds: [String!], $productId: String) {\n                PresenceBulk(organizationId: $organizationId, product: $productId, userIds: $userIds) {\n                  userId\n                  state\n                  stateMetadata\n                }\n              }",variables:{organizationId:this.config.cloudId,userIds:e}};this.config.productId&&(t.variables.productId=this.config.productId);const n={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)};return fetch(this.config.url,n).then(e=>e.json())}static cleanUrl(e){return"/"!==e.substr(-1)&&(e+="/"),e}}class c{constructor(e,t){this.expiryInMillis=e||c.defaultTimeout,this.flushTrigger=t||c.defaultFlushTrigger,this.cache={},this.size=0}_delete(e){delete this.cache[e],this.size--}_deleteIfExpired(e){this.contains(e)&&this.cache[e].expired()&&this._delete(e)}_removeExpired(){Object.keys(this.cache).forEach(e=>{this._deleteIfExpired(e)})}contains(e){return this.cache.hasOwnProperty(e)}get(e){return this._deleteIfExpired(e),this.contains(e)?this.cache[e].presence:{}}getBulk(e){const t={};for(const n of e)this.contains(n)&&(t[n]=this.get(n));return t}getMissingUserIds(e){return e.filter(e=>!this.contains(e))}update(e){this.size>=this.flushTrigger&&this._removeExpired(),Object.keys(e).forEach(t=>{this.cache[t]=new i(e[t],this.expiryInMillis),this.size++})}}c.defaultTimeout=2e4,c.defaultFlushTrigger=50;class u{mapState(e){return"unavailable"===e?"offline":"available"===e?"online":e}parse(e){const t={};if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("PresenceBulk")){const n=e.data.PresenceBulk;for(const e of n)if(e.userId&&e.state){const n=u.extractState(e)||e.state;t[e.userId]={status:this.mapState(n)}}else e.hasOwnProperty("userId")&&e.hasOwnProperty("state")||console.error("Unexpected response from presence service contains keys: "+Object.keys(e))}return t}static extractState(e){return u.isFocusState(e)?u.FOCUS_STATE:e.state}static isFocusState(e){if(e.stateMetadata)try{const t=JSON.parse(e.stateMetadata);return t&&!!t.focus}catch(t){console.error(`Failed to parse presence's stateMetadata for user with id ${e.userId}: ${e.stateMetadata}`),console.error(t)}return!1}}u.FOCUS_STATE="focus",t.a=o},mn6t:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n("Czhu"),s=n("pL3m"),i=n("eWMb"),a=n("MjPE"),o=n("xV3C"),c=n("zDE1");class u extends o.c{constructor(e,t){super(e),this.lastSearchQuery="",this.mentionTypeaheadHighlightEnabled=()=>this.teamMentionConfig.teamHighlightEnabled||!1,this.mentionTypeaheadCreateTeamPath=()=>this.teamMentionConfig.createTeamPath,this.verifyMentionConfig(t),this.teamMentionConfig=t,this.lastReturnedSearchTeam=0}filter(e,t){if(this.lastSearchQuery=e,e){this.updateActiveSearches(e);const n=this.remoteUserSearch(e,t),r=this.remoteTeamSearch(e,t);return this.handleBothRequests(e,n,r)}return this.remoteInitialStateTeamAndUsers(t)}async remoteInitialStateTeamAndUsers(e){const t=super.remoteInitialState(e),n={path:"bootstrap",queryParams:this.getQueryParamsOfTeamMentionConfig(e)},r=i.b.requestService(this.teamMentionConfig,n);this.handleBothRequests("",t,r)}async handleBothRequests(e,t,n){const r=Date.now();let s={mentions:[],query:e};const i=(t,n)=>{e===this.lastSearchQuery&&(s={mentions:[...s.mentions,...t.mentions],query:e},n?this.notify(r,s,e):super.notify(r,s,e))};let a,o=null,u=null;try{a=await t,i(a,!1)}catch(h){o=h}try{const t=await n;i(Array.isArray(t)?this.convertTeamResultToMentionResult(t,e):t,!0)}catch(h){u=h}o&&u&&(this.notifyError(o,e),Object(c.a)("User mention request fails. ",o),Object(c.a)("Team mention request fails. ",u))}notify(e,t,n){if(e>this.lastReturnedSearchTeam)this.lastReturnedSearchTeam=e,this._notifyListeners(t,{teamMentionDuration:Date.now()-e});else{const t=new Date(e).toISOString().substr(17,6);Object(c.a)("Stale search result, skipping",t,n)}this._notifyAllResultsListeners(t)}getQueryParamsOfTeamMentionConfig(e){const t={};return this.teamMentionConfig.containerId&&(t.containerId=this.teamMentionConfig.containerId),this.teamMentionConfig.productId&&(t.productIdentifier=this.teamMentionConfig.productId),Object(r.a)(Object(r.a)({},t),e)}remoteUserSearch(e,t){return super.remoteSearch(e,t)}async remoteTeamSearch(e,t){const n={path:"search",queryParams:Object(r.a)({query:e,limit:20},this.getQueryParamsOfTeamMentionConfig(t))};try{const t=await i.b.requestService(this.teamMentionConfig,n);return this._notifyAnalyticsListeners(s.c,s.d.SEARCH_TEAM,s.a.SUCCEEDED),this.convertTeamResultToMentionResult(t,e)}catch(a){throw this._notifyAnalyticsListeners(s.c,s.d.SEARCH_TEAM,s.a.FAILED),a}}convertTeamResultToMentionResult(e,t){const{teamLinkResolver:n}=this.teamMentionConfig;return{mentions:e.map(e=>{let t="";const r=`${window.location.origin}/people/team/${e.id}`;return"function"==typeof n&&(t=n(e.id)),{id:this.trimTeamARI(e.id),avatarUrl:e.smallAvatarImageUrl,name:e.displayName,accessLevel:a.c[a.c.CONTAINER],userType:a.d[a.d.TEAM],highlight:e.highlight,context:{members:e.members,includesYou:e.includesYou,memberCount:e.memberCount,teamLink:t||r}}}),query:t}}trimTeamARI(e=""){return e.replace("ari:cloud:teams::team/","")}}},pL3m:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return h})),n.d(t,"h",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"f",(function(){return f})),n.d(t,"j",(function(){return m})),n.d(t,"e",(function(){return y})),n.d(t,"g",(function(){return p}));var r=n("hu6Q"),s=n("H29T"),i=n("HkWh"),a=n("MjPE");const o="sli";var c,u,h;!function(e){e.SEARCH="searchUser",e.SEARCH_TEAM="searchTeam",e.INITIAL_STATE="initialState",e.SELECT="select",e.SELECT_TEAM="selectTeam"}(c||(c={})),function(e){e.TYPEAHEAD="mentionTypeahead",e.MENTION="mention",e.TEAM_MENTION_HIGHLIGHT="teamMentionHighlight"}(u||(u={})),function(e){e.VIEWED="viewed",e.CLICKED="clicked",e.CLOSED="closed",e.SUCCEEDED="succeeded",e.FAILED="failed"}(h||(h={}));const l=e=>(t,n,a=[],o)=>{if(e.createAnalyticsEvent){const c={action:t,actionSubject:u.TYPEAHEAD,attributes:{packageName:i.a,packageVersion:i.b,componentName:u.MENTION,duration:Math.round(n),userIds:a,queryLength:o?o.length:0},eventType:r.b};e.createAnalyticsEvent(c).fire(s.a)}},d=e=>(t,n,a,o,c)=>{if(e){const h={action:n,actionSubject:t,actionSubjectId:o,eventType:r.e,attributes:{source:a,packageName:i.a,packageVersion:i.b,componentName:u.TEAM_MENTION_HIGHLIGHT,viewedCount:c}};e(h).fire(s.a)}},f=e=>(t,n,o,c,h)=>{const l={action:n,actionSubject:t,eventType:r.e,attributes:{packageName:i.a,packageVersion:i.b,componentName:u.MENTION,accessLevel:h,isSpecial:Object(a.i)(o),userId:c}},d=e(l);return d.fire(s.a),d},m=e=>(t,n)=>{if(e.createAnalyticsEvent){const r=y(t,n);e.createAnalyticsEvent(r).fire(s.a)}},y=(e,t)=>({action:t,actionSubject:e,eventType:r.b,attributes:{packageName:i.a,packageVersion:i.b,componentName:u.MENTION}}),p=e=>(t,n,a,o)=>{if(e.createAnalyticsEvent){const c={action:t,actionSubject:u.MENTION,actionSubjectId:"hydration",attributes:{packageName:i.a,packageVersion:i.b,componentName:u.MENTION,userId:n,fromCache:a,duration:Math.round(o)},eventType:r.b};e.createAnalyticsEvent(c).fire(s.a)}}},xV3C:function(e,t,n){"use strict";n.d(t,"d",(function(){return l})),n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return h}));var r=n("Czhu"),s=n("eWMb"),i=n("MjPE"),a=n("zDE1"),o=n("pL3m");const c=()=>({params:{},headers:{}});class u{constructor(){this.changeListeners=new Map,this.allResultsListeners=new Map,this.errListeners=new Map,this.infoListeners=new Map,this.analyticsListeners=new Map}subscribe(e,t,n,r,s,i){t&&this.changeListeners.set(e,t),n&&this.errListeners.set(e,n),r&&this.infoListeners.set(e,r),s&&this.allResultsListeners.set(e,s),i&&this.analyticsListeners.set(e,i)}unsubscribe(e){this.changeListeners.delete(e),this.errListeners.delete(e),this.infoListeners.delete(e),this.allResultsListeners.delete(e),this.analyticsListeners.delete(e)}}class h extends u{shouldHighlightMention(e){return!1}filter(e){throw new Error("not yet implemented.\nParams: query="+e)}recordMentionSelection(e){}isFiltering(e){return!1}_notifyListeners(e,t){Object(a.a)("ak-mention-resource._notifyListeners",e&&e.mentions&&e.mentions.length,this.changeListeners),this.changeListeners.forEach((n,r)=>{try{n(e.mentions.slice(0,20),e.query,t)}catch(s){Object(a.a)(`error from listener '${r}', ignoring`,s)}})}_notifyAllResultsListeners(e){Object(a.a)("ak-mention-resource._notifyAllResultsListeners",e&&e.mentions&&e.mentions.length,this.changeListeners),this.allResultsListeners.forEach((t,n)=>{try{t(e.mentions.slice(0,20),e.query)}catch(r){Object(a.a)(`error from listener '${n}', ignoring`,r)}})}_notifyErrorListeners(e,t){this.errListeners.forEach((n,r)=>{try{n(e,t)}catch(s){Object(a.a)(`error from listener '${r}', ignoring`,s)}})}_notifyInfoListeners(e){this.infoListeners.forEach((t,n)=>{try{t(e)}catch(r){Object(a.a)(`error from listener '${n}', ignoring`,r)}})}_notifyAnalyticsListeners(e,t,n){this.analyticsListeners.forEach((r,s)=>{try{r(e,t,n)}catch(i){Object(a.a)(`error from listener '${s}', ignoring`,i)}})}}const l=e=>!!(e&&e.supportsMentionNameResolving&&e.supportsMentionNameResolving());t.c=class extends h{constructor(e){super(),this.verifyMentionConfig(e),this.config=e,this.lastReturnedSearch=0,this.activeSearches=new Set}shouldHighlightMention(e){return!!this.config.shouldHighlightMention&&this.config.shouldHighlightMention(e)}notify(e,t,n){if(e>this.lastReturnedSearch)this.lastReturnedSearch=e,this._notifyListeners(t,{duration:Date.now()-e});else{const t=new Date(e).toISOString().substr(17,6);Object(a.a)("Stale search result, skipping",t,n)}this._notifyAllResultsListeners(t)}notifyError(e,t){this._notifyErrorListeners(e,t),t&&this.activeSearches.delete(t)}async filter(e,t){try{const n=Date.now();let r;if(e){this.activeSearches.add(e);const n=this.search(e,t);r=await n.mentions}else r=await this.initialState(t);this.notify(n,r,e)}catch(n){this.notifyError(n,e)}}recordMentionSelection(e,t){return this.recordSelection(e,t).then(()=>{},e=>Object(a.a)("error recording mention selection: "+e,e))}isFiltering(e){return this.activeSearches.has(e)}resolveMentionName(e){return this.config.mentionNameResolver?this.config.mentionNameResolver.lookupName(e):{id:e,name:"",status:i.a.UNKNOWN}}cacheMentionName(e,t){this.config.mentionNameResolver&&this.config.mentionNameResolver.cacheName(e,t)}supportsMentionNameResolving(){return!!this.config.mentionNameResolver}updateActiveSearches(e){this.activeSearches.add(e)}verifyMentionConfig(e){if(!e.url)throw new Error("config.url is a required parameter");e.securityProvider||(e.securityProvider=c)}initialState(e){return this.remoteInitialState(e)}clearContext(e={}){return Object.keys(e).filter(t=>e[t]).reduce((t,n)=>Object(r.a)({[n]:e[n]},t),{})}getQueryParams(e){const t={};return this.config.containerId&&(t.containerId=this.config.containerId),this.config.productId&&(t.productIdentifier=this.config.productId),Object(r.a)(Object(r.a)({},t),this.clearContext(e))}async remoteInitialState(e){const t={path:"bootstrap",queryParams:this.getQueryParams(e)};try{const e=await s.b.requestService(this.config,t);return this._notifyAnalyticsListeners(o.c,o.d.INITIAL_STATE,o.a.SUCCEEDED),this.transformServiceResponse(e,"")}catch(n){throw this._notifyAnalyticsListeners(o.c,o.d.INITIAL_STATE,o.a.FAILED),n}}search(e,t){return{mentions:this.remoteSearch(e,t)}}async remoteSearch(e,t){const n={path:"search",queryParams:Object(r.a)({query:e,limit:100},this.getQueryParams(t))};try{const t=await s.b.requestService(this.config,n);return this._notifyAnalyticsListeners(o.c,o.d.SEARCH,o.a.SUCCEEDED),this.transformServiceResponse(t,e)}catch(i){throw this._notifyAnalyticsListeners(o.c,o.d.SEARCH,o.a.FAILED),i}}transformServiceResponse(e,t){const n=e.mentions.map(e=>{let n;return(Object(i.e)(e)||Object(i.j)(e))&&(n=e.userType),Object(r.a)(Object(r.a)({},e),{},{lozenge:n,query:t})});return Object(r.a)(Object(r.a)({},e),{},{mentions:n,query:e.query||t})}async recordSelection(e,t){const n={path:"record",queryParams:Object(r.a)({selectedUserId:e.id},this.getQueryParams(t)),requestInit:{method:"POST"}},a=Object(i.j)(e)?o.d.SELECT_TEAM:o.d.SELECT;try{const e=await s.b.requestService(this.config,n);return this._notifyAnalyticsListeners(o.c,a,o.a.SUCCEEDED),e}catch(c){throw this._notifyAnalyticsListeners(o.c,a,o.a.FAILED),c}}}},zDE1:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));let r=!1;function s(e,...t){r&&console.log(e,...t)}}}]);
//# sourceMappingURL=21.51JUgye4rs.js.map